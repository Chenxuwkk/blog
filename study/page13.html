<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.48">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>STM32 | Chenxuwkk's Blog</title><meta name="description" content="Chenxuwkk's Blog">
    <link rel="modulepreload" href="/blog/assets/app.b33ca31f.js"><link rel="modulepreload" href="/blog/assets/page13.html.31c29b64.js"><link rel="modulepreload" href="/blog/assets/page13.html.3976787d.js"><link rel="prefetch" href="/blog/assets/about.html.1a741a35.js"><link rel="prefetch" href="/blog/assets/contact.html.03aacf5e.js"><link rel="prefetch" href="/blog/assets/index.html.2e04d9b1.js"><link rel="prefetch" href="/blog/assets/index.html.dc88bf6f.js"><link rel="prefetch" href="/blog/assets/page01.html.6f1784f0.js"><link rel="prefetch" href="/blog/assets/index.html.b2e428a6.js"><link rel="prefetch" href="/blog/assets/page01.html.8647912c.js"><link rel="prefetch" href="/blog/assets/page02.html.2ae31539.js"><link rel="prefetch" href="/blog/assets/page03.html.e30663aa.js"><link rel="prefetch" href="/blog/assets/page04.html.5b5a177e.js"><link rel="prefetch" href="/blog/assets/page05.html.8dc876d3.js"><link rel="prefetch" href="/blog/assets/index.html.1faed378.js"><link rel="prefetch" href="/blog/assets/page00.html.397ec4cb.js"><link rel="prefetch" href="/blog/assets/page01.html.d4c49eb5.js"><link rel="prefetch" href="/blog/assets/page02.html.512e9f97.js"><link rel="prefetch" href="/blog/assets/page03.html.07c7a8d5.js"><link rel="prefetch" href="/blog/assets/page04.html.ea9d586c.js"><link rel="prefetch" href="/blog/assets/page05.html.c54831cd.js"><link rel="prefetch" href="/blog/assets/page06.html.130549e7.js"><link rel="prefetch" href="/blog/assets/page07.html.7c7f84ea.js"><link rel="prefetch" href="/blog/assets/page08.html.e3c59864.js"><link rel="prefetch" href="/blog/assets/page09.html.4785a4a4.js"><link rel="prefetch" href="/blog/assets/page10.html.c6168586.js"><link rel="prefetch" href="/blog/assets/page11.html.ce54a18d.js"><link rel="prefetch" href="/blog/assets/page12.html.1814d2d6.js"><link rel="prefetch" href="/blog/assets/page14.html.810a54e6.js"><link rel="prefetch" href="/blog/assets/page15.html.3ad37cea.js"><link rel="prefetch" href="/blog/assets/page16.html.c8b15e87.js"><link rel="prefetch" href="/blog/assets/page17.html.bda23cdd.js"><link rel="prefetch" href="/blog/assets/page18.html.8e431832.js"><link rel="prefetch" href="/blog/assets/page19.html.4f7e6a54.js"><link rel="prefetch" href="/blog/assets/page20.html.53b884d3.js"><link rel="prefetch" href="/blog/assets/page21.html.ea7e75ec.js"><link rel="prefetch" href="/blog/assets/page22.html.6a8a8911.js"><link rel="prefetch" href="/blog/assets/page23.html.4da8711b.js"><link rel="prefetch" href="/blog/assets/page24.html.f15f76b8.js"><link rel="prefetch" href="/blog/assets/page25.html.47a43782.js"><link rel="prefetch" href="/blog/assets/index.html.09d3b996.js"><link rel="prefetch" href="/blog/assets/404.html.265028f6.js"><link rel="prefetch" href="/blog/assets/about.html.7c2de1fc.js"><link rel="prefetch" href="/blog/assets/contact.html.af265cd3.js"><link rel="prefetch" href="/blog/assets/index.html.494633a3.js"><link rel="prefetch" href="/blog/assets/index.html.6f6ef67c.js"><link rel="prefetch" href="/blog/assets/page01.html.24477c8b.js"><link rel="prefetch" href="/blog/assets/index.html.06f044c7.js"><link rel="prefetch" href="/blog/assets/page01.html.2c2c82ac.js"><link rel="prefetch" href="/blog/assets/page02.html.519c6760.js"><link rel="prefetch" href="/blog/assets/page03.html.9c782bee.js"><link rel="prefetch" href="/blog/assets/page04.html.01792834.js"><link rel="prefetch" href="/blog/assets/page05.html.ecd56c0e.js"><link rel="prefetch" href="/blog/assets/index.html.0d805a32.js"><link rel="prefetch" href="/blog/assets/page00.html.b5b8a137.js"><link rel="prefetch" href="/blog/assets/page01.html.196f31d8.js"><link rel="prefetch" href="/blog/assets/page02.html.446eff9c.js"><link rel="prefetch" href="/blog/assets/page03.html.265319dc.js"><link rel="prefetch" href="/blog/assets/page04.html.839ac225.js"><link rel="prefetch" href="/blog/assets/page05.html.3ba90d93.js"><link rel="prefetch" href="/blog/assets/page06.html.5ec3bc24.js"><link rel="prefetch" href="/blog/assets/page07.html.9811e105.js"><link rel="prefetch" href="/blog/assets/page08.html.550b989b.js"><link rel="prefetch" href="/blog/assets/page09.html.e59328fe.js"><link rel="prefetch" href="/blog/assets/page10.html.42d79a00.js"><link rel="prefetch" href="/blog/assets/page11.html.07064880.js"><link rel="prefetch" href="/blog/assets/page12.html.29d2532a.js"><link rel="prefetch" href="/blog/assets/page14.html.ad9dcffb.js"><link rel="prefetch" href="/blog/assets/page15.html.58f3b33b.js"><link rel="prefetch" href="/blog/assets/page16.html.8841620e.js"><link rel="prefetch" href="/blog/assets/page17.html.bc75eefa.js"><link rel="prefetch" href="/blog/assets/page18.html.467eb0c9.js"><link rel="prefetch" href="/blog/assets/page19.html.55cbf803.js"><link rel="prefetch" href="/blog/assets/page20.html.8b45092f.js"><link rel="prefetch" href="/blog/assets/page21.html.cc2b2ea3.js"><link rel="prefetch" href="/blog/assets/page22.html.d7349c76.js"><link rel="prefetch" href="/blog/assets/page23.html.e468a4f1.js"><link rel="prefetch" href="/blog/assets/page24.html.af7dd849.js"><link rel="prefetch" href="/blog/assets/page25.html.b0d918c5.js"><link rel="prefetch" href="/blog/assets/index.html.1b0cec2a.js"><link rel="prefetch" href="/blog/assets/404.html.b1b48cf0.js"><link rel="prefetch" href="/blog/assets/404.515c5f58.js"><link rel="prefetch" href="/blog/assets/Layout.14a38178.js"><link rel="prefetch" href="/blog/assets/auto.esm.36809f22.js"><link rel="prefetch" href="/blog/assets/index.daae04bf.js"><link rel="prefetch" href="/blog/assets/index.1842ee54.js"><link rel="prefetch" href="/blog/assets/mermaid.esm.min.ee1e0284.js">
    <link rel="stylesheet" href="/blog/assets/style.f6d73350.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/blog/" class=""><img class="logo" src="/blog/assets/img/logo.png" alt="Chenxuwkk&#39;s Blog"><span class="site-name can-hide">Chenxuwkk&#39;s Blog</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/blog/" class="" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="导航"><span class="title">导航</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="导航"><span class="title">导航</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/blog/guide/" class="" aria-label="指南"><!--[--><!--]--> 指南 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/blog/study/page01" class="" aria-label="学习记录"><!--[--><!--]--> 学习记录 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/blog/question/page01" class="" aria-label="疑难问题"><!--[--><!--]--> 疑难问题 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/blog/manuscript/page01" class="" aria-label="草稿本"><!--[--><!--]--> 草稿本 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/blog/contact" class="" aria-label="联系本人"><!--[--><!--]--> 联系本人 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/blog/about/" class="" aria-label="关于"><!--[--><!--]--> 关于 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/Chenxuwkk" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container"></div></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/blog/" class="" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="导航"><span class="title">导航</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="导航"><span class="title">导航</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/blog/guide/" class="" aria-label="指南"><!--[--><!--]--> 指南 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/blog/study/page01" class="" aria-label="学习记录"><!--[--><!--]--> 学习记录 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/blog/question/page01" class="" aria-label="疑难问题"><!--[--><!--]--> 疑难问题 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/blog/manuscript/page01" class="" aria-label="草稿本"><!--[--><!--]--> 草稿本 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/blog/contact" class="" aria-label="联系本人"><!--[--><!--]--> 联系本人 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/blog/about/" class="" aria-label="关于"><!--[--><!--]--> 关于 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/Chenxuwkk" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><a href="/blog/guide/" class="sidebar-item sidebar-heading" aria-label="指南"><!--[--><!--]--> 指南 <!--[--><!--]--></a><!----></li><li><p tabindex="0" class="sidebar-item sidebar-heading active">学习记录 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/blog/study/page01.html" class="sidebar-item" aria-label="Vuepress部署"><!--[--><!--]--> Vuepress部署 <!--[--><!--]--></a><!----></li><li><a href="/blog/study/page03.html" class="sidebar-item" aria-label="Linux 命令"><!--[--><!--]--> Linux 命令 <!--[--><!--]--></a><!----></li><li><a href="/blog/study/page02.html" class="sidebar-item" aria-label="C语言预处理"><!--[--><!--]--> C语言预处理 <!--[--><!--]--></a><!----></li><li><a href="/blog/study/page04.html" class="sidebar-item" aria-label="C语言位运算"><!--[--><!--]--> C语言位运算 <!--[--><!--]--></a><!----></li><li><a href="/blog/study/page05.html" class="sidebar-item" aria-label="C语言指针"><!--[--><!--]--> C语言指针 <!--[--><!--]--></a><!----></li><li><a href="/blog/study/page07.html" class="sidebar-item" aria-label="C语言动态内存"><!--[--><!--]--> C语言动态内存 <!--[--><!--]--></a><!----></li><li><a href="/blog/study/page08.html" class="sidebar-item" aria-label="C语言字符串处理"><!--[--><!--]--> C语言字符串处理 <!--[--><!--]--></a><!----></li><li><a href="/blog/study/page09.html" class="sidebar-item" aria-label="C语言结构体详解"><!--[--><!--]--> C语言结构体详解 <!--[--><!--]--></a><!----></li><li><a href="/blog/study/page10.html" class="sidebar-item" aria-label="C语言链表"><!--[--><!--]--> C语言链表 <!--[--><!--]--></a><!----></li><li><a href="/blog/study/page21.html" class="sidebar-item" aria-label="C++对C语言的加强"><!--[--><!--]--> C++对C语言的加强 <!--[--><!--]--></a><!----></li><li><a href="/blog/study/page06.html" class="sidebar-item" aria-label="Markdown高级技巧"><!--[--><!--]--> Markdown高级技巧 <!--[--><!--]--></a><!----></li><li><a href="/blog/study/page11.html" class="sidebar-item" aria-label="Makefile"><!--[--><!--]--> Makefile <!--[--><!--]--></a><!----></li><li><a href="/blog/study/page12.html" class="sidebar-item" aria-label="C51"><!--[--><!--]--> C51 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/study/page13.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="STM32"><!--[--><!--]--> STM32 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog/study/page13.html#stm32-最小系统构成" class="router-link-active router-link-exact-active sidebar-item" aria-label="STM32 最小系统构成"><!--[--><!--]--> STM32 最小系统构成 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog/study/page13.html#晶振电路" class="router-link-active router-link-exact-active sidebar-item" aria-label="晶振电路"><!--[--><!--]--> 晶振电路 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/study/page13.html#复位电路" class="router-link-active router-link-exact-active sidebar-item" aria-label="复位电路"><!--[--><!--]--> 复位电路 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/study/page13.html#电源电路" class="router-link-active router-link-exact-active sidebar-item" aria-label="电源电路"><!--[--><!--]--> 电源电路 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/blog/study/page13.html#存储器映射" class="router-link-active router-link-exact-active sidebar-item" aria-label="存储器映射"><!--[--><!--]--> 存储器映射 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/study/page13.html#寄存器封装" class="router-link-active router-link-exact-active sidebar-item" aria-label="寄存器封装"><!--[--><!--]--> 寄存器封装 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/study/page13.html#启动文件" class="router-link-active router-link-exact-active sidebar-item" aria-label="启动文件"><!--[--><!--]--> 启动文件 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/study/page13.html#gpio工作模式" class="router-link-active router-link-exact-active sidebar-item" aria-label="GPIO工作模式"><!--[--><!--]--> GPIO工作模式 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog/study/page13.html#gpio初始化步骤" class="router-link-active router-link-exact-active sidebar-item" aria-label="GPIO初始化步骤"><!--[--><!--]--> GPIO初始化步骤 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/blog/study/page13.html#led点灯、模板创建" class="router-link-active router-link-exact-active sidebar-item" aria-label="LED点灯、模板创建"><!--[--><!--]--> LED点灯、模板创建 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog/study/page13.html#主程序" class="router-link-active router-link-exact-active sidebar-item" aria-label="主程序"><!--[--><!--]--> 主程序 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/study/page13.html#小结" class="router-link-active router-link-exact-active sidebar-item" aria-label="小结"><!--[--><!--]--> 小结 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/blog/study/page13.html#时钟系统" class="router-link-active router-link-exact-active sidebar-item" aria-label="时钟系统"><!--[--><!--]--> 时钟系统 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/study/page13.html#位带操作" class="router-link-active router-link-exact-active sidebar-item" aria-label="位带操作"><!--[--><!--]--> 位带操作 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog/study/page13.html#宏定义位带实现" class="router-link-active router-link-exact-active sidebar-item" aria-label="宏定义位带实现"><!--[--><!--]--> 宏定义位带实现 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/study/page13.html#宏定义库函数实现" class="router-link-active router-link-exact-active sidebar-item" aria-label="宏定义库函数实现"><!--[--><!--]--> 宏定义库函数实现 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/blog/study/page13.html#systick定时器" class="router-link-active router-link-exact-active sidebar-item" aria-label="SysTick定时器"><!--[--><!--]--> SysTick定时器 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/blog/study/page14.html" class="sidebar-item" aria-label="嵌入式小记"><!--[--><!--]--> 嵌入式小记 <!--[--><!--]--></a><!----></li><li><a href="/blog/study/page15.html" class="sidebar-item" aria-label="IMRD"><!--[--><!--]--> IMRD <!--[--><!--]--></a><!----></li><li><a href="/blog/study/page17.html" class="sidebar-item" aria-label="Paxos算法"><!--[--><!--]--> Paxos算法 <!--[--><!--]--></a><!----></li><li><a href="/blog/study/page18.html" class="sidebar-item" aria-label="STL"><!--[--><!--]--> STL <!--[--><!--]--></a><!----></li><li><a href="/blog/study/page19.html" class="sidebar-item" aria-label="Python"><!--[--><!--]--> Python <!--[--><!--]--></a><!----></li><li><a href="/blog/study/page16.html" class="sidebar-item" aria-label="Leetcode"><!--[--><!--]--> Leetcode <!--[--><!--]--></a><!----></li><li><a href="/blog/study/page20.html" class="sidebar-item" aria-label="剑指Offer"><!--[--><!--]--> 剑指Offer <!--[--><!--]--></a><!----></li><li><a href="/blog/study/page22.html" class="sidebar-item" aria-label="剑指Offer II"><!--[--><!--]--> 剑指Offer II <!--[--><!--]--></a><!----></li><li><a href="/blog/study/page23.html" class="sidebar-item" aria-label="二分专项"><!--[--><!--]--> 二分专项 <!--[--><!--]--></a><!----></li><li><a href="/blog/study/page24.html" class="sidebar-item" aria-label="动态规划专项"><!--[--><!--]--> 动态规划专项 <!--[--><!--]--></a><!----></li><li><a href="/blog/study/page25.html" class="sidebar-item" aria-label="SQL"><!--[--><!--]--> SQL <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">疑难问题 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/blog/question/page01.html" class="sidebar-item" aria-label="Git同步 😄"><!--[--><!--]--> Git同步 😄 <!--[--><!--]--></a><!----></li><li><a href="/blog/question/page02.html" class="sidebar-item" aria-label="Ubantu内存重新分配（Vmware） 🍎"><!--[--><!--]--> Ubantu内存重新分配（Vmware） 🍎 <!--[--><!--]--></a><!----></li><li><a href="/blog/question/page03.html" class="sidebar-item" aria-label="一个个小坑（Vue） 💢"><!--[--><!--]--> 一个个小坑（Vue） 💢 <!--[--><!--]--></a><!----></li><li><a href="/blog/question/page04.html" class="sidebar-item" aria-label="VSCode编译C\C++"><!--[--><!--]--> VSCode编译C\C++ <!--[--><!--]--></a><!----></li><li><a href="/blog/question/page05.html" class="sidebar-item" aria-label="代码复现问题"><!--[--><!--]--> 代码复现问题 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/blog/manuscript/page01" class="sidebar-item sidebar-heading" aria-label="草稿本"><!--[--><!--]--> 草稿本 <!--[--><!--]--></a><!----></li><li><a href="/blog/contact" class="sidebar-item sidebar-heading collapsible" aria-label="联系本人"><!--[--><!--]--> 联系本人 <!--[--><!--]--></a><!----></li><li><a href="/blog/about" class="sidebar-item sidebar-heading" aria-label="关于"><!--[--><!--]--> 关于 <!--[--><!--]--></a><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="stm32" tabindex="-1"><a class="header-anchor" href="#stm32" aria-hidden="true">#</a> STM32</h1><hr><nav class="table-of-contents"><ul><li><a aria-current="page" href="/blog/study/page13.html#stm32-最小系统构成" class="router-link-active router-link-exact-active">STM32 最小系统构成</a><ul><li><a aria-current="page" href="/blog/study/page13.html#晶振电路" class="router-link-active router-link-exact-active">晶振电路</a></li><li><a aria-current="page" href="/blog/study/page13.html#复位电路" class="router-link-active router-link-exact-active">复位电路</a></li><li><a aria-current="page" href="/blog/study/page13.html#电源电路" class="router-link-active router-link-exact-active">电源电路</a></li></ul></li><li><a aria-current="page" href="/blog/study/page13.html#存储器映射" class="router-link-active router-link-exact-active">存储器映射</a></li><li><a aria-current="page" href="/blog/study/page13.html#寄存器封装" class="router-link-active router-link-exact-active">寄存器封装</a></li><li><a aria-current="page" href="/blog/study/page13.html#启动文件" class="router-link-active router-link-exact-active">启动文件</a></li><li><a aria-current="page" href="/blog/study/page13.html#gpio工作模式" class="router-link-active router-link-exact-active">GPIO工作模式</a><ul><li><a aria-current="page" href="/blog/study/page13.html#gpio初始化步骤" class="router-link-active router-link-exact-active">GPIO初始化步骤</a></li></ul></li><li><a aria-current="page" href="/blog/study/page13.html#led点灯、模板创建" class="router-link-active router-link-exact-active">LED点灯、模板创建</a><ul><li><a aria-current="page" href="/blog/study/page13.html#主程序" class="router-link-active router-link-exact-active">主程序</a></li><li><a aria-current="page" href="/blog/study/page13.html#小结" class="router-link-active router-link-exact-active">小结</a></li></ul></li><li><a aria-current="page" href="/blog/study/page13.html#时钟系统" class="router-link-active router-link-exact-active">时钟系统</a></li><li><a aria-current="page" href="/blog/study/page13.html#位带操作" class="router-link-active router-link-exact-active">位带操作</a><ul><li><a aria-current="page" href="/blog/study/page13.html#宏定义位带实现" class="router-link-active router-link-exact-active">宏定义位带实现</a></li><li><a aria-current="page" href="/blog/study/page13.html#宏定义库函数实现" class="router-link-active router-link-exact-active">宏定义库函数实现</a></li></ul></li><li><a aria-current="page" href="/blog/study/page13.html#systick定时器" class="router-link-active router-link-exact-active">SysTick定时器</a></li></ul></nav><h2 id="stm32-最小系统构成" tabindex="-1"><a class="header-anchor" href="#stm32-最小系统构成" aria-hidden="true">#</a> STM32 最小系统构成</h2><p>若要使系统正常运行，必须确保 STM32 最小系统稳定工作。STM32 最小系统 由以下几部分组成：</p><ol><li>晶振电路</li><li>复位电路</li><li>电源电路</li><li>下载电路（非必须）</li></ol><h3 id="晶振电路" tabindex="-1"><a class="header-anchor" href="#晶振电路" aria-hidden="true">#</a> 晶振电路</h3><p>STM32内部自带时钟源，但通常不使用，而是在单片机主 晶振引脚上外接一个晶振。</p><p>若直接将此晶振接入单片机晶 振引脚，会发现系统工作不稳定，这是因为晶振起振的一瞬间会产生一些电感， 为了消除这个电感所带来的干扰，可以在此晶振两端分别加上一个电容，电容的 选取需要无极性的，另一端需要共地。</p><p>根据选取的晶振大小决定电容值，通常电容可在 <code>10-33PF</code>值范围内选取。</p><p>STM32 芯片上还有一个外设需要晶振，它是 RTC（时钟芯片）。</p><h3 id="复位电路" tabindex="-1"><a class="header-anchor" href="#复位电路" aria-hidden="true">#</a> 复位电路</h3><p>STM32 引脚中有一个 NRST 复位引脚， 而 STM32 是低电平复位，所以需要让这个引脚保持一段时间低电平就可以。</p><p>要实 现此功能通常有两种方式，一种是通过按键进行手动复位，还有一种是上电复位， 即电源开启后自动复位。</p><p>手动复位是通过一个按键及电容电阻所组成，利用按键 的开关功能实现复位，按键按下后 GND 直接接入到单片机 NRST 引脚，松开后 GND 断开，NRST 被电阻拉为高电平。</p><p>自动复位主 要是利用 RC 充放电功能，电源开启，由于电容隔直，GND 直接进入 NRST，然后 电容开始慢慢充电，直到充电完成，此时 NRST 被电阻拉为高电平。这样就起到 上电复位的效果。</p><h3 id="电源电路" tabindex="-1"><a class="header-anchor" href="#电源电路" aria-hidden="true">#</a> 电源电路</h3><p>STM32 的工作电压是 1.8-3.3V 范围，使用 3.3V 直流，将电源接入到芯片电源引脚即可。</p><h2 id="存储器映射" tabindex="-1"><a class="header-anchor" href="#存储器映射" aria-hidden="true">#</a> 存储器映射</h2><p><img src="https://m.360buyimg.com/babel/jfs/t1/186207/3/23255/243656/626689b7Ef35655a1/ea3f241b9ae8437b.png" alt="image-20220425164538149.png"></p><p>4GB 的地址空间中，ARM 已经粗线条的平均分成了 8 个块，每块 512MB，每个块也都规定 了用途，具体分类见表格。每个块的大小都有 512MB，显然这是非常大的，芯片厂商在每个 块的范围内设计各具特色的外设时并不一定都用得完，都是只用了其中的一部分而已。</p><table><thead><tr><th>序号</th><th>用途</th><th>地址范围</th></tr></thead><tbody><tr><td>Block 0</td><td>Code</td><td>0x0000 0000 ~ 0x1FFF FFFF(512MB)</td></tr><tr><td>Block 1</td><td>SRAM</td><td>0x2000 0000 ~ 0x3FFF FFFF(512MB)</td></tr><tr><td>Block 2</td><td>片上外设</td><td>0x4000 0000 ~ 0x5FFF FFFF(512MB)</td></tr><tr><td>Block 3</td><td>FSMC 的 bank1 ~ bank2</td><td>0x6000 0000 ~ 0x7FFF FFFF(512MB)</td></tr><tr><td>Block 4</td><td>FSMC 的 bank3 ~ bank4</td><td>0x8000 0000 ~ 0x9FFF FFFF(512MB)</td></tr><tr><td>Block 5</td><td>FSMC 寄存器</td><td>0xA000 0000 ~ 0xCFFF FFFF(512MB)</td></tr><tr><td>Block 6</td><td>没有使用</td><td>0xD000 0000 ~ 0xDFFF FFFF(512MB)</td></tr><tr><td>Block 7</td><td>Cortex-M4 内部外设</td><td>0xE000 0000 ~ 0xFFFF FFFF(512MB)</td></tr></tbody></table><p><strong>重要</strong>：Block0 用来设计成内部 FLASH，Block1 用来设计成内部 RAM，Block2 用来设计成片上的外设</p><p><strong>Block 1</strong></p><table><thead><tr><th>块</th><th>用途说明</th><th>地址范围</th></tr></thead><tbody><tr><td>Block1</td><td>预留</td><td>0x2003 0000 ~ 0x3FFF FFFF</td></tr><tr><td></td><td>SRAM3 64KB</td><td>0x2002 0000 ~ 0x2002 FFFF</td></tr><tr><td></td><td>SRAM2 16KB</td><td>0x2001 C000 ~ 0x2001 FFFF</td></tr><tr><td></td><td>SRAM1 112KB</td><td>0x2000 0000 ~ 0x2001 BFFF</td></tr></tbody></table><p><strong>Block 2</strong></p><table><thead><tr><th>块</th><th>用途说明</th><th>地址范围</th></tr></thead><tbody><tr><td>Block2</td><td>APB1 总线外设</td><td>0x4000 0000 ~ 0x4000 77FF</td></tr><tr><td></td><td>预留</td><td>0x4000 7800 ~ 0x4000 FFFF</td></tr><tr><td></td><td>APB2 总线外设</td><td>0x4001 0000 ~ 0x4001 57FF</td></tr><tr><td></td><td>预留</td><td>0x4001 5800 ~ 0x4001 FFFF</td></tr><tr><td></td><td>AHB1 总线外设</td><td>0x4002 0000 ~ 0x4007 FFFF</td></tr><tr><td></td><td>预留</td><td>0x4008 0000 ~ 0x4FFF FFFF</td></tr><tr><td></td><td>AHB2 总线外设</td><td>0x5000 0000 ~ 0x5006 0BFF</td></tr><tr><td></td><td>预留</td><td>0x5006 0C00 ~ 0x5FFF FFFF</td></tr></tbody></table><h2 id="寄存器封装" tabindex="-1"><a class="header-anchor" href="#寄存器封装" aria-hidden="true">#</a> 寄存器封装</h2><p>为了更方便地访问寄存器，引入 C 语言中的结构体对寄存器进行 封装，具体代码如下：</p><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token class-name">uint32_t</span><span class="token punctuation">;</span> <span class="token comment">/*无符号 32 位变量*/</span>
<span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">short</span> <span class="token keyword">int</span> <span class="token class-name">uint16_t</span><span class="token punctuation">;</span> <span class="token comment">/*无符号 16 位变量*/</span>
<span class="token comment">/* GPIO 寄存器列表 */</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span>
<span class="token punctuation">{</span>
<span class="token class-name">uint32_t</span> MODER<span class="token punctuation">;</span> <span class="token comment">/*GPIO 模式寄存器 地址偏移: 0x00 */</span>
<span class="token class-name">uint32_t</span> OTYPER<span class="token punctuation">;</span> <span class="token comment">/*GPIO 输出类型寄存器 地址偏移: 0x04 */</span>
<span class="token class-name">uint32_t</span> OSPEEDR<span class="token punctuation">;</span> <span class="token comment">/*GPIO 输出速度寄存器 地址偏移: 0x08 */</span>
<span class="token class-name">uint32_t</span> PUPDR<span class="token punctuation">;</span> <span class="token comment">/*GPIO 上拉/下拉寄存器 地址偏移: 0x0C */</span>
<span class="token class-name">uint32_t</span> IDR<span class="token punctuation">;</span> <span class="token comment">/*GPIO 输入数据寄存器 地址偏移: 0x10 */</span>
<span class="token class-name">uint32_t</span> ODR<span class="token punctuation">;</span> <span class="token comment">/*GPIO 输出数据寄存器 地址偏移: 0x14 */</span>
<span class="token class-name">uint16_t</span> BSRRL<span class="token punctuation">;</span> <span class="token comment">/*GPIO 置位/复位寄存器低 16 位部分 地址偏移:
0x18 */</span>
<span class="token class-name">uint16_t</span> BSRRH<span class="token punctuation">;</span> <span class="token comment">/*GPIO 置位/复位寄存器高 16 位部分 地址偏移:
0x1A */</span>
<span class="token class-name">uint32_t</span> LCKR<span class="token punctuation">;</span> <span class="token comment">/*GPIO 配置锁定寄存器 地址偏移: 0x1C */</span>
<span class="token class-name">uint32_t</span> AFR<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">/*GPIO 复用功能配置寄存器 地址偏移: 0x20-0x24
*/</span>
<span class="token punctuation">}</span>GPIO_TypeDef<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这段代码用<code>typedef</code>关键字声明了名为<code>GPIO_TypeDef</code>的结构体类型，结 构体内有 8 个成员变量，变量名正好对应寄存器的名字。C 语言的语法规定， 结构体内变量的存储空间是连续的，其中 32 位的变量占用 4 个字节，16 位的变 量占用 2 个字节。</p><p>也就是说，我们定义的这个 <code>GPIO_TypeDef </code>，假如这个结构体的首地址为<code>0x4002 0400</code>（这也是第一个成员变量<code>MODER</code>的地址），那么结构体中第二个成 员变量 <code>OTYPER</code> 的地址即为<code> 0x4002 0400 +0x04</code> ，加上的这个<code>0x04</code> ，正是代 表 <code>MODER</code> 所占用的 4 个字节地址的偏移量，其它成员变量相对于结构体首地址 的偏移，在上述代码右侧注释已给出，其中的 <code>BSRR</code> 寄存器分成了低 16 位 <code>BSRRL</code> 和高 16 位 <code>BSRRH</code>， <code>BSRRL</code> 置 1 引脚输出高电平，<code>BSRRH</code> 置 1 引脚输出 低电平，这里分开只是为了方便操作。</p><p>这样的地址偏移与 <code>STM32 GPIO</code> 外设定义的寄存器地址偏移一一对应，只要 给结构体设置好首地址，就能把结构体内成员的地址确定下来，然后就能以结构 体的形式访问寄存器了，比如我们还是将 <code>GPIOB0</code> 输出低电平，具体代码如下：</p><div class="custom-container tip"><p class="custom-container-title">个人理解</p><p>巧妙使用结构体分配空间的连续性，将偏移地址于结构体成员对应起来</p></div><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code>GPIO_TypeDef <span class="token operator">*</span> GPIOx<span class="token punctuation">;</span> <span class="token comment">//定义一个 GPIO_TypeDef 型结构体指针 GPIOx</span>
GPIOx <span class="token operator">=</span> GPIOB_BASE<span class="token punctuation">;</span> <span class="token comment">//把指针地址设置为宏 GPIOB_BASE 地址</span>
GPIOx<span class="token operator">-&gt;</span>BSRRL <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0x01</span><span class="token operator">&lt;&lt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//通过指针访问并修改 GPIOB_BSRRL 寄存</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这段代码先用<code>GPIO_TypeDef</code> 类型定义一个结构体指针 <code>GPIOx</code>，并让指针指 向 <code>GPIOB</code> 基地址 <code>GPIOB_BASE</code>，地址确定下来，然后根据 C 语言访问结构体的内容，用 <code>GPIOx-&gt;BSRR</code> 写寄存器。为了操作更简便灵活，我们直接使用宏定义好 <code>GPIO_TypeDef</code> 类型的指针，而且指针指向各个 <code>GPIO</code> 端口的首地址，使用时我们直接用该宏访问寄存器即可。具体代码如下：</p><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIOA</span> <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span>GPIO_TypeDef <span class="token operator">*</span><span class="token punctuation">)</span> GPIOA_BASE<span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIOB</span> <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span>GPIO_TypeDef <span class="token operator">*</span><span class="token punctuation">)</span> GPIOB_BASE<span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIOC</span> <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span>GPIO_TypeDef <span class="token operator">*</span><span class="token punctuation">)</span> GPIOC_BASE<span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIOD</span> <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span>GPIO_TypeDef <span class="token operator">*</span><span class="token punctuation">)</span> GPIOD_BASE<span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIOE</span> <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span>GPIO_TypeDef <span class="token operator">*</span><span class="token punctuation">)</span> GPIOE_BASE<span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIOF</span> <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span>GPIO_TypeDef <span class="token operator">*</span><span class="token punctuation">)</span> GPIOF_BASE<span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIOG</span> <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span>GPIO_TypeDef <span class="token operator">*</span><span class="token punctuation">)</span> GPIOG_BASE<span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIOH</span> <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span>GPIO_TypeDef <span class="token operator">*</span><span class="token punctuation">)</span> GPIOH_BASE<span class="token punctuation">)</span></span></span>
GPIOB<span class="token operator">-&gt;</span>BSRRL <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0x01</span><span class="token operator">&lt;&lt;</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="启动文件" tabindex="-1"><a class="header-anchor" href="#启动文件" aria-hidden="true">#</a> 启动文件</h2><p><code>startup_stm32f429xxx.s</code></p><p>先执行<code>SystemInit()</code></p><ol><li>初始化堆栈指针SP</li><li>初始化PC指针</li><li>初始化中断向量表</li><li>初始化系统时钟</li><li>调用<code>main()</code></li></ol><h2 id="gpio工作模式" tabindex="-1"><a class="header-anchor" href="#gpio工作模式" aria-hidden="true">#</a> GPIO工作模式</h2><ol><li>输入模式（上拉、下拉、浮空）</li><li>输出模式（推挽/开漏、上拉/下拉）</li><li>复用功能（推挽/开漏、上拉/下拉）</li><li>模拟输入输出（上下拉无影响）</li></ol><h3 id="gpio初始化步骤" tabindex="-1"><a class="header-anchor" href="#gpio初始化步骤" aria-hidden="true">#</a> GPIO初始化步骤</h3><ol><li>确定GPIO是输入、通用输出、复用功能还是模拟输入（模式寄存器：MODER）</li><li>如果输出还要确定是推挽输出还是开漏输出（输出类型寄存器 ：OTYPER）</li><li>配置输出的速度（输出速度寄存器：OSPEEDR）</li><li>输出的时候内部的上/下拉电阻要不要开启（上拉/下拉寄存器：PUPDR）</li><li>具体要输出的内容（置位复位寄存器：BSRR和数据输出寄存器：ODR）</li></ol><p><strong>举例</strong></p><table><thead><tr><th>寄存器名称</th><th>寄存器地址</th><th>相对 GPIOB基址的偏移</th></tr></thead><tbody><tr><td>GPIOF_MODER</td><td>0x4002 1400</td><td>0x00</td></tr><tr><td>GPIOF_OTYPER</td><td>0x4002 1404</td><td>0x04</td></tr><tr><td>GPIOF_OSPEEDR</td><td>0x4002 1408</td><td>0x08</td></tr><tr><td>GPIOF_PUPDR</td><td>0x4002 140C</td><td>0x0C</td></tr><tr><td>GPIOF_IDR</td><td>0x4002 1410</td><td>0x10</td></tr><tr><td>GPIOF_ODR</td><td>0x4002 1414</td><td>0x14</td></tr><tr><td>GPIOF_BSRR</td><td>0x4002 1418</td><td>0x18</td></tr><tr><td>GPIOF_LCKR</td><td>0x4002 141C</td><td>0x1C</td></tr><tr><td>GPIOF_AFRL</td><td>0x4002 1420</td><td>0x20</td></tr><tr><td>GPIOF_AFRH</td><td>0x4002 1424</td><td>0x24</td></tr></tbody></table><h2 id="led点灯、模板创建" tabindex="-1"><a class="header-anchor" href="#led点灯、模板创建" aria-hidden="true">#</a> LED点灯、模板创建</h2><p><strong>文件结构</strong></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>//树形结构
<span class="token builtin class-name">.</span>
├─APP			 			<span class="token comment">#存放外设驱动</span>
│  └─LED					<span class="token comment">#LED外设</span>
├─DebugConfig				<span class="token comment">#MDK自动生成</span>
├─Libraries					<span class="token comment">#HAL库移植文件夹</span>
│  ├─CMSIS					<span class="token comment">#符合CMSIS标准的core 和 startup文件</span>
│  └─STM32F4xx_HAL_Driver	<span class="token comment">#HAL库驱动（直接复制）</span>
│      ├─Inc
│      │  └─Legacy
│      └─Src
├─Obj						<span class="token comment">#MDK产生文件</span>
├─Public					<span class="token comment">#System文件</span>
└─User						<span class="token comment">#主函数、HAL_conf、HAL_msp（回调）、中断、stm32f4xx等</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="主程序" tabindex="-1"><a class="header-anchor" href="#主程序" aria-hidden="true">#</a> 主程序</h3><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">//main.c</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;system.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;led.h&quot;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	
	<span class="token function">HAL_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                     <span class="token comment">//初始化HAL库 </span>
	<span class="token function">SystemClock_Init</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">,</span><span class="token number">360</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//设置时钟,180Mhz</span>
	<span class="token function">LED_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//LED初始化</span>
	
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">HAL_GPIO_WritePin</span><span class="token punctuation">(</span>GPIOB<span class="token punctuation">,</span>GPIO_PIN_1<span class="token punctuation">,</span>GPIO_PIN_RESET<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//PB1输出低</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">//led.c</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;led.h&quot;</span></span>

<span class="token keyword">void</span> <span class="token function">LED_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//定义放到最前面</span>
	GPIO_InitTypeDef GPIO_InitStructure<span class="token punctuation">;</span>
	
	<span class="token function">__HAL_RCC_GPIOB_CLK_ENABLE</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//使能GPIOB时钟</span>
	<span class="token comment">//先配置好一个结构体</span>
	GPIO_InitStructure<span class="token punctuation">.</span>Pin<span class="token operator">=</span>GPIO_PIN_0<span class="token operator">|</span>GPIO_PIN_1<span class="token punctuation">;</span> <span class="token comment">//PB0,1</span>
    GPIO_InitStructure<span class="token punctuation">.</span>Mode<span class="token operator">=</span>GPIO_MODE_OUTPUT_PP<span class="token punctuation">;</span>  <span class="token comment">//推挽输出</span>
    GPIO_InitStructure<span class="token punctuation">.</span>Pull<span class="token operator">=</span>GPIO_PULLUP<span class="token punctuation">;</span>          <span class="token comment">//上拉</span>
    GPIO_InitStructure<span class="token punctuation">.</span>Speed<span class="token operator">=</span>GPIO_SPEED_HIGH<span class="token punctuation">;</span>     <span class="token comment">//高速</span>
    <span class="token comment">//然后一股脑的塞入Init函数</span>
    <span class="token function">HAL_GPIO_Init</span><span class="token punctuation">(</span>GPIOB<span class="token punctuation">,</span><span class="token operator">&amp;</span>GPIO_InitStructure<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token function">HAL_GPIO_WritePin</span><span class="token punctuation">(</span>GPIOB<span class="token punctuation">,</span>GPIO_PIN_0<span class="token punctuation">,</span>GPIO_PIN_SET<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//PB0输出高</span>
	<span class="token function">HAL_GPIO_WritePin</span><span class="token punctuation">(</span>GPIOB<span class="token punctuation">,</span>GPIO_PIN_1<span class="token punctuation">,</span>GPIO_PIN_SET<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//PB1输出高</span>
<span class="token punctuation">}</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">//led.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">_led_H</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_led_H</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;system.h&quot;</span></span>


<span class="token keyword">void</span> <span class="token function">LED_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">//system.c</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;system.h&quot;</span></span>



<span class="token comment">//时钟系统配置函数</span>
<span class="token comment">//Fvco=Fs*(plln/pllm);</span>
<span class="token comment">//SYSCLK=Fvco/pllp=Fs*(plln/(pllm*pllp));</span>
<span class="token comment">//Fusb=Fvco/pllq=Fs*(plln/(pllm*pllq));</span>

<span class="token comment">//Fvco:VCO频率</span>
<span class="token comment">//SYSCLK:系统时钟频率</span>
<span class="token comment">//Fusb:USB,SDIO,RNG等的时钟频率</span>
<span class="token comment">//Fs:PLL输入时钟频率,可以是HSI,HSE等. </span>
<span class="token comment">//pllm:主PLL和音频PLL分频系数(PLL之前的分频),取值范围:2~63.</span>
<span class="token comment">//plln:主PLL倍频系数(PLL倍频),取值范围:64~432.</span>
<span class="token comment">//pllp:系统时钟的主PLL分频系数(PLL之后的分频),取值范围:2,4,6,8.(仅限这4个值!)</span>
<span class="token comment">//pllq:USB/SDIO/随机数产生器等的主PLL分频系数(PLL之后的分频),取值范围:2~15.</span>

<span class="token comment">//外部晶振为25M的时候,推荐值:pllm=25,plln=360,pllp=2,pllq=8.</span>
<span class="token comment">//得到:Fvco=25*(360/25)=360Mhz</span>
<span class="token comment">//     SYSCLK=360/2=180Mhz</span>
<span class="token comment">//     Fusb=360/8=45Mhz</span>
<span class="token comment">//返回值:0,成功;1,失败</span>
<span class="token keyword">void</span> <span class="token function">SystemClock_Init</span><span class="token punctuation">(</span>u32 pllm<span class="token punctuation">,</span>u32 plln<span class="token punctuation">,</span>u32 pllp<span class="token punctuation">,</span>u32 pllq<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    HAL_StatusTypeDef ret <span class="token operator">=</span> HAL_OK<span class="token punctuation">;</span>
    RCC_OscInitTypeDef RCC_OscInitStructure<span class="token punctuation">;</span> 
    RCC_ClkInitTypeDef RCC_ClkInitStructure<span class="token punctuation">;</span>
    
    <span class="token function">__HAL_RCC_PWR_CLK_ENABLE</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//使能PWR时钟</span>
    
    <span class="token comment">//下面这个设置用来设置调压器输出电压级别，以便在器件未以最大频率工作</span>
    <span class="token comment">//时使性能与功耗实现平衡，此功能只有STM32F42xx和STM32F43xx器件有，</span>
    <span class="token function">__HAL_PWR_VOLTAGESCALING_CONFIG</span><span class="token punctuation">(</span>PWR_REGULATOR_VOLTAGE_SCALE1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//设置调压器输出电压级别1</span>
    
    RCC_OscInitStructure<span class="token punctuation">.</span>OscillatorType<span class="token operator">=</span>RCC_OSCILLATORTYPE_HSE<span class="token punctuation">;</span>    <span class="token comment">//时钟源为HSE</span>
    RCC_OscInitStructure<span class="token punctuation">.</span>HSEState<span class="token operator">=</span>RCC_HSE_ON<span class="token punctuation">;</span>                      <span class="token comment">//打开HSE</span>
    RCC_OscInitStructure<span class="token punctuation">.</span>PLL<span class="token punctuation">.</span>PLLState<span class="token operator">=</span>RCC_PLL_ON<span class="token punctuation">;</span><span class="token comment">//打开PLL</span>
    RCC_OscInitStructure<span class="token punctuation">.</span>PLL<span class="token punctuation">.</span>PLLSource<span class="token operator">=</span>RCC_PLLSOURCE_HSE<span class="token punctuation">;</span><span class="token comment">//PLL时钟源选择HSE</span>
    RCC_OscInitStructure<span class="token punctuation">.</span>PLL<span class="token punctuation">.</span>PLLM<span class="token operator">=</span>pllm<span class="token punctuation">;</span> <span class="token comment">//主PLL和音频PLL分频系数(PLL之前的分频),取值范围:2~63.</span>
    RCC_OscInitStructure<span class="token punctuation">.</span>PLL<span class="token punctuation">.</span>PLLN<span class="token operator">=</span>plln<span class="token punctuation">;</span> <span class="token comment">//主PLL倍频系数(PLL倍频),取值范围:64~432.  </span>
    RCC_OscInitStructure<span class="token punctuation">.</span>PLL<span class="token punctuation">.</span>PLLP<span class="token operator">=</span>pllp<span class="token punctuation">;</span> <span class="token comment">//系统时钟的主PLL分频系数(PLL之后的分频),取值范围:2,4,6,8.(仅限这4个值!)</span>
    RCC_OscInitStructure<span class="token punctuation">.</span>PLL<span class="token punctuation">.</span>PLLQ<span class="token operator">=</span>pllq<span class="token punctuation">;</span> <span class="token comment">//USB/SDIO/随机数产生器等的主PLL分频系数(PLL之后的分频),取值范围:2~15.</span>
    ret<span class="token operator">=</span><span class="token function">HAL_RCC_OscConfig</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>RCC_OscInitStructure<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//初始化</span>
	
    <span class="token keyword">if</span><span class="token punctuation">(</span>ret<span class="token operator">!=</span>HAL_OK<span class="token punctuation">)</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    ret<span class="token operator">=</span><span class="token function">HAL_PWREx_EnableOverDrive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//开启Over-Driver功能</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>ret<span class="token operator">!=</span>HAL_OK<span class="token punctuation">)</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">//选中PLL作为系统时钟源并且配置HCLK,PCLK1和PCLK2</span>
    RCC_ClkInitStructure<span class="token punctuation">.</span>ClockType<span class="token operator">=</span><span class="token punctuation">(</span>RCC_CLOCKTYPE_SYSCLK<span class="token operator">|</span>RCC_CLOCKTYPE_HCLK<span class="token operator">|</span>RCC_CLOCKTYPE_PCLK1<span class="token operator">|</span>RCC_CLOCKTYPE_PCLK2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    RCC_ClkInitStructure<span class="token punctuation">.</span>SYSCLKSource<span class="token operator">=</span>RCC_SYSCLKSOURCE_PLLCLK<span class="token punctuation">;</span><span class="token comment">//设置系统时钟时钟源为PLL</span>
    RCC_ClkInitStructure<span class="token punctuation">.</span>AHBCLKDivider<span class="token operator">=</span>RCC_SYSCLK_DIV1<span class="token punctuation">;</span><span class="token comment">//AHB分频系数为1</span>
    RCC_ClkInitStructure<span class="token punctuation">.</span>APB1CLKDivider<span class="token operator">=</span>RCC_HCLK_DIV4<span class="token punctuation">;</span> <span class="token comment">//APB1分频系数为4</span>
    RCC_ClkInitStructure<span class="token punctuation">.</span>APB2CLKDivider<span class="token operator">=</span>RCC_HCLK_DIV2<span class="token punctuation">;</span> <span class="token comment">//APB2分频系数为2</span>
    ret<span class="token operator">=</span><span class="token function">HAL_RCC_ClockConfig</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>RCC_ClkInitStructure<span class="token punctuation">,</span>FLASH_LATENCY_5<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//同时设置FLASH延时周期为5WS，也就是6个CPU周期。</span>
		
    <span class="token keyword">if</span><span class="token punctuation">(</span>ret<span class="token operator">!=</span>HAL_OK<span class="token punctuation">)</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">//system.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">__system_H</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">__system_H</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;stm32f4xx.h&quot;</span></span>


<span class="token comment">//定义一些常用的数据类型短关键字 </span>
<span class="token keyword">typedef</span> <span class="token class-name">int32_t</span>  s32<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> <span class="token class-name">int16_t</span> s16<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> <span class="token class-name">int8_t</span>  s8<span class="token punctuation">;</span>

<span class="token keyword">typedef</span> <span class="token keyword">const</span> <span class="token class-name">int32_t</span> sc32<span class="token punctuation">;</span>  
<span class="token keyword">typedef</span> <span class="token keyword">const</span> <span class="token class-name">int16_t</span> sc16<span class="token punctuation">;</span>  
<span class="token keyword">typedef</span> <span class="token keyword">const</span> <span class="token class-name">int8_t</span> sc8<span class="token punctuation">;</span>  

<span class="token keyword">typedef</span> __IO <span class="token class-name">int32_t</span>  vs32<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> __IO <span class="token class-name">int16_t</span>  vs16<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> __IO <span class="token class-name">int8_t</span>   vs8<span class="token punctuation">;</span>

<span class="token keyword">typedef</span> __I <span class="token class-name">int32_t</span> vsc32<span class="token punctuation">;</span>  
<span class="token keyword">typedef</span> __I <span class="token class-name">int16_t</span> vsc16<span class="token punctuation">;</span> 
<span class="token keyword">typedef</span> __I <span class="token class-name">int8_t</span> vsc8<span class="token punctuation">;</span>   

<span class="token keyword">typedef</span> <span class="token class-name">uint32_t</span>  u32<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> <span class="token class-name">uint16_t</span> u16<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> <span class="token class-name">uint8_t</span>  u8<span class="token punctuation">;</span>

<span class="token keyword">typedef</span> <span class="token keyword">const</span> <span class="token class-name">uint32_t</span> uc32<span class="token punctuation">;</span>  
<span class="token keyword">typedef</span> <span class="token keyword">const</span> <span class="token class-name">uint16_t</span> uc16<span class="token punctuation">;</span>  
<span class="token keyword">typedef</span> <span class="token keyword">const</span> <span class="token class-name">uint8_t</span> uc8<span class="token punctuation">;</span> 

<span class="token keyword">typedef</span> __IO <span class="token class-name">uint32_t</span>  vu32<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> __IO <span class="token class-name">uint16_t</span> vu16<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> __IO <span class="token class-name">uint8_t</span>  vu8<span class="token punctuation">;</span>

<span class="token keyword">typedef</span> __I <span class="token class-name">uint32_t</span> vuc32<span class="token punctuation">;</span>  
<span class="token keyword">typedef</span> __I <span class="token class-name">uint16_t</span> vuc16<span class="token punctuation">;</span> 
<span class="token keyword">typedef</span> __I <span class="token class-name">uint8_t</span> vuc8<span class="token punctuation">;</span>


<span class="token keyword">void</span> <span class="token function">SystemClock_Init</span><span class="token punctuation">(</span>u32 pllm<span class="token punctuation">,</span>u32 plln<span class="token punctuation">,</span>u32 pllp<span class="token punctuation">,</span>u32 pllq<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="小结" tabindex="-1"><a class="header-anchor" href="#小结" aria-hidden="true">#</a> 小结</h3><p><code>__HAL_RCC_GPIOB_CLK_ENABLE();</code>先时钟使能</p><p><code>HAL_GPIO_WritePin( GPIOB, GPIO_PIN_0, GPIO_PIN_SET);</code></p><p><code>HAL_GPIO_TogglePin(GPIOB, GPIO_PIN_1);</code>翻转</p><p><code>HAL_GPIO_ReadPin(GPIOB, GPIO_PIN_1);</code></p><div class="custom-container tip"><p class="custom-container-title">个人理解</p><p>先定义一个结构体，把该结构体实例化，然后打包送到初始化函数里</p></div><h2 id="时钟系统" tabindex="-1"><a class="header-anchor" href="#时钟系统" aria-hidden="true">#</a> 时钟系统</h2><p><img src="https://m.360buyimg.com/babel/jfs/t1/103268/17/28376/186306/626689b5Ee8d230bd/0e2a57459bc507b2.png" alt="image-20220425155443678.png"></p><p><img src="https://m.360buyimg.com/babel/jfs/t1/183536/34/25662/201871/626689b4E7a7c1a93/09e850c87d6bc818.png" alt="image-20220425155633584.png"></p><p>详细看开发指南（系统时钟）</p><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">//main.c</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;system.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;led.h&quot;</span></span>

<span class="token keyword">void</span> <span class="token function">delay</span><span class="token punctuation">(</span>u32 i<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span>i<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>



<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>

    <span class="token function">HAL_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                     <span class="token comment">//初始化HAL库</span>
    <span class="token comment">//设置时钟  ((25/m) * n)/p=180  m=25 n=360 p=2</span>
    <span class="token function">SystemClock_Init</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">384</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//192Mhz</span>
    <span class="token function">LED_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
		<span class="token function">HAL_GPIO_TogglePin</span><span class="token punctuation">(</span>GPIOB<span class="token punctuation">,</span> GPIO_PIN_0<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">0x7fffff</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">HAL_GPIO_TogglePin</span><span class="token punctuation">(</span>GPIOB<span class="token punctuation">,</span> GPIO_PIN_1<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">0x7fffff</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">//system.c</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;system.h&quot;</span></span>

<span class="token comment">//时钟系统配置函数</span>
<span class="token comment">//Fvco=Fs*(plln/pllm);</span>
<span class="token comment">//SYSCLK=Fvco/pllp=Fs*(plln/(pllm*pllp));</span>
<span class="token comment">//Fusb=Fvco/pllq=Fs*(plln/(pllm*pllq));</span>

<span class="token comment">//Fvco:VCO频率</span>
<span class="token comment">//SYSCLK:系统时钟频率</span>
<span class="token comment">//Fusb:USB,SDIO,RNG等的时钟频率</span>
<span class="token comment">//Fs:PLL输入时钟频率,可以是HSI,HSE等.</span>
<span class="token comment">//pllm:主PLL和音频PLL分频系数(PLL之前的分频),取值范围:2~63.</span>
<span class="token comment">//plln:主PLL倍频系数(PLL倍频),取值范围:64~432.</span>
<span class="token comment">//pllp:系统时钟的主PLL分频系数(PLL之后的分频),取值范围:2,4,6,8.(仅限这4个值!)</span>
<span class="token comment">//pllq:USB/SDIO/随机数产生器等的主PLL分频系数(PLL之后的分频),取值范围:2~15.</span>

<span class="token comment">//外部晶振为25M的时候,推荐值:pllm=25,plln=360,pllp=2,pllq=8.</span>
<span class="token comment">//得到:Fvco=25*(360/25)=360Mhz</span>
<span class="token comment">//     SYSCLK=360/2=180Mhz</span>
<span class="token comment">//     Fusb=360/8=45Mhz</span>
<span class="token comment">//返回值:0,成功;1,失败</span>
<span class="token keyword">void</span> <span class="token function">SystemClock_Init</span><span class="token punctuation">(</span>u32 pllm<span class="token punctuation">,</span> u32 plln<span class="token punctuation">,</span> u32 pllp<span class="token punctuation">,</span> u32 pllq<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    HAL_StatusTypeDef ret <span class="token operator">=</span> HAL_OK<span class="token punctuation">;</span>
    RCC_OscInitTypeDef RCC_OscInitStructure<span class="token punctuation">;</span>
    RCC_ClkInitTypeDef RCC_ClkInitStructure<span class="token punctuation">;</span>

    <span class="token function">__HAL_RCC_PWR_CLK_ENABLE</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//使能PWR时钟</span>

    <span class="token comment">//下面这个设置用来设置调压器输出电压级别，以便在器件未以最大频率工作</span>
    <span class="token comment">//时使性能与功耗实现平衡，此功能只有STM32F42xx和STM32F43xx器件有，</span>
    <span class="token function">__HAL_PWR_VOLTAGESCALING_CONFIG</span><span class="token punctuation">(</span>PWR_REGULATOR_VOLTAGE_SCALE1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//设置调压器输出电压级别1</span>
	<span class="token comment">//Osc 振荡器</span>
    RCC_OscInitStructure<span class="token punctuation">.</span>OscillatorType <span class="token operator">=</span> RCC_OSCILLATORTYPE_HSE<span class="token punctuation">;</span>  <span class="token comment">//时钟源为HSE</span>
    RCC_OscInitStructure<span class="token punctuation">.</span>HSEState <span class="token operator">=</span> RCC_HSE_ON<span class="token punctuation">;</span>                    <span class="token comment">//打开HSE</span>
    RCC_OscInitStructure<span class="token punctuation">.</span>PLL<span class="token punctuation">.</span>PLLState <span class="token operator">=</span> RCC_PLL_ON<span class="token punctuation">;</span> <span class="token comment">//打开PLL</span>
    RCC_OscInitStructure<span class="token punctuation">.</span>PLL<span class="token punctuation">.</span>PLLSource <span class="token operator">=</span> RCC_PLLSOURCE_HSE<span class="token punctuation">;</span> <span class="token comment">//PLL时钟源选择HSE</span>
    RCC_OscInitStructure<span class="token punctuation">.</span>PLL<span class="token punctuation">.</span>PLLM <span class="token operator">=</span> pllm<span class="token punctuation">;</span> <span class="token comment">//主PLL和音频PLL分频系数(PLL之前的分频),取值范围:2~63.</span>
    RCC_OscInitStructure<span class="token punctuation">.</span>PLL<span class="token punctuation">.</span>PLLN <span class="token operator">=</span> plln<span class="token punctuation">;</span> <span class="token comment">//主PLL倍频系数(PLL倍频),取值范围:64~432.</span>
    RCC_OscInitStructure<span class="token punctuation">.</span>PLL<span class="token punctuation">.</span>PLLP <span class="token operator">=</span> pllp<span class="token punctuation">;</span> <span class="token comment">//系统时钟的主PLL分频系数(PLL之后的分频),取值范围:2,4,6,8.(仅限这4个值!)</span>
    RCC_OscInitStructure<span class="token punctuation">.</span>PLL<span class="token punctuation">.</span>PLLQ <span class="token operator">=</span> pllq<span class="token punctuation">;</span> <span class="token comment">//USB/SDIO/随机数产生器等的主PLL分频系数(PLL之后的分频),取值范围:2~15.</span>
    ret <span class="token operator">=</span> <span class="token function">HAL_RCC_OscConfig</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>RCC_OscInitStructure<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//初始化</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">!=</span> HAL_OK<span class="token punctuation">)</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    ret <span class="token operator">=</span> <span class="token function">HAL_PWREx_EnableOverDrive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//开启Over-Driver功能</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">!=</span> HAL_OK<span class="token punctuation">)</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//选中PLL作为系统时钟源并且配置HCLK,PCLK1和PCLK2</span>
    RCC_ClkInitStructure<span class="token punctuation">.</span>ClockType <span class="token operator">=</span> <span class="token punctuation">(</span>RCC_CLOCKTYPE_SYSCLK <span class="token operator">|</span> RCC_CLOCKTYPE_HCLK <span class="token operator">|</span> RCC_CLOCKTYPE_PCLK1 <span class="token operator">|</span> RCC_CLOCKTYPE_PCLK2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    RCC_ClkInitStructure<span class="token punctuation">.</span>SYSCLKSource <span class="token operator">=</span> RCC_SYSCLKSOURCE_PLLCLK<span class="token punctuation">;</span> <span class="token comment">//设置系统时钟时钟源为PLL</span>
    RCC_ClkInitStructure<span class="token punctuation">.</span>AHBCLKDivider <span class="token operator">=</span> RCC_SYSCLK_DIV1<span class="token punctuation">;</span> <span class="token comment">//AHB分频系数为1</span>
    RCC_ClkInitStructure<span class="token punctuation">.</span>APB1CLKDivider <span class="token operator">=</span> RCC_HCLK_DIV4<span class="token punctuation">;</span> <span class="token comment">//APB1分频系数为4</span>
    RCC_ClkInitStructure<span class="token punctuation">.</span>APB2CLKDivider <span class="token operator">=</span> RCC_HCLK_DIV2<span class="token punctuation">;</span> <span class="token comment">//APB2分频系数为2</span>
    ret <span class="token operator">=</span> <span class="token function">HAL_RCC_ClockConfig</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>RCC_ClkInitStructure<span class="token punctuation">,</span> FLASH_LATENCY_5<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//同时设置FLASH延时周期为5WS，也就是6个CPU周期。</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">!=</span> HAL_OK<span class="token punctuation">)</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">个人理解</p><p>深入理解时钟树不难，<code>H</code>高、<code>L</code>低、<code>E</code>外部、<code>I</code>内部、<code>PLL</code>锁相环、<code>Osc</code>振荡器</p></div><h2 id="位带操作" tabindex="-1"><a class="header-anchor" href="#位带操作" aria-hidden="true">#</a> 位带操作</h2><p>在学习51单片机时就已经使用过位操作，比如使用<code>sbit</code>对单</p><p>片机IO口的定义，但是STM32中并没有这类关键字，而是通</p><p>过访问位带别名区来实现，即通过将每个比特位膨胀成一个32位字，当访问这些字的时候就达到了访问比特的目的。</p><p>比方说<code>BSRR</code>寄存器有32个位，那么可以映射到32个地址上，当我们去访问这32个地址就达到访问32个比特的目的。</p><p><strong>STM32位带及位带别名区域</strong></p><p>支持位带操作的区域是 SRAM 区的最低 1MB 范围（APB1/2，AHB1外设）和片内外设区的最低 1MB范围。</p><p><img src="https://m.360buyimg.com/babel/jfs/t1/210181/14/21713/117769/626689b9Eb863a664/4a2ca945d60d7f5b.png" alt="image-20220425163745292.png"></p><p><strong>外设位带区与外设位带别名区的地址转换公式：</strong></p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>A</mi><mi>l</mi><mi>i</mi><mi>a</mi><mi>s</mi><mi>A</mi><mi>d</mi><mi>d</mi><mi>r</mi><mo>=</mo><mn>0</mn><mi mathvariant="normal">x</mi><mn>42000000</mn><mo>+</mo><mo stretchy="false">(</mo><mi>A</mi><mo>−</mo><mn>0</mn><mi mathvariant="normal">x</mi><mn>40000000</mn><mo stretchy="false">)</mo><mo>×</mo><mn>8</mn><mo>×</mo><mn>4</mn><mo>+</mo><mi>n</mi><mo>×</mo><mn>4</mn></mrow><annotation encoding="application/x-tex">AliasAddr = 0\mathrm{x}42000000+ (A-0\mathrm{x}40000000)\times 8\times 4 +n\times 4 </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">ia</span><span class="mord mathnormal">s</span><span class="mord mathnormal">A</span><span class="mord mathnormal">dd</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">0</span><span class="mord mathrm">x</span><span class="mord">42000000</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">0</span><span class="mord mathrm">x</span><span class="mord">40000000</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">8</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">4</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">4</span></span></span></span></span></p><p><strong>SRAM位带区与SRAM位带别名区的地址转换公式：</strong></p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>A</mi><mi>l</mi><mi>i</mi><mi>a</mi><mi>s</mi><mi>A</mi><mi>d</mi><mi>d</mi><mi>r</mi><mo>=</mo><mn>0</mn><mi mathvariant="normal">x</mi><mn>22000000</mn><mo>+</mo><mo stretchy="false">(</mo><mi>A</mi><mo>−</mo><mn>0</mn><mi mathvariant="normal">x</mi><mn>20000000</mn><mo stretchy="false">)</mo><mo>×</mo><mn>8</mn><mo>×</mo><mn>4</mn><mo>+</mo><mi>n</mi><mo>×</mo><mn>4</mn></mrow><annotation encoding="application/x-tex">AliasAddr = 0\mathrm{x}22000000+ (A-0\mathrm{x}20000000)\times 8 \times 4 +n\times 4 </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">ia</span><span class="mord mathnormal">s</span><span class="mord mathnormal">A</span><span class="mord mathnormal">dd</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">0</span><span class="mord mathrm">x</span><span class="mord">22000000</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">0</span><span class="mord mathrm">x</span><span class="mord">20000000</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">8</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">4</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">4</span></span></span></span></span></p><p><code>A</code>：表示我们要操作的那个位所在的寄存器的地址</p><p><code>n</code>：位序号</p><p><strong>根据上述两个公式特点，将其统一为一个公式表示：</strong></p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mi>A</mi><mi mathvariant="normal">&amp;</mi><mn>0</mn><mrow><mi mathvariant="normal">x</mi><mi mathvariant="normal">F</mi></mrow><mn>0000000</mn><mo stretchy="false">)</mo><mo>+</mo><mn>0</mn><mi mathvariant="normal">x</mi><mn>02000000</mn><mo>+</mo><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mi>A</mi><mi mathvariant="normal">&amp;</mi><mn>0</mn><mi mathvariant="normal">x</mi><mn>000</mn><mrow><mi mathvariant="normal">F</mi><mi mathvariant="normal">F</mi><mi mathvariant="normal">F</mi><mi mathvariant="normal">F</mi><mi mathvariant="normal">F</mi></mrow><mo stretchy="false">)</mo><mo>&lt;</mo><mo>&lt;</mo><mn>5</mn><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">(</mo><mi>n</mi><mo>&lt;</mo><mo>&lt;</mo><mn>2</mn><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">((A \&amp; 0\mathrm{xF}0000000)+0\mathrm{x}02000000+((A \&amp; 0\mathrm{x}000\mathrm{FFFFF})&lt;&lt;5)+(n&lt;&lt;2)) </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">((</span><span class="mord mathnormal">A</span><span class="mord">&amp;0</span><span class="mord"><span class="mord mathrm">xF</span></span><span class="mord">0000000</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">0</span><span class="mord mathrm">x</span><span class="mord">02000000</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">((</span><span class="mord mathnormal">A</span><span class="mord">&amp;0</span><span class="mord mathrm">x</span><span class="mord">000</span><span class="mord"><span class="mord mathrm">FFFFF</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">5</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mclose">))</span></span></span></span></span></p><p><code>A</code>：表示我们要操作的那个位所在的寄存器的地址</p><p><code>n</code>：位序号</p><p><strong>理解要点</strong>：位带区的一个位在位带别名区会被膨胀成四个字节</p><div class="custom-container tip"><p class="custom-container-title">个人理解</p><p>通过地址访问内存的感觉</p></div><p><strong>优点：</strong></p><ol><li>控制GPIO口输入输出非常简单。</li><li>操作串行接口芯片非常方便（DS1302、74HC595等）。</li><li>代码简洁，阅读方便。</li></ol><h3 id="宏定义位带实现" tabindex="-1"><a class="header-anchor" href="#宏定义位带实现" aria-hidden="true">#</a> 宏定义位带实现</h3><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">//system.h</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token comment">//位带操作,实现51类似的GPIO控制功能</span>
<span class="token comment">//具体实现思想,参考&lt;&lt;CM3权威指南&gt;&gt;第五章(87页~92页).M4同M3类似,只是寄存器地址变了.</span>
<span class="token comment">//IO口操作宏定义</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">BITBAND</span><span class="token expression"><span class="token punctuation">(</span>addr<span class="token punctuation">,</span> bitnum<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>addr <span class="token operator">&amp;</span> <span class="token number">0xF0000000</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">0x2000000</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">(</span>addr <span class="token operator">&amp;</span><span class="token number">0xFFFFF</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">(</span>bitnum<span class="token operator">&lt;&lt;</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">MEM_ADDR</span><span class="token expression"><span class="token punctuation">(</span>addr<span class="token punctuation">)</span>  <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">volatile</span> <span class="token keyword">unsigned</span> <span class="token keyword">long</span>  <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">)</span> </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">BIT_ADDR</span><span class="token expression"><span class="token punctuation">(</span>addr<span class="token punctuation">,</span> bitnum<span class="token punctuation">)</span>   <span class="token function">MEM_ADDR</span><span class="token punctuation">(</span><span class="token function">BITBAND</span><span class="token punctuation">(</span>addr<span class="token punctuation">,</span> bitnum<span class="token punctuation">)</span><span class="token punctuation">)</span> </span></span>
<span class="token comment">//IO口地址映射</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIOA_ODR_Addr</span>    <span class="token expression"><span class="token punctuation">(</span>GPIOA_BASE<span class="token operator">+</span><span class="token number">20</span><span class="token punctuation">)</span> </span><span class="token comment">//0x40020014</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIOB_ODR_Addr</span>    <span class="token expression"><span class="token punctuation">(</span>GPIOB_BASE<span class="token operator">+</span><span class="token number">20</span><span class="token punctuation">)</span> </span><span class="token comment">//0x40020414 </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIOC_ODR_Addr</span>    <span class="token expression"><span class="token punctuation">(</span>GPIOC_BASE<span class="token operator">+</span><span class="token number">20</span><span class="token punctuation">)</span> </span><span class="token comment">//0x40020814 </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIOD_ODR_Addr</span>    <span class="token expression"><span class="token punctuation">(</span>GPIOD_BASE<span class="token operator">+</span><span class="token number">20</span><span class="token punctuation">)</span> </span><span class="token comment">//0x40020C14 </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIOE_ODR_Addr</span>    <span class="token expression"><span class="token punctuation">(</span>GPIOE_BASE<span class="token operator">+</span><span class="token number">20</span><span class="token punctuation">)</span> </span><span class="token comment">//0x40021014 </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIOF_ODR_Addr</span>    <span class="token expression"><span class="token punctuation">(</span>GPIOF_BASE<span class="token operator">+</span><span class="token number">20</span><span class="token punctuation">)</span> </span><span class="token comment">//0x40021414    </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIOG_ODR_Addr</span>    <span class="token expression"><span class="token punctuation">(</span>GPIOG_BASE<span class="token operator">+</span><span class="token number">20</span><span class="token punctuation">)</span> </span><span class="token comment">//0x40021814   </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIOH_ODR_Addr</span>    <span class="token expression"><span class="token punctuation">(</span>GPIOH_BASE<span class="token operator">+</span><span class="token number">20</span><span class="token punctuation">)</span> </span><span class="token comment">//0x40021C14    </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIOI_ODR_Addr</span>    <span class="token expression"><span class="token punctuation">(</span>GPIOI_BASE<span class="token operator">+</span><span class="token number">20</span><span class="token punctuation">)</span> </span><span class="token comment">//0x40022014 </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIOJ_ODR_ADDr</span>    <span class="token expression"><span class="token punctuation">(</span>GPIOJ_BASE<span class="token operator">+</span><span class="token number">20</span><span class="token punctuation">)</span> </span><span class="token comment">//0x40022414</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIOK_ODR_ADDr</span>    <span class="token expression"><span class="token punctuation">(</span>GPIOK_BASE<span class="token operator">+</span><span class="token number">20</span><span class="token punctuation">)</span> </span><span class="token comment">//0x40022814</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIOA_IDR_Addr</span>    <span class="token expression"><span class="token punctuation">(</span>GPIOA_BASE<span class="token operator">+</span><span class="token number">16</span><span class="token punctuation">)</span> </span><span class="token comment">//0x40020010 </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIOB_IDR_Addr</span>    <span class="token expression"><span class="token punctuation">(</span>GPIOB_BASE<span class="token operator">+</span><span class="token number">16</span><span class="token punctuation">)</span> </span><span class="token comment">//0x40020410 </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIOC_IDR_Addr</span>    <span class="token expression"><span class="token punctuation">(</span>GPIOC_BASE<span class="token operator">+</span><span class="token number">16</span><span class="token punctuation">)</span> </span><span class="token comment">//0x40020810 </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIOD_IDR_Addr</span>    <span class="token expression"><span class="token punctuation">(</span>GPIOD_BASE<span class="token operator">+</span><span class="token number">16</span><span class="token punctuation">)</span> </span><span class="token comment">//0x40020C10 </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIOE_IDR_Addr</span>    <span class="token expression"><span class="token punctuation">(</span>GPIOE_BASE<span class="token operator">+</span><span class="token number">16</span><span class="token punctuation">)</span> </span><span class="token comment">//0x40021010 </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIOF_IDR_Addr</span>    <span class="token expression"><span class="token punctuation">(</span>GPIOF_BASE<span class="token operator">+</span><span class="token number">16</span><span class="token punctuation">)</span> </span><span class="token comment">//0x40021410 </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIOG_IDR_Addr</span>    <span class="token expression"><span class="token punctuation">(</span>GPIOG_BASE<span class="token operator">+</span><span class="token number">16</span><span class="token punctuation">)</span> </span><span class="token comment">//0x40021810 </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIOH_IDR_Addr</span>    <span class="token expression"><span class="token punctuation">(</span>GPIOH_BASE<span class="token operator">+</span><span class="token number">16</span><span class="token punctuation">)</span> </span><span class="token comment">//0x40021C10 </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIOI_IDR_Addr</span>    <span class="token expression"><span class="token punctuation">(</span>GPIOI_BASE<span class="token operator">+</span><span class="token number">16</span><span class="token punctuation">)</span> </span><span class="token comment">//0x40022010 </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIOJ_IDR_Addr</span>    <span class="token expression"><span class="token punctuation">(</span>GPIOJ_BASE<span class="token operator">+</span><span class="token number">16</span><span class="token punctuation">)</span> </span><span class="token comment">//0x40022410 </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIOK_IDR_Addr</span>    <span class="token expression"><span class="token punctuation">(</span>GPIOK_BASE<span class="token operator">+</span><span class="token number">16</span><span class="token punctuation">)</span> </span><span class="token comment">//0x40022810 </span></span>

<span class="token comment">//IO口操作,只对单一的IO口!</span>
<span class="token comment">//确保n的值小于16!</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">PAout</span><span class="token expression"><span class="token punctuation">(</span>n<span class="token punctuation">)</span>   <span class="token function">BIT_ADDR</span><span class="token punctuation">(</span>GPIOA_ODR_Addr<span class="token punctuation">,</span>n<span class="token punctuation">)</span>  </span><span class="token comment">//输出 </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">PAin</span><span class="token expression"><span class="token punctuation">(</span>n<span class="token punctuation">)</span>    <span class="token function">BIT_ADDR</span><span class="token punctuation">(</span>GPIOA_IDR_Addr<span class="token punctuation">,</span>n<span class="token punctuation">)</span>  </span><span class="token comment">//输入 </span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">PBout</span><span class="token expression"><span class="token punctuation">(</span>n<span class="token punctuation">)</span>   <span class="token function">BIT_ADDR</span><span class="token punctuation">(</span>GPIOB_ODR_Addr<span class="token punctuation">,</span>n<span class="token punctuation">)</span>  </span><span class="token comment">//输出 </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">PBin</span><span class="token expression"><span class="token punctuation">(</span>n<span class="token punctuation">)</span>    <span class="token function">BIT_ADDR</span><span class="token punctuation">(</span>GPIOB_IDR_Addr<span class="token punctuation">,</span>n<span class="token punctuation">)</span>  </span><span class="token comment">//输入 </span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">PCout</span><span class="token expression"><span class="token punctuation">(</span>n<span class="token punctuation">)</span>   <span class="token function">BIT_ADDR</span><span class="token punctuation">(</span>GPIOC_ODR_Addr<span class="token punctuation">,</span>n<span class="token punctuation">)</span>  </span><span class="token comment">//输出 </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">PCin</span><span class="token expression"><span class="token punctuation">(</span>n<span class="token punctuation">)</span>    <span class="token function">BIT_ADDR</span><span class="token punctuation">(</span>GPIOC_IDR_Addr<span class="token punctuation">,</span>n<span class="token punctuation">)</span>  </span><span class="token comment">//输入 </span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">PDout</span><span class="token expression"><span class="token punctuation">(</span>n<span class="token punctuation">)</span>   <span class="token function">BIT_ADDR</span><span class="token punctuation">(</span>GPIOD_ODR_Addr<span class="token punctuation">,</span>n<span class="token punctuation">)</span>  </span><span class="token comment">//输出 </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">PDin</span><span class="token expression"><span class="token punctuation">(</span>n<span class="token punctuation">)</span>    <span class="token function">BIT_ADDR</span><span class="token punctuation">(</span>GPIOD_IDR_Addr<span class="token punctuation">,</span>n<span class="token punctuation">)</span>  </span><span class="token comment">//输入 </span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">PEout</span><span class="token expression"><span class="token punctuation">(</span>n<span class="token punctuation">)</span>   <span class="token function">BIT_ADDR</span><span class="token punctuation">(</span>GPIOE_ODR_Addr<span class="token punctuation">,</span>n<span class="token punctuation">)</span>  </span><span class="token comment">//输出 </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">PEin</span><span class="token expression"><span class="token punctuation">(</span>n<span class="token punctuation">)</span>    <span class="token function">BIT_ADDR</span><span class="token punctuation">(</span>GPIOE_IDR_Addr<span class="token punctuation">,</span>n<span class="token punctuation">)</span>  </span><span class="token comment">//输入</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">PFout</span><span class="token expression"><span class="token punctuation">(</span>n<span class="token punctuation">)</span>   <span class="token function">BIT_ADDR</span><span class="token punctuation">(</span>GPIOF_ODR_Addr<span class="token punctuation">,</span>n<span class="token punctuation">)</span>  </span><span class="token comment">//输出 </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">PFin</span><span class="token expression"><span class="token punctuation">(</span>n<span class="token punctuation">)</span>    <span class="token function">BIT_ADDR</span><span class="token punctuation">(</span>GPIOF_IDR_Addr<span class="token punctuation">,</span>n<span class="token punctuation">)</span>  </span><span class="token comment">//输入</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">PGout</span><span class="token expression"><span class="token punctuation">(</span>n<span class="token punctuation">)</span>   <span class="token function">BIT_ADDR</span><span class="token punctuation">(</span>GPIOG_ODR_Addr<span class="token punctuation">,</span>n<span class="token punctuation">)</span>  </span><span class="token comment">//输出 </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">PGin</span><span class="token expression"><span class="token punctuation">(</span>n<span class="token punctuation">)</span>    <span class="token function">BIT_ADDR</span><span class="token punctuation">(</span>GPIOG_IDR_Addr<span class="token punctuation">,</span>n<span class="token punctuation">)</span>  </span><span class="token comment">//输入</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">PHout</span><span class="token expression"><span class="token punctuation">(</span>n<span class="token punctuation">)</span>   <span class="token function">BIT_ADDR</span><span class="token punctuation">(</span>GPIOH_ODR_Addr<span class="token punctuation">,</span>n<span class="token punctuation">)</span>  </span><span class="token comment">//输出 </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">PHin</span><span class="token expression"><span class="token punctuation">(</span>n<span class="token punctuation">)</span>    <span class="token function">BIT_ADDR</span><span class="token punctuation">(</span>GPIOH_IDR_Addr<span class="token punctuation">,</span>n<span class="token punctuation">)</span>  </span><span class="token comment">//输入</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">PIout</span><span class="token expression"><span class="token punctuation">(</span>n<span class="token punctuation">)</span>   <span class="token function">BIT_ADDR</span><span class="token punctuation">(</span>GPIOI_ODR_Addr<span class="token punctuation">,</span>n<span class="token punctuation">)</span>  </span><span class="token comment">//输出 </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">PIin</span><span class="token expression"><span class="token punctuation">(</span>n<span class="token punctuation">)</span>    <span class="token function">BIT_ADDR</span><span class="token punctuation">(</span>GPIOI_IDR_Addr<span class="token punctuation">,</span>n<span class="token punctuation">)</span>  </span><span class="token comment">//输入</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">PJout</span><span class="token expression"><span class="token punctuation">(</span>n<span class="token punctuation">)</span>   <span class="token function">BIT_ADDR</span><span class="token punctuation">(</span>GPIOJ_ODR_Addr<span class="token punctuation">,</span>n<span class="token punctuation">)</span>  </span><span class="token comment">//输出 </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">PJin</span><span class="token expression"><span class="token punctuation">(</span>n<span class="token punctuation">)</span>    <span class="token function">BIT_ADDR</span><span class="token punctuation">(</span>GPIOJ_IDR_Addr<span class="token punctuation">,</span>n<span class="token punctuation">)</span>  </span><span class="token comment">//输入</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">PKout</span><span class="token expression"><span class="token punctuation">(</span>n<span class="token punctuation">)</span>   <span class="token function">BIT_ADDR</span><span class="token punctuation">(</span>GPIOK_ODR_Addr<span class="token punctuation">,</span>n<span class="token punctuation">)</span>  </span><span class="token comment">//输出 </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">PKin</span><span class="token expression"><span class="token punctuation">(</span>n<span class="token punctuation">)</span>    <span class="token function">BIT_ADDR</span><span class="token punctuation">(</span>GPIOK_IDR_Addr<span class="token punctuation">,</span>n<span class="token punctuation">)</span>  </span><span class="token comment">//输入</span></span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">//main.c</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;system.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;led.h&quot;</span></span>

<span class="token keyword">void</span> <span class="token function">delay</span><span class="token punctuation">(</span>u32 i<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span>i<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>



<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>

    <span class="token function">HAL_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                     <span class="token comment">//初始化HAL库</span>
    <span class="token function">SystemClock_Init</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">360</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//设置时钟,180Mhz  ((25/25) * 360)/2=180</span>
    <span class="token function">LED_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
		LED1 <span class="token operator">=</span> <span class="token operator">!</span>LED1<span class="token punctuation">;</span>
		<span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">0x7fffff</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		LED2 <span class="token operator">=</span> <span class="token operator">!</span>LED2<span class="token punctuation">;</span>
		<span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">0x7fffff</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">//led.c</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;led.h&quot;</span></span>

<span class="token keyword">void</span> <span class="token function">LED_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token comment">//定义放到最前面</span>
	GPIO_InitTypeDef GPIO_InitStructure<span class="token punctuation">;</span>
	
	<span class="token function">__HAL_RCC_GPIOB_CLK_ENABLE</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//先配置好一个结构体</span>
	GPIO_InitStructure<span class="token punctuation">.</span>Pin <span class="token operator">=</span> GPIO_PIN_0<span class="token operator">|</span>GPIO_PIN_1<span class="token punctuation">;</span>
	GPIO_InitStructure<span class="token punctuation">.</span>Mode <span class="token operator">=</span> GPIO_MODE_OUTPUT_PP<span class="token punctuation">;</span>
	GPIO_InitStructure<span class="token punctuation">.</span>Pull <span class="token operator">=</span> GPIO_PULLUP<span class="token punctuation">;</span>
	GPIO_InitStructure<span class="token punctuation">.</span>Speed <span class="token operator">=</span> GPIO_SPEED_FREQ_VERY_HIGH<span class="token punctuation">;</span>
	<span class="token comment">//然后一股脑的塞入Init函数</span>
	<span class="token function">HAL_GPIO_Init</span><span class="token punctuation">(</span>GPIOB<span class="token punctuation">,</span> <span class="token operator">&amp;</span>GPIO_InitStructure<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	LED2<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
	LED1<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">//led.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">__LED_H</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">__LED_H</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;system.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LED1</span> <span class="token expression"><span class="token function">PBout</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LED2</span> <span class="token expression"><span class="token function">PBout</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></span></span>

<span class="token keyword">void</span> <span class="token function">LED_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="宏定义库函数实现" tabindex="-1"><a class="header-anchor" href="#宏定义库函数实现" aria-hidden="true">#</a> 宏定义库函数实现</h3><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">//led.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">__LED_H</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">__LED_H</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;system.h&quot;</span></span>
<span class="token comment">//#define LED1 PBout(1)</span>
<span class="token comment">//#define LED2 PBout(0)</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">LED1</span><span class="token expression"><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token punctuation">(</span>n<span class="token operator">?</span><span class="token function">HAL_GPIO_WritePin</span><span class="token punctuation">(</span>GPIOB<span class="token punctuation">,</span>GPIO_PIN_0<span class="token punctuation">,</span>GPIO_PIN_SET<span class="token punctuation">)</span><span class="token operator">:</span><span class="token function">HAL_GPIO_WritePin</span><span class="token punctuation">(</span>GPIOB<span class="token punctuation">,</span>GPIO_PIN_0<span class="token punctuation">,</span>GPIO_PIN_RESET<span class="token punctuation">)</span><span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">LED2</span><span class="token expression"><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token punctuation">(</span>n<span class="token operator">?</span><span class="token function">HAL_GPIO_WritePin</span><span class="token punctuation">(</span>GPIOB<span class="token punctuation">,</span>GPIO_PIN_1<span class="token punctuation">,</span>GPIO_PIN_SET<span class="token punctuation">)</span><span class="token operator">:</span><span class="token function">HAL_GPIO_WritePin</span><span class="token punctuation">(</span>GPIOB<span class="token punctuation">,</span>GPIO_PIN_1<span class="token punctuation">,</span>GPIO_PIN_RESET<span class="token punctuation">)</span><span class="token punctuation">)</span></span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LED1_Toggle</span> <span class="token expression"><span class="token punctuation">(</span><span class="token function">HAL_GPIO_TogglePin</span><span class="token punctuation">(</span>GPIOB<span class="token punctuation">,</span>GPIO_PIN_0<span class="token punctuation">)</span><span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LED2_Toggle</span> <span class="token expression"><span class="token punctuation">(</span><span class="token function">HAL_GPIO_TogglePin</span><span class="token punctuation">(</span>GPIOB<span class="token punctuation">,</span>GPIO_PIN_1<span class="token punctuation">)</span><span class="token punctuation">)</span></span></span>
<span class="token keyword">void</span> <span class="token function">LED_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">//led.c</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;led.h&quot;</span></span>

<span class="token keyword">void</span> <span class="token function">LED_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token comment">//定义放到最前面</span>
	GPIO_InitTypeDef GPIO_InitStructure<span class="token punctuation">;</span>
	
	<span class="token function">__HAL_RCC_GPIOB_CLK_ENABLE</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//先配置好一个结构体</span>
	GPIO_InitStructure<span class="token punctuation">.</span>Pin <span class="token operator">=</span> GPIO_PIN_0<span class="token operator">|</span>GPIO_PIN_1<span class="token punctuation">;</span>
	GPIO_InitStructure<span class="token punctuation">.</span>Mode <span class="token operator">=</span> GPIO_MODE_OUTPUT_PP<span class="token punctuation">;</span>
	GPIO_InitStructure<span class="token punctuation">.</span>Pull <span class="token operator">=</span> GPIO_PULLUP<span class="token punctuation">;</span>
	GPIO_InitStructure<span class="token punctuation">.</span>Speed <span class="token operator">=</span> GPIO_SPEED_FREQ_VERY_HIGH<span class="token punctuation">;</span>
	<span class="token comment">//然后一股脑的塞入Init函数</span>
	<span class="token function">HAL_GPIO_Init</span><span class="token punctuation">(</span>GPIOB<span class="token punctuation">,</span> <span class="token operator">&amp;</span>GPIO_InitStructure<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token function">LED1</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">LED2</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">//main.c</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;system.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;led.h&quot;</span></span>

<span class="token keyword">void</span> <span class="token function">delay</span><span class="token punctuation">(</span>u32 i<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span>i<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>



<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>

    <span class="token function">HAL_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                     <span class="token comment">//初始化HAL库</span>
    <span class="token function">SystemClock_Init</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">360</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//设置时钟,180Mhz  ((25/25) * 360)/2=180</span>
    <span class="token function">LED_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
		LED1_Toggle<span class="token punctuation">;</span>
		<span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">0x7fffff</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		LED2_Toggle<span class="token punctuation">;</span>
		<span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">0x7fffff</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">个人理解</p><p>位带操作很简单，高版本无法用位带的时候就用宏封装。两种都是用宏，一个名字可以随意改变，增加了代码可读性，尽量熟悉宏定义的方式编写代码。</p><p>为增强可移植性，尽量在头文件中都统一定义好。</p></div><h2 id="systick定时器" tabindex="-1"><a class="header-anchor" href="#systick定时器" aria-hidden="true">#</a> SysTick定时器</h2><p>SysTick定时器也叫SysTick滴答定时器，它是Cortex-M4/M7内核的一个外设，被嵌入在 NVIC 中。它是一个24 位向下递减的定时器，每计数一次所需时间为1/SYSTICK，SYSTICK是系统定时器时钟，它可以直接取自系统时钟，还可以通过系统时钟8分频后获取。当定时器计数到0时，将从LOAD 寄存器中自动重装定时器初值，重新向下递减计数，如此循环往复。如果开启SysTick中断的话，当定时器计数到0，将产生一个中断信号。因此只要知道计数的次数就可以准确得到它的延时时间。</p><p>###　<strong>SysTick</strong>定时器寄存器</p><p><strong>CTRL寄存器</strong></p><p>CTRL是SysTick定时器的控制及状态寄存器。其相应位功能如下：</p><p><img src="https://m.360buyimg.com/babel/jfs/t1/207130/18/22958/150415/6298a628E9b05322a/89ce64e95ea4c641.png" alt="image-20220426231940818.png"></p><p><strong>LOAD寄存器</strong></p><p>LOAD是SysTick定时器的重装载数值寄存器。其相应位功能如下：</p><p><img src="https://m.360buyimg.com/babel/jfs/t1/215793/25/19348/45052/6298a628E5e1a1292/6f7eaa0adafdbeae.png" alt="image-20220426232006118.png"></p><p><strong>VAL寄存器</strong></p><p>VAL是SysTick定时器的当前数值寄存器。其相应位功能如下：</p><p><img src="https://m.360buyimg.com/babel/jfs/t1/187084/11/25199/72969/6298a62aE9495651c/f1195f54daaf4d79.png" alt="image-20220426232018020.png"></p><p><strong>CALIB寄存器</strong></p><p>CALIB是SysTick定时器的校准数值寄存器。其相应位功能如下：</p><p><img src="https://m.360buyimg.com/babel/jfs/t1/136590/24/28876/144949/6298a629E023b3f51/f7eb8fcd192d27be.png" alt="image-20220426232029329.png"></p><p>###　<strong>配置步骤</strong></p><p>SysTick定时器的操作可以分为 4 步：</p><ol><li>设置SysTick定时器的时钟源。</li><li>设置SysTick定时器的重装初始值（如果要使用中断的话，就将中断使能打开）。</li><li>清零SysTick定时器当前计数器的值。</li><li>打开SysTick定时器。</li></ol></div><!--[--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">上次更新: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">作者: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 1814300923@qq.com">Chenxuwkk</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/blog/study/page12.html" class="" aria-label="C51"><!--[--><!--]--> C51 <!--[--><!--]--></a></span><span class="next"><a href="/blog/study/page14.html" class="" aria-label="嵌入式小记"><!--[--><!--]--> 嵌入式小记 <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/blog/assets/app.b33ca31f.js" defer></script>
  </body>
</html>
