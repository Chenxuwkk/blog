<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.48">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>C51 | Chenxuwkk's Blog</title><meta name="description" content="Chenxuwkk's Blog">
    <link rel="modulepreload" href="/blog/assets/app.b33ca31f.js"><link rel="modulepreload" href="/blog/assets/page12.html.29d2532a.js"><link rel="modulepreload" href="/blog/assets/page12.html.1814d2d6.js"><link rel="prefetch" href="/blog/assets/about.html.1a741a35.js"><link rel="prefetch" href="/blog/assets/contact.html.03aacf5e.js"><link rel="prefetch" href="/blog/assets/index.html.2e04d9b1.js"><link rel="prefetch" href="/blog/assets/index.html.dc88bf6f.js"><link rel="prefetch" href="/blog/assets/page01.html.6f1784f0.js"><link rel="prefetch" href="/blog/assets/index.html.b2e428a6.js"><link rel="prefetch" href="/blog/assets/page01.html.8647912c.js"><link rel="prefetch" href="/blog/assets/page02.html.2ae31539.js"><link rel="prefetch" href="/blog/assets/page03.html.e30663aa.js"><link rel="prefetch" href="/blog/assets/page04.html.5b5a177e.js"><link rel="prefetch" href="/blog/assets/page05.html.8dc876d3.js"><link rel="prefetch" href="/blog/assets/index.html.1faed378.js"><link rel="prefetch" href="/blog/assets/page00.html.397ec4cb.js"><link rel="prefetch" href="/blog/assets/page01.html.d4c49eb5.js"><link rel="prefetch" href="/blog/assets/page02.html.512e9f97.js"><link rel="prefetch" href="/blog/assets/page03.html.07c7a8d5.js"><link rel="prefetch" href="/blog/assets/page04.html.ea9d586c.js"><link rel="prefetch" href="/blog/assets/page05.html.c54831cd.js"><link rel="prefetch" href="/blog/assets/page06.html.130549e7.js"><link rel="prefetch" href="/blog/assets/page07.html.7c7f84ea.js"><link rel="prefetch" href="/blog/assets/page08.html.e3c59864.js"><link rel="prefetch" href="/blog/assets/page09.html.4785a4a4.js"><link rel="prefetch" href="/blog/assets/page10.html.c6168586.js"><link rel="prefetch" href="/blog/assets/page11.html.ce54a18d.js"><link rel="prefetch" href="/blog/assets/page13.html.3976787d.js"><link rel="prefetch" href="/blog/assets/page14.html.810a54e6.js"><link rel="prefetch" href="/blog/assets/page15.html.3ad37cea.js"><link rel="prefetch" href="/blog/assets/page16.html.c8b15e87.js"><link rel="prefetch" href="/blog/assets/page17.html.bda23cdd.js"><link rel="prefetch" href="/blog/assets/page18.html.8e431832.js"><link rel="prefetch" href="/blog/assets/page19.html.4f7e6a54.js"><link rel="prefetch" href="/blog/assets/page20.html.53b884d3.js"><link rel="prefetch" href="/blog/assets/page21.html.ea7e75ec.js"><link rel="prefetch" href="/blog/assets/page22.html.6a8a8911.js"><link rel="prefetch" href="/blog/assets/page23.html.4da8711b.js"><link rel="prefetch" href="/blog/assets/page24.html.f15f76b8.js"><link rel="prefetch" href="/blog/assets/page25.html.47a43782.js"><link rel="prefetch" href="/blog/assets/index.html.09d3b996.js"><link rel="prefetch" href="/blog/assets/404.html.265028f6.js"><link rel="prefetch" href="/blog/assets/about.html.7c2de1fc.js"><link rel="prefetch" href="/blog/assets/contact.html.af265cd3.js"><link rel="prefetch" href="/blog/assets/index.html.494633a3.js"><link rel="prefetch" href="/blog/assets/index.html.6f6ef67c.js"><link rel="prefetch" href="/blog/assets/page01.html.24477c8b.js"><link rel="prefetch" href="/blog/assets/index.html.06f044c7.js"><link rel="prefetch" href="/blog/assets/page01.html.2c2c82ac.js"><link rel="prefetch" href="/blog/assets/page02.html.519c6760.js"><link rel="prefetch" href="/blog/assets/page03.html.9c782bee.js"><link rel="prefetch" href="/blog/assets/page04.html.01792834.js"><link rel="prefetch" href="/blog/assets/page05.html.ecd56c0e.js"><link rel="prefetch" href="/blog/assets/index.html.0d805a32.js"><link rel="prefetch" href="/blog/assets/page00.html.b5b8a137.js"><link rel="prefetch" href="/blog/assets/page01.html.196f31d8.js"><link rel="prefetch" href="/blog/assets/page02.html.446eff9c.js"><link rel="prefetch" href="/blog/assets/page03.html.265319dc.js"><link rel="prefetch" href="/blog/assets/page04.html.839ac225.js"><link rel="prefetch" href="/blog/assets/page05.html.3ba90d93.js"><link rel="prefetch" href="/blog/assets/page06.html.5ec3bc24.js"><link rel="prefetch" href="/blog/assets/page07.html.9811e105.js"><link rel="prefetch" href="/blog/assets/page08.html.550b989b.js"><link rel="prefetch" href="/blog/assets/page09.html.e59328fe.js"><link rel="prefetch" href="/blog/assets/page10.html.42d79a00.js"><link rel="prefetch" href="/blog/assets/page11.html.07064880.js"><link rel="prefetch" href="/blog/assets/page13.html.31c29b64.js"><link rel="prefetch" href="/blog/assets/page14.html.ad9dcffb.js"><link rel="prefetch" href="/blog/assets/page15.html.58f3b33b.js"><link rel="prefetch" href="/blog/assets/page16.html.8841620e.js"><link rel="prefetch" href="/blog/assets/page17.html.bc75eefa.js"><link rel="prefetch" href="/blog/assets/page18.html.467eb0c9.js"><link rel="prefetch" href="/blog/assets/page19.html.55cbf803.js"><link rel="prefetch" href="/blog/assets/page20.html.8b45092f.js"><link rel="prefetch" href="/blog/assets/page21.html.cc2b2ea3.js"><link rel="prefetch" href="/blog/assets/page22.html.d7349c76.js"><link rel="prefetch" href="/blog/assets/page23.html.e468a4f1.js"><link rel="prefetch" href="/blog/assets/page24.html.af7dd849.js"><link rel="prefetch" href="/blog/assets/page25.html.b0d918c5.js"><link rel="prefetch" href="/blog/assets/index.html.1b0cec2a.js"><link rel="prefetch" href="/blog/assets/404.html.b1b48cf0.js"><link rel="prefetch" href="/blog/assets/404.515c5f58.js"><link rel="prefetch" href="/blog/assets/Layout.14a38178.js"><link rel="prefetch" href="/blog/assets/auto.esm.36809f22.js"><link rel="prefetch" href="/blog/assets/index.daae04bf.js"><link rel="prefetch" href="/blog/assets/index.1842ee54.js"><link rel="prefetch" href="/blog/assets/mermaid.esm.min.ee1e0284.js">
    <link rel="stylesheet" href="/blog/assets/style.f6d73350.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/blog/" class=""><img class="logo" src="/blog/assets/img/logo.png" alt="Chenxuwkk&#39;s Blog"><span class="site-name can-hide">Chenxuwkk&#39;s Blog</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/blog/" class="" aria-label="é¦–é¡µ"><!--[--><!--]--> é¦–é¡µ <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="å¯¼èˆª"><span class="title">å¯¼èˆª</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="å¯¼èˆª"><span class="title">å¯¼èˆª</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/blog/guide/" class="" aria-label="æŒ‡å—"><!--[--><!--]--> æŒ‡å— <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/blog/study/page01" class="" aria-label="å­¦ä¹ è®°å½•"><!--[--><!--]--> å­¦ä¹ è®°å½• <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/blog/question/page01" class="" aria-label="ç–‘éš¾é—®é¢˜"><!--[--><!--]--> ç–‘éš¾é—®é¢˜ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/blog/manuscript/page01" class="" aria-label="è‰ç¨¿æœ¬"><!--[--><!--]--> è‰ç¨¿æœ¬ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/blog/contact" class="" aria-label="è”ç³»æœ¬äºº"><!--[--><!--]--> è”ç³»æœ¬äºº <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/blog/about/" class="" aria-label="å…³äº"><!--[--><!--]--> å…³äº <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/Chenxuwkk" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container"></div></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/blog/" class="" aria-label="é¦–é¡µ"><!--[--><!--]--> é¦–é¡µ <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="å¯¼èˆª"><span class="title">å¯¼èˆª</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="å¯¼èˆª"><span class="title">å¯¼èˆª</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/blog/guide/" class="" aria-label="æŒ‡å—"><!--[--><!--]--> æŒ‡å— <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/blog/study/page01" class="" aria-label="å­¦ä¹ è®°å½•"><!--[--><!--]--> å­¦ä¹ è®°å½• <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/blog/question/page01" class="" aria-label="ç–‘éš¾é—®é¢˜"><!--[--><!--]--> ç–‘éš¾é—®é¢˜ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/blog/manuscript/page01" class="" aria-label="è‰ç¨¿æœ¬"><!--[--><!--]--> è‰ç¨¿æœ¬ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/blog/contact" class="" aria-label="è”ç³»æœ¬äºº"><!--[--><!--]--> è”ç³»æœ¬äºº <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/blog/about/" class="" aria-label="å…³äº"><!--[--><!--]--> å…³äº <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/Chenxuwkk" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><a href="/blog/guide/" class="sidebar-item sidebar-heading" aria-label="æŒ‡å—"><!--[--><!--]--> æŒ‡å— <!--[--><!--]--></a><!----></li><li><p tabindex="0" class="sidebar-item sidebar-heading active">å­¦ä¹ è®°å½• <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/blog/study/page01.html" class="sidebar-item" aria-label="Vuepresséƒ¨ç½²"><!--[--><!--]--> Vuepresséƒ¨ç½² <!--[--><!--]--></a><!----></li><li><a href="/blog/study/page03.html" class="sidebar-item" aria-label="Linux å‘½ä»¤"><!--[--><!--]--> Linux å‘½ä»¤ <!--[--><!--]--></a><!----></li><li><a href="/blog/study/page02.html" class="sidebar-item" aria-label="Cè¯­è¨€é¢„å¤„ç†"><!--[--><!--]--> Cè¯­è¨€é¢„å¤„ç† <!--[--><!--]--></a><!----></li><li><a href="/blog/study/page04.html" class="sidebar-item" aria-label="Cè¯­è¨€ä½è¿ç®—"><!--[--><!--]--> Cè¯­è¨€ä½è¿ç®— <!--[--><!--]--></a><!----></li><li><a href="/blog/study/page05.html" class="sidebar-item" aria-label="Cè¯­è¨€æŒ‡é’ˆ"><!--[--><!--]--> Cè¯­è¨€æŒ‡é’ˆ <!--[--><!--]--></a><!----></li><li><a href="/blog/study/page07.html" class="sidebar-item" aria-label="Cè¯­è¨€åŠ¨æ€å†…å­˜"><!--[--><!--]--> Cè¯­è¨€åŠ¨æ€å†…å­˜ <!--[--><!--]--></a><!----></li><li><a href="/blog/study/page08.html" class="sidebar-item" aria-label="Cè¯­è¨€å­—ç¬¦ä¸²å¤„ç†"><!--[--><!--]--> Cè¯­è¨€å­—ç¬¦ä¸²å¤„ç† <!--[--><!--]--></a><!----></li><li><a href="/blog/study/page09.html" class="sidebar-item" aria-label="Cè¯­è¨€ç»“æ„ä½“è¯¦è§£"><!--[--><!--]--> Cè¯­è¨€ç»“æ„ä½“è¯¦è§£ <!--[--><!--]--></a><!----></li><li><a href="/blog/study/page10.html" class="sidebar-item" aria-label="Cè¯­è¨€é“¾è¡¨"><!--[--><!--]--> Cè¯­è¨€é“¾è¡¨ <!--[--><!--]--></a><!----></li><li><a href="/blog/study/page21.html" class="sidebar-item" aria-label="C++å¯¹Cè¯­è¨€çš„åŠ å¼º"><!--[--><!--]--> C++å¯¹Cè¯­è¨€çš„åŠ å¼º <!--[--><!--]--></a><!----></li><li><a href="/blog/study/page06.html" class="sidebar-item" aria-label="Markdowné«˜çº§æŠ€å·§"><!--[--><!--]--> Markdowné«˜çº§æŠ€å·§ <!--[--><!--]--></a><!----></li><li><a href="/blog/study/page11.html" class="sidebar-item" aria-label="Makefile"><!--[--><!--]--> Makefile <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/study/page12.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="C51"><!--[--><!--]--> C51 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog/study/page12.html#æ‹“å±•å˜é‡" class="router-link-active router-link-exact-active sidebar-item" aria-label="æ‹“å±•å˜é‡"><!--[--><!--]--> æ‹“å±•å˜é‡ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/study/page12.html#æ³¨æ„äº‹é¡¹" class="router-link-active router-link-exact-active sidebar-item" aria-label="æ³¨æ„äº‹é¡¹"><!--[--><!--]--> æ³¨æ„äº‹é¡¹ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/study/page12.html#ledæµæ°´ç¯å®éªŒ" class="router-link-active router-link-exact-active sidebar-item" aria-label="LEDæµæ°´ç¯å®éªŒ"><!--[--><!--]--> LEDæµæ°´ç¯å®éªŒ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/study/page12.html#èœ‚é¸£å™¨å®éªŒ" class="router-link-active router-link-exact-active sidebar-item" aria-label="èœ‚é¸£å™¨å®éªŒ"><!--[--><!--]--> èœ‚é¸£å™¨å®éªŒ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/study/page12.html#åŠ¨æ€æ•°ç ç®¡å®éªŒ" class="router-link-active router-link-exact-active sidebar-item" aria-label="åŠ¨æ€æ•°ç ç®¡å®éªŒ"><!--[--><!--]--> åŠ¨æ€æ•°ç ç®¡å®éªŒ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/study/page12.html#ç‹¬ç«‹æŒ‰é”®å®éªŒ" class="router-link-active router-link-exact-active sidebar-item" aria-label="ç‹¬ç«‹æŒ‰é”®å®éªŒ"><!--[--><!--]--> ç‹¬ç«‹æŒ‰é”®å®éªŒ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/study/page12.html#çŸ©é˜µæŒ‰é”®" class="router-link-active router-link-exact-active sidebar-item" aria-label="çŸ©é˜µæŒ‰é”®"><!--[--><!--]--> çŸ©é˜µæŒ‰é”® <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/study/page12.html#i-oæ‹“å±•-ä¸²è½¬å¹¶-å®éªŒ" class="router-link-active router-link-exact-active sidebar-item" aria-label="I/Oæ‹“å±•(ä¸²è½¬å¹¶)å®éªŒ"><!--[--><!--]--> I/Oæ‹“å±•(ä¸²è½¬å¹¶)å®éªŒ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog/study/page12.html#å»¶è¿Ÿå‡½æ•°" class="router-link-active router-link-exact-active sidebar-item" aria-label="å»¶è¿Ÿå‡½æ•°"><!--[--><!--]--> å»¶è¿Ÿå‡½æ•° <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/study/page12.html#ä»é«˜ä½é€ä½å–æ•°æ®" class="router-link-active router-link-exact-active sidebar-item" aria-label="ä»é«˜ä½é€ä½å–æ•°æ®"><!--[--><!--]--> ä»é«˜ä½é€ä½å–æ•°æ® <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/study/page12.html#å®Œæ•´ä»£ç " class="router-link-active router-link-exact-active sidebar-item" aria-label="å®Œæ•´ä»£ç "><!--[--><!--]--> å®Œæ•´ä»£ç  <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/study/page12.html#å¤šå—595æ‹“å±•i-o" class="router-link-active router-link-exact-active sidebar-item" aria-label="å¤šå—595æ‹“å±•I/O"><!--[--><!--]--> å¤šå—595æ‹“å±•I/O <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/blog/study/page12.html#ledç‚¹é˜µ" class="router-link-active router-link-exact-active sidebar-item" aria-label="LEDç‚¹é˜µ"><!--[--><!--]--> LEDç‚¹é˜µ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/study/page12.html#ç›´æµç”µæœº" class="router-link-active router-link-exact-active sidebar-item" aria-label="ç›´æµç”µæœº"><!--[--><!--]--> ç›´æµç”µæœº <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/study/page12.html#æ­¥è¿›ç”µæœº" class="router-link-active router-link-exact-active sidebar-item" aria-label="æ­¥è¿›ç”µæœº"><!--[--><!--]--> æ­¥è¿›ç”µæœº <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/study/page12.html#å¤–éƒ¨ä¸­æ–­å®éªŒ" class="router-link-active router-link-exact-active sidebar-item" aria-label="å¤–éƒ¨ä¸­æ–­å®éªŒ"><!--[--><!--]--> å¤–éƒ¨ä¸­æ–­å®éªŒ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/study/page12.html#å®šæ—¶å™¨ä¸­æ–­" class="router-link-active router-link-exact-active sidebar-item" aria-label="å®šæ—¶å™¨ä¸­æ–­"><!--[--><!--]--> å®šæ—¶å™¨ä¸­æ–­ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/study/page12.html#ä¸²å£é€šä¿¡å®éªŒ" class="router-link-active router-link-exact-active sidebar-item" aria-label="ä¸²å£é€šä¿¡å®éªŒ"><!--[--><!--]--> ä¸²å£é€šä¿¡å®éªŒ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/study/page12.html#i2c-eepromå®éªŒ" class="router-link-active router-link-exact-active sidebar-item" aria-label="I2C-EEPROMå®éªŒ"><!--[--><!--]--> I2C-EEPROMå®éªŒ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/study/page12.html#æ¸©åº¦ä¼ æ„Ÿå™¨ds18b20" class="router-link-active router-link-exact-active sidebar-item" aria-label="æ¸©åº¦ä¼ æ„Ÿå™¨DS18B20"><!--[--><!--]--> æ¸©åº¦ä¼ æ„Ÿå™¨DS18B20 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog/study/page12.html#åˆå§‹åŒ–æ—¶åº" class="router-link-active router-link-exact-active sidebar-item" aria-label="åˆå§‹åŒ–æ—¶åº"><!--[--><!--]--> åˆå§‹åŒ–æ—¶åº <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/study/page12.html#å†™æ—¶åº" class="router-link-active router-link-exact-active sidebar-item" aria-label="å†™æ—¶åº"><!--[--><!--]--> å†™æ—¶åº <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/study/page12.html#è¯»æ—¶åº" class="router-link-active router-link-exact-active sidebar-item" aria-label="è¯»æ—¶åº"><!--[--><!--]--> è¯»æ—¶åº <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/blog/study/page12.html#æ—¶é’ŸèŠ¯ç‰‡ds1302" class="router-link-active router-link-exact-active sidebar-item" aria-label="æ—¶é’ŸèŠ¯ç‰‡DS1302"><!--[--><!--]--> æ—¶é’ŸèŠ¯ç‰‡DS1302 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/study/page12.html#çº¢å¤–é¥æ§" class="router-link-active router-link-exact-active sidebar-item" aria-label="çº¢å¤–é¥æ§"><!--[--><!--]--> çº¢å¤–é¥æ§ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/study/page12.html#adcæ¨¡æ•°è½¬æ¢" class="router-link-active router-link-exact-active sidebar-item" aria-label="ADCæ¨¡æ•°è½¬æ¢"><!--[--><!--]--> ADCæ¨¡æ•°è½¬æ¢ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/study/page12.html#dacæ•°æ¨¡è½¬æ¢" class="router-link-active router-link-exact-active sidebar-item" aria-label="DACæ•°æ¨¡è½¬æ¢"><!--[--><!--]--> DACæ•°æ¨¡è½¬æ¢ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/study/page12.html#lcd1602" class="router-link-active router-link-exact-active sidebar-item" aria-label="LCD1602"><!--[--><!--]--> LCD1602 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/study/page12.html#esp8266" class="router-link-active router-link-exact-active sidebar-item" aria-label="ESP8266"><!--[--><!--]--> ESP8266 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/blog/study/page13.html" class="sidebar-item" aria-label="STM32"><!--[--><!--]--> STM32 <!--[--><!--]--></a><!----></li><li><a href="/blog/study/page14.html" class="sidebar-item" aria-label="åµŒå…¥å¼å°è®°"><!--[--><!--]--> åµŒå…¥å¼å°è®° <!--[--><!--]--></a><!----></li><li><a href="/blog/study/page15.html" class="sidebar-item" aria-label="IMRD"><!--[--><!--]--> IMRD <!--[--><!--]--></a><!----></li><li><a href="/blog/study/page17.html" class="sidebar-item" aria-label="Paxosç®—æ³•"><!--[--><!--]--> Paxosç®—æ³• <!--[--><!--]--></a><!----></li><li><a href="/blog/study/page18.html" class="sidebar-item" aria-label="STL"><!--[--><!--]--> STL <!--[--><!--]--></a><!----></li><li><a href="/blog/study/page19.html" class="sidebar-item" aria-label="Python"><!--[--><!--]--> Python <!--[--><!--]--></a><!----></li><li><a href="/blog/study/page16.html" class="sidebar-item" aria-label="Leetcode"><!--[--><!--]--> Leetcode <!--[--><!--]--></a><!----></li><li><a href="/blog/study/page20.html" class="sidebar-item" aria-label="å‰‘æŒ‡Offer"><!--[--><!--]--> å‰‘æŒ‡Offer <!--[--><!--]--></a><!----></li><li><a href="/blog/study/page22.html" class="sidebar-item" aria-label="å‰‘æŒ‡Offer II"><!--[--><!--]--> å‰‘æŒ‡Offer II <!--[--><!--]--></a><!----></li><li><a href="/blog/study/page23.html" class="sidebar-item" aria-label="äºŒåˆ†ä¸“é¡¹"><!--[--><!--]--> äºŒåˆ†ä¸“é¡¹ <!--[--><!--]--></a><!----></li><li><a href="/blog/study/page24.html" class="sidebar-item" aria-label="åŠ¨æ€è§„åˆ’ä¸“é¡¹"><!--[--><!--]--> åŠ¨æ€è§„åˆ’ä¸“é¡¹ <!--[--><!--]--></a><!----></li><li><a href="/blog/study/page25.html" class="sidebar-item" aria-label="SQL"><!--[--><!--]--> SQL <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">ç–‘éš¾é—®é¢˜ <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/blog/question/page01.html" class="sidebar-item" aria-label="GitåŒæ­¥ ğŸ˜„"><!--[--><!--]--> GitåŒæ­¥ ğŸ˜„ <!--[--><!--]--></a><!----></li><li><a href="/blog/question/page02.html" class="sidebar-item" aria-label="Ubantuå†…å­˜é‡æ–°åˆ†é…ï¼ˆVmwareï¼‰ ğŸ"><!--[--><!--]--> Ubantuå†…å­˜é‡æ–°åˆ†é…ï¼ˆVmwareï¼‰ ğŸ <!--[--><!--]--></a><!----></li><li><a href="/blog/question/page03.html" class="sidebar-item" aria-label="ä¸€ä¸ªä¸ªå°å‘ï¼ˆVueï¼‰ ğŸ’¢"><!--[--><!--]--> ä¸€ä¸ªä¸ªå°å‘ï¼ˆVueï¼‰ ğŸ’¢ <!--[--><!--]--></a><!----></li><li><a href="/blog/question/page04.html" class="sidebar-item" aria-label="VSCodeç¼–è¯‘C\C++"><!--[--><!--]--> VSCodeç¼–è¯‘C\C++ <!--[--><!--]--></a><!----></li><li><a href="/blog/question/page05.html" class="sidebar-item" aria-label="ä»£ç å¤ç°é—®é¢˜"><!--[--><!--]--> ä»£ç å¤ç°é—®é¢˜ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/blog/manuscript/page01" class="sidebar-item sidebar-heading" aria-label="è‰ç¨¿æœ¬"><!--[--><!--]--> è‰ç¨¿æœ¬ <!--[--><!--]--></a><!----></li><li><a href="/blog/contact" class="sidebar-item sidebar-heading collapsible" aria-label="è”ç³»æœ¬äºº"><!--[--><!--]--> è”ç³»æœ¬äºº <!--[--><!--]--></a><!----></li><li><a href="/blog/about" class="sidebar-item sidebar-heading" aria-label="å…³äº"><!--[--><!--]--> å…³äº <!--[--><!--]--></a><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="c51" tabindex="-1"><a class="header-anchor" href="#c51" aria-hidden="true">#</a> C51</h1><hr><nav class="table-of-contents"><ul><li><a aria-current="page" href="/blog/study/page12.html#æ‹“å±•å˜é‡" class="router-link-active router-link-exact-active">æ‹“å±•å˜é‡</a></li><li><a aria-current="page" href="/blog/study/page12.html#æ³¨æ„äº‹é¡¹" class="router-link-active router-link-exact-active">æ³¨æ„äº‹é¡¹</a></li><li><a aria-current="page" href="/blog/study/page12.html#ledæµæ°´ç¯å®éªŒ" class="router-link-active router-link-exact-active">LEDæµæ°´ç¯å®éªŒ</a></li><li><a aria-current="page" href="/blog/study/page12.html#èœ‚é¸£å™¨å®éªŒ" class="router-link-active router-link-exact-active">èœ‚é¸£å™¨å®éªŒ</a></li><li><a aria-current="page" href="/blog/study/page12.html#åŠ¨æ€æ•°ç ç®¡å®éªŒ" class="router-link-active router-link-exact-active">åŠ¨æ€æ•°ç ç®¡å®éªŒ</a></li><li><a aria-current="page" href="/blog/study/page12.html#ç‹¬ç«‹æŒ‰é”®å®éªŒ" class="router-link-active router-link-exact-active">ç‹¬ç«‹æŒ‰é”®å®éªŒ</a></li><li><a aria-current="page" href="/blog/study/page12.html#çŸ©é˜µæŒ‰é”®" class="router-link-active router-link-exact-active">çŸ©é˜µæŒ‰é”®</a></li><li><a aria-current="page" href="/blog/study/page12.html#i-oæ‹“å±•-ä¸²è½¬å¹¶-å®éªŒ" class="router-link-active router-link-exact-active">I/Oæ‹“å±•(ä¸²è½¬å¹¶)å®éªŒ</a><ul><li><a aria-current="page" href="/blog/study/page12.html#å»¶è¿Ÿå‡½æ•°" class="router-link-active router-link-exact-active">å»¶è¿Ÿå‡½æ•°</a></li><li><a aria-current="page" href="/blog/study/page12.html#ä»é«˜ä½é€ä½å–æ•°æ®" class="router-link-active router-link-exact-active">ä»é«˜ä½é€ä½å–æ•°æ®</a></li><li><a aria-current="page" href="/blog/study/page12.html#å®Œæ•´ä»£ç " class="router-link-active router-link-exact-active">å®Œæ•´ä»£ç </a></li><li><a aria-current="page" href="/blog/study/page12.html#å¤šå—595æ‹“å±•i-o" class="router-link-active router-link-exact-active">å¤šå—595æ‹“å±•I/O</a></li></ul></li><li><a aria-current="page" href="/blog/study/page12.html#ledç‚¹é˜µ" class="router-link-active router-link-exact-active">LEDç‚¹é˜µ</a></li><li><a aria-current="page" href="/blog/study/page12.html#ç›´æµç”µæœº" class="router-link-active router-link-exact-active">ç›´æµç”µæœº</a></li><li><a aria-current="page" href="/blog/study/page12.html#æ­¥è¿›ç”µæœº" class="router-link-active router-link-exact-active">æ­¥è¿›ç”µæœº</a></li><li><a aria-current="page" href="/blog/study/page12.html#å¤–éƒ¨ä¸­æ–­å®éªŒ" class="router-link-active router-link-exact-active">å¤–éƒ¨ä¸­æ–­å®éªŒ</a></li><li><a aria-current="page" href="/blog/study/page12.html#å®šæ—¶å™¨ä¸­æ–­" class="router-link-active router-link-exact-active">å®šæ—¶å™¨ä¸­æ–­</a></li><li><a aria-current="page" href="/blog/study/page12.html#ä¸²å£é€šä¿¡å®éªŒ" class="router-link-active router-link-exact-active">ä¸²å£é€šä¿¡å®éªŒ</a></li><li><a aria-current="page" href="/blog/study/page12.html#i2c-eepromå®éªŒ" class="router-link-active router-link-exact-active">I2C-EEPROMå®éªŒ</a></li><li><a aria-current="page" href="/blog/study/page12.html#æ¸©åº¦ä¼ æ„Ÿå™¨ds18b20" class="router-link-active router-link-exact-active">æ¸©åº¦ä¼ æ„Ÿå™¨DS18B20</a><ul><li><a aria-current="page" href="/blog/study/page12.html#åˆå§‹åŒ–æ—¶åº" class="router-link-active router-link-exact-active">åˆå§‹åŒ–æ—¶åº</a></li><li><a aria-current="page" href="/blog/study/page12.html#å†™æ—¶åº" class="router-link-active router-link-exact-active">å†™æ—¶åº</a></li><li><a aria-current="page" href="/blog/study/page12.html#è¯»æ—¶åº" class="router-link-active router-link-exact-active">è¯»æ—¶åº</a></li></ul></li><li><a aria-current="page" href="/blog/study/page12.html#æ—¶é’ŸèŠ¯ç‰‡ds1302" class="router-link-active router-link-exact-active">æ—¶é’ŸèŠ¯ç‰‡DS1302</a></li><li><a aria-current="page" href="/blog/study/page12.html#çº¢å¤–é¥æ§" class="router-link-active router-link-exact-active">çº¢å¤–é¥æ§</a></li><li><a aria-current="page" href="/blog/study/page12.html#adcæ¨¡æ•°è½¬æ¢" class="router-link-active router-link-exact-active">ADCæ¨¡æ•°è½¬æ¢</a></li><li><a aria-current="page" href="/blog/study/page12.html#dacæ•°æ¨¡è½¬æ¢" class="router-link-active router-link-exact-active">DACæ•°æ¨¡è½¬æ¢</a></li><li><a aria-current="page" href="/blog/study/page12.html#lcd1602" class="router-link-active router-link-exact-active">LCD1602</a></li><li><a aria-current="page" href="/blog/study/page12.html#esp8266" class="router-link-active router-link-exact-active">ESP8266</a></li></ul></nav><h2 id="æ‹“å±•å˜é‡" tabindex="-1"><a class="header-anchor" href="#æ‹“å±•å˜é‡" aria-hidden="true">#</a> æ‹“å±•å˜é‡</h2><table><thead><tr><th style="text-align:left;">å˜é‡</th><th style="text-align:left;">ä½</th><th style="text-align:left;">èŒƒå›´</th><th style="text-align:left;">ä½œç”¨</th></tr></thead><tbody><tr><td style="text-align:left;"><code>bit</code></td><td style="text-align:left;">1</td><td style="text-align:left;">1æˆ–0</td><td style="text-align:left;">ä½å˜é‡å£°æ˜</td></tr><tr><td style="text-align:left;"><code>sbit</code></td><td style="text-align:left;">1</td><td style="text-align:left;">1æˆ–0</td><td style="text-align:left;">ç‰¹æ®ŠåŠŸèƒ½ä½å£°æ˜</td></tr><tr><td style="text-align:left;"><code>sfr</code></td><td style="text-align:left;">8</td><td style="text-align:left;">0-255</td><td style="text-align:left;">ç‰¹æ®ŠåŠŸèƒ½å¯„å­˜å™¨</td></tr><tr><td style="text-align:left;"><code>sfr16</code></td><td style="text-align:left;">16</td><td style="text-align:left;"></td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>*</code></td><td style="text-align:left;">1-3å­—èŠ‚</td><td style="text-align:left;"></td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>unsigned char</code></td><td style="text-align:left;">8</td><td style="text-align:left;"></td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>unsigned int</code></td><td style="text-align:left;">16</td><td style="text-align:left;"></td><td style="text-align:left;"></td></tr></tbody></table><h2 id="æ³¨æ„äº‹é¡¹" tabindex="-1"><a class="header-anchor" href="#æ³¨æ„äº‹é¡¹" aria-hidden="true">#</a> æ³¨æ„äº‹é¡¹</h2><ol><li><p><code>æ•°ç ç®¡</code>/<code>hc595</code> æ¶ˆå½±ï¼Œæ¯æ¬¡ä¼ è¾“<code>å‰</code>/<code>å</code>ä¼ <code>0x00</code>ç½®ä½(å…±é˜´)</p></li><li><p><strong>å®šä¹‰å˜é‡è¦åœ¨æœ€å‰é¢</strong></p></li></ol><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>	
	u8 i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	LEDDZ_COL_PORT <span class="token operator">=</span> <span class="token number">0x00</span><span class="token punctuation">;</span>	
<span class="token punctuation">}</span>
<span class="token comment">//å¦‚æœä¸Šä¸¤å¥é¢ å€’ä¼šæŠ¥é”™:</span>
<span class="token comment">//MAIN.C(82): error C141: syntax error near &#39;u8&#39;</span>
<span class="token comment">//MAIN.C(82): error C202: &#39;i&#39;: undefined identifier</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ledæµæ°´ç¯å®éªŒ" tabindex="-1"><a class="header-anchor" href="#ledæµæ°´ç¯å®éªŒ" aria-hidden="true">#</a> LEDæµæ°´ç¯å®éªŒ</h2><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;reg52.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;intrins.h&quot;</span></span>

<span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> u16<span class="token punctuation">;</span>	<span class="token comment">//å¯¹ç³»ç»Ÿé»˜è®¤æ•°æ®ç±»å‹è¿›è¡Œé‡å®šä¹‰</span>
<span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> u8<span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LED_PORT</span>	<span class="token expression">P2	</span><span class="token comment">//ä½¿ç”¨å®å®šä¹‰P2ç«¯å£</span></span>

<span class="token keyword">void</span> <span class="token function">delay_10us</span><span class="token punctuation">(</span>u16 ten_us<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span>ten_us<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>	
   	u8 i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

	LED_PORT<span class="token operator">=</span><span class="token operator">~</span><span class="token number">0x01</span><span class="token punctuation">;</span><span class="token comment">//1111 1110 POç«¯å£æœ‰ä¸Šæ‹‰ç”µé˜»ï¼Œæ•…æ‹‰ä½ç”µæµLEDäº®</span>
	<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">50000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token comment">//æ–¹æ³•1ï¼šä½¿ç”¨ç§»ä½+å¾ªç¯å®ç°æµæ°´ç¯</span>
<span class="token comment">//		for(i=0;i&lt;8;i++)</span>
<span class="token comment">//		{</span>
<span class="token comment">//			LED_PORT=~(0x01&lt;&lt;i);	//å°†1å³ç§»iä½ï¼Œç„¶åå–åå°†ç»“æœèµ‹å€¼åˆ°LED_PORT</span>
<span class="token comment">//			delay_10us(50000);</span>
<span class="token comment">//		}</span>
		
		<span class="token comment">//æ–¹æ³•2ï¼šä½¿ç”¨å¾ªç¯+_crol_æˆ–_cror_å‡½æ•°å®ç°æµæ°´ç¯</span>
		<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">7</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>	 <span class="token comment">//å°†ledå·¦ç§»ä¸€ä½</span>
		<span class="token punctuation">{</span>									  
			LED_PORT<span class="token operator">=</span><span class="token function">_crol_</span><span class="token punctuation">(</span>LED_PORT<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å¾ªç¯å·¦ç§»</span>
			<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">50000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 	
		<span class="token punctuation">}</span>
		<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">7</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>	<span class="token comment">//å°†ledå³ç§»ä¸€ä½</span>
		<span class="token punctuation">{</span>
			LED_PORT<span class="token operator">=</span><span class="token function">_cror_</span><span class="token punctuation">(</span>LED_PORT<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å¾ªç¯å³ç§»</span>
			<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">50000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
		<span class="token punctuation">}</span>	
	<span class="token punctuation">}</span>		
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="èœ‚é¸£å™¨å®éªŒ" tabindex="-1"><a class="header-anchor" href="#èœ‚é¸£å™¨å®éªŒ" aria-hidden="true">#</a> èœ‚é¸£å™¨å®éªŒ</h2><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;reg52.h&quot;</span></span>

<span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> u16<span class="token punctuation">;</span>	<span class="token comment">//å¯¹ç³»ç»Ÿé»˜è®¤æ•°æ®ç±»å‹è¿›è¡Œé‡å®šä¹‰</span>
<span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> u8<span class="token punctuation">;</span>

sbit BEEP<span class="token operator">=</span>P2<span class="token operator">^</span><span class="token number">5</span><span class="token punctuation">;</span>	<span class="token comment">//å°†P2.5ç®¡è„šå®šä¹‰ä¸ºBEEP</span>

<span class="token keyword">void</span> <span class="token function">delay_10us</span><span class="token punctuation">(</span>u16 ten_us<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span>ten_us<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>	
	u16 i<span class="token operator">=</span><span class="token number">2000</span><span class="token punctuation">;</span>

	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
	   	<span class="token keyword">while</span><span class="token punctuation">(</span>i<span class="token operator">--</span><span class="token punctuation">)</span><span class="token comment">//å¾ªç¯2000æ¬¡</span>
		<span class="token punctuation">{</span>
			BEEP<span class="token operator">=</span><span class="token operator">!</span>BEEP<span class="token punctuation">;</span><span class="token comment">//äº§ç”Ÿä¸€å®šé¢‘ç‡çš„è„‰å†²ä¿¡å·</span>
			<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//æ¸…é›¶</span>
		BEEP<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//å…³é—­èœ‚é¸£å™¨</span>
	<span class="token punctuation">}</span>		
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="åŠ¨æ€æ•°ç ç®¡å®éªŒ" tabindex="-1"><a class="header-anchor" href="#åŠ¨æ€æ•°ç ç®¡å®éªŒ" aria-hidden="true">#</a> åŠ¨æ€æ•°ç ç®¡å®éªŒ</h2><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;reg52.h&quot;</span></span>

<span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> u16<span class="token punctuation">;</span>	<span class="token comment">//å¯¹ç³»ç»Ÿé»˜è®¤æ•°æ®ç±»å‹è¿›è¡Œé‡å®šä¹‰</span>
<span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> u8<span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">SMG_A_DP_PORT</span>	<span class="token expression">P0	</span><span class="token comment">//ä½¿ç”¨å®å®šä¹‰æ•°ç ç®¡æ®µç å£</span></span>

<span class="token comment">//å®šä¹‰æ•°ç ç®¡ä½é€‰ä¿¡å·æ§åˆ¶è„š</span>
sbit LSA<span class="token operator">=</span>P2<span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">;</span>
sbit LSB<span class="token operator">=</span>P2<span class="token operator">^</span><span class="token number">3</span><span class="token punctuation">;</span>
sbit LSC<span class="token operator">=</span>P2<span class="token operator">^</span><span class="token number">4</span><span class="token punctuation">;</span>

<span class="token comment">//å…±é˜´ææ•°ç ç®¡æ˜¾ç¤º0~Fçš„æ®µç æ•°æ®</span>
u8 gsmg_code<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">0x3f</span><span class="token punctuation">,</span><span class="token number">0x06</span><span class="token punctuation">,</span><span class="token number">0x5b</span><span class="token punctuation">,</span><span class="token number">0x4f</span><span class="token punctuation">,</span><span class="token number">0x66</span><span class="token punctuation">,</span><span class="token number">0x6d</span><span class="token punctuation">,</span><span class="token number">0x7d</span><span class="token punctuation">,</span><span class="token number">0x07</span><span class="token punctuation">,</span>
				<span class="token number">0x7f</span><span class="token punctuation">,</span><span class="token number">0x6f</span><span class="token punctuation">,</span><span class="token number">0x77</span><span class="token punctuation">,</span><span class="token number">0x7c</span><span class="token punctuation">,</span><span class="token number">0x39</span><span class="token punctuation">,</span><span class="token number">0x5e</span><span class="token punctuation">,</span><span class="token number">0x79</span><span class="token punctuation">,</span><span class="token number">0x71</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">delay_10us</span><span class="token punctuation">(</span>u16 ten_us<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span>ten_us<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">smg_display</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	u8 i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
	   	<span class="token keyword">switch</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token comment">//ä½é€‰</span>
		<span class="token punctuation">{</span>
			<span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span> LSC<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>LSB<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>LSA<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token comment">//7</span>
			<span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span> LSC<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>LSB<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>LSA<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token comment">//6</span>
			<span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span> LSC<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>LSB<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>LSA<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token comment">//5</span>
			<span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span> LSC<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>LSB<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>LSA<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token comment">//4</span>
			<span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span> LSC<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>LSB<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>LSA<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token comment">//3</span>
			<span class="token keyword">case</span> <span class="token number">5</span><span class="token operator">:</span> LSC<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>LSB<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>LSA<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token comment">//2</span>
			<span class="token keyword">case</span> <span class="token number">6</span><span class="token operator">:</span> LSC<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>LSB<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>LSA<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token comment">//1</span>
			<span class="token keyword">case</span> <span class="token number">7</span><span class="token operator">:</span> LSC<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>LSB<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>LSA<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token comment">//0</span>
		<span class="token punctuation">}</span>
		SMG_A_DP_PORT<span class="token operator">=</span>gsmg_code<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//ä¼ é€æ®µé€‰æ•°æ®</span>
		<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å»¶æ—¶ä¸€æ®µæ—¶é—´ï¼Œç­‰å¾…æ˜¾ç¤ºç¨³å®š</span>
		SMG_A_DP_PORT<span class="token operator">=</span><span class="token number">0x00</span><span class="token punctuation">;</span><span class="token comment">//æ¶ˆéŸ³</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>	
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
	   	<span class="token function">smg_display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>		
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ç‹¬ç«‹æŒ‰é”®å®éªŒ" tabindex="-1"><a class="header-anchor" href="#ç‹¬ç«‹æŒ‰é”®å®éªŒ" aria-hidden="true">#</a> ç‹¬ç«‹æŒ‰é”®å®éªŒ</h2><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;reg52.h&quot;</span></span>

<span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> u16<span class="token punctuation">;</span>	<span class="token comment">//å¯¹ç³»ç»Ÿé»˜è®¤æ•°æ®ç±»å‹è¿›è¡Œé‡å®šä¹‰</span>
<span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> u8<span class="token punctuation">;</span>

<span class="token comment">//å®šä¹‰ç‹¬ç«‹æŒ‰é”®æ§åˆ¶è„š</span>
sbit KEY1<span class="token operator">=</span>P3<span class="token operator">^</span><span class="token number">1</span><span class="token punctuation">;</span>
sbit KEY2<span class="token operator">=</span>P3<span class="token operator">^</span><span class="token number">0</span><span class="token punctuation">;</span>
sbit KEY3<span class="token operator">=</span>P3<span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">;</span>
sbit KEY4<span class="token operator">=</span>P3<span class="token operator">^</span><span class="token number">3</span><span class="token punctuation">;</span>

<span class="token comment">//å®šä¹‰LED1æ§åˆ¶è„š</span>
sbit LED1<span class="token operator">=</span>P2<span class="token operator">^</span><span class="token number">0</span><span class="token punctuation">;</span>
sbit LED2<span class="token operator">=</span>P2<span class="token operator">^</span><span class="token number">1</span><span class="token punctuation">;</span>
sbit LED3<span class="token operator">=</span>P2<span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">;</span>
sbit LED4<span class="token operator">=</span>P2<span class="token operator">^</span><span class="token number">3</span><span class="token punctuation">;</span>
<span class="token comment">//ä½¿ç”¨å®å®šä¹‰ç‹¬ç«‹æŒ‰é”®æŒ‰ä¸‹çš„é”®å€¼</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">KEY1_PRESS</span>	<span class="token expression"><span class="token number">1</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">KEY2_PRESS</span>	<span class="token expression"><span class="token number">2</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">KEY3_PRESS</span>	<span class="token expression"><span class="token number">3</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">KEY4_PRESS</span>	<span class="token expression"><span class="token number">4</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">KEY_UNPRESS</span>	<span class="token expression"><span class="token number">0</span>	</span></span>

<span class="token keyword">void</span> <span class="token function">delay_10us</span><span class="token punctuation">(</span>u16 ten_us<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span>ten_us<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
<span class="token punctuation">}</span>

<span class="token comment">//mode=0ï¼šå•æ¬¡æ‰«ææŒ‰é”®</span>
<span class="token comment">//mode=1ï¼šè¿ç»­æ‰«ææŒ‰é”®</span>
<span class="token comment">//KEY1_PRESSï¼šK1æŒ‰ä¸‹</span>
<span class="token comment">//KEY2_PRESSï¼šK2æŒ‰ä¸‹</span>
<span class="token comment">//KEY3_PRESSï¼šK3æŒ‰ä¸‹</span>
<span class="token comment">//KEY4_PRESSï¼šK4æŒ‰ä¸‹</span>
<span class="token comment">//KEY_UNPRESSï¼šæœªæœ‰æŒ‰é”®æŒ‰ä¸‹</span>

u8 <span class="token function">key_scan</span><span class="token punctuation">(</span>u8 mode<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">static</span> u8 key<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span>mode<span class="token punctuation">)</span>key<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//è¿ç»­æ‰«ææŒ‰é”®</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>key<span class="token operator">==</span><span class="token number">1</span><span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span>KEY1<span class="token operator">==</span><span class="token number">0</span><span class="token operator">||</span>KEY2<span class="token operator">==</span><span class="token number">0</span><span class="token operator">||</span>KEY3<span class="token operator">==</span><span class="token number">0</span><span class="token operator">||</span>KEY4<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//ä»»æ„æŒ‰é”®æŒ‰ä¸‹  æŒ‰ä¸‹ä¸º0</span>
	<span class="token punctuation">{</span>
		<span class="token comment">//æŒ‰é”®ä¸€æŒ‰ä¸‹æ—¶ä¼šäº§ç”Ÿä¸€è¿ä¸²çš„æŠ–åŠ¨</span>
		<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ¶ˆæŠ–</span>
		key<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>KEY1<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span> KEY1_PRESS<span class="token punctuation">;</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>KEY2<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span> KEY2_PRESS<span class="token punctuation">;</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>KEY3<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span> KEY3_PRESS<span class="token punctuation">;</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>KEY4<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span> KEY4_PRESS<span class="token punctuation">;</span>	
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>KEY1<span class="token operator">==</span><span class="token number">1</span><span class="token operator">&amp;&amp;</span>KEY2<span class="token operator">==</span><span class="token number">1</span><span class="token operator">&amp;&amp;</span>KEY3<span class="token operator">==</span><span class="token number">1</span><span class="token operator">&amp;&amp;</span>KEY4<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span>	<span class="token comment">//æ— æŒ‰é”®æŒ‰ä¸‹</span>
	<span class="token punctuation">{</span>
		key<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>			
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> KEY_UNPRESS<span class="token punctuation">;</span>		
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>	
	u8 key<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
	   	key<span class="token operator">=</span><span class="token function">key_scan</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>key<span class="token operator">==</span>KEY1_PRESS<span class="token punctuation">)</span><span class="token comment">//æ£€æµ‹æŒ‰é”®K1æ˜¯å¦æŒ‰ä¸‹</span>
		<span class="token punctuation">{</span>	  
		 	LED1<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//LED1çŠ¶æ€ç¿»è½¬	</span>
			LED2<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
			LED3<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>key<span class="token operator">==</span>KEY2_PRESS<span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			LED1<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
			LED2<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
			LED3<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>key<span class="token operator">==</span>KEY3_PRESS<span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			LED1<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
			LED2<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
			LED3<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>key<span class="token operator">==</span>KEY4_PRESS<span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			LED1<span class="token operator">=</span><span class="token operator">!</span>LED1<span class="token punctuation">;</span>
			LED2<span class="token operator">=</span><span class="token operator">!</span>LED2<span class="token punctuation">;</span>
			LED3<span class="token operator">=</span><span class="token operator">!</span>LED3<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>		
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="çŸ©é˜µæŒ‰é”®" tabindex="-1"><a class="header-anchor" href="#çŸ©é˜µæŒ‰é”®" aria-hidden="true">#</a> çŸ©é˜µæŒ‰é”®</h2><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;reg52.h&quot;</span></span>

<span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> u16<span class="token punctuation">;</span>	<span class="token comment">//å¯¹ç³»ç»Ÿé»˜è®¤æ•°æ®ç±»å‹è¿›è¡Œé‡å®šä¹‰</span>
<span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> u8<span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">KEY_MATRIX_PORT</span>	<span class="token expression">P1	</span><span class="token comment">//ä½¿ç”¨å®å®šä¹‰çŸ©é˜µæŒ‰é”®æ§åˆ¶å£		</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">SMG_A_DP_PORT</span>	<span class="token expression">P0	</span><span class="token comment">//ä½¿ç”¨å®å®šä¹‰æ•°ç ç®¡æ®µç å£</span></span>

<span class="token comment">//å…±é˜´ææ•°ç ç®¡æ˜¾ç¤º0~Fçš„æ®µç æ•°æ®</span>
u8 gsmg_code<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">0x3f</span><span class="token punctuation">,</span><span class="token number">0x06</span><span class="token punctuation">,</span><span class="token number">0x5b</span><span class="token punctuation">,</span><span class="token number">0x4f</span><span class="token punctuation">,</span><span class="token number">0x66</span><span class="token punctuation">,</span><span class="token number">0x6d</span><span class="token punctuation">,</span><span class="token number">0x7d</span><span class="token punctuation">,</span><span class="token number">0x07</span><span class="token punctuation">,</span>
				<span class="token number">0x7f</span><span class="token punctuation">,</span><span class="token number">0x6f</span><span class="token punctuation">,</span><span class="token number">0x77</span><span class="token punctuation">,</span><span class="token number">0x7c</span><span class="token punctuation">,</span><span class="token number">0x39</span><span class="token punctuation">,</span><span class="token number">0x5e</span><span class="token punctuation">,</span><span class="token number">0x79</span><span class="token punctuation">,</span><span class="token number">0x71</span><span class="token punctuation">}</span><span class="token punctuation">;</span>	

<span class="token keyword">void</span> <span class="token function">delay_10us</span><span class="token punctuation">(</span>u16 ten_us<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span>ten_us<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
<span class="token punctuation">}</span>

<span class="token comment">/*******************************************************************************
* å‡½ æ•° å       : key_matrix_ranks_scan
* å‡½æ•°åŠŸèƒ½		 : ä½¿ç”¨è¡Œåˆ—å¼æ‰«ææ–¹æ³•ï¼Œæ£€æµ‹çŸ©é˜µæŒ‰é”®æ˜¯å¦æŒ‰ä¸‹ï¼ŒæŒ‰ä¸‹åˆ™è¿”å›å¯¹åº”é”®å€¼
* è¾“    å…¥       : æ— 
* è¾“    å‡º    	 : key_valueï¼š1-16ï¼Œå¯¹åº”S1-S16é”®ï¼Œ
				   0ï¼šæŒ‰é”®æœªæŒ‰ä¸‹
*******************************************************************************/</span>
u8 <span class="token function">key_matrix_ranks_scan</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>		<span class="token comment">//è¡Œåˆ—åŒæ—¶æ£€æµ‹</span>
<span class="token punctuation">{</span>
	u8 key_value<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

	KEY_MATRIX_PORT<span class="token operator">=</span><span class="token number">0xf7</span><span class="token punctuation">;</span><span class="token comment">//ç»™ç¬¬ä¸€åˆ—èµ‹å€¼0ï¼Œå…¶ä½™å…¨ä¸º1</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>KEY_MATRIX_PORT<span class="token operator">!=</span><span class="token number">0xf7</span><span class="token punctuation">)</span><span class="token comment">//åˆ¤æ–­ç¬¬ä¸€åˆ—æŒ‰é”®æ˜¯å¦æŒ‰ä¸‹</span>
	<span class="token punctuation">{</span>
		<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ¶ˆæŠ–</span>
		<span class="token keyword">switch</span><span class="token punctuation">(</span>KEY_MATRIX_PORT<span class="token punctuation">)</span><span class="token comment">//ä¿å­˜ç¬¬ä¸€åˆ—æŒ‰é”®æŒ‰ä¸‹åçš„é”®å€¼	</span>
		<span class="token punctuation">{</span>
			<span class="token keyword">case</span> <span class="token number">0x77</span><span class="token operator">:</span> key_value<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token keyword">case</span> <span class="token number">0xb7</span><span class="token operator">:</span> key_value<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token keyword">case</span> <span class="token number">0xd7</span><span class="token operator">:</span> key_value<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token keyword">case</span> <span class="token number">0xe7</span><span class="token operator">:</span> key_value<span class="token operator">=</span><span class="token number">13</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span>KEY_MATRIX_PORT<span class="token operator">!=</span><span class="token number">0xf7</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç­‰å¾…æŒ‰é”®æ¾å¼€	</span>
	
	KEY_MATRIX_PORT<span class="token operator">=</span><span class="token number">0xfb</span><span class="token punctuation">;</span><span class="token comment">//ç»™ç¬¬äºŒåˆ—èµ‹å€¼0ï¼Œå…¶ä½™å…¨ä¸º1</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>KEY_MATRIX_PORT<span class="token operator">!=</span><span class="token number">0xfb</span><span class="token punctuation">)</span><span class="token comment">//åˆ¤æ–­ç¬¬äºŒåˆ—æŒ‰é”®æ˜¯å¦æŒ‰ä¸‹</span>
	<span class="token punctuation">{</span>
		<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ¶ˆæŠ–</span>
		<span class="token keyword">switch</span><span class="token punctuation">(</span>KEY_MATRIX_PORT<span class="token punctuation">)</span><span class="token comment">//ä¿å­˜ç¬¬äºŒåˆ—æŒ‰é”®æŒ‰ä¸‹åçš„é”®å€¼	</span>
		<span class="token punctuation">{</span>
			<span class="token keyword">case</span> <span class="token number">0x7b</span><span class="token operator">:</span> key_value<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token keyword">case</span> <span class="token number">0xbb</span><span class="token operator">:</span> key_value<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token keyword">case</span> <span class="token number">0xdb</span><span class="token operator">:</span> key_value<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token keyword">case</span> <span class="token number">0xeb</span><span class="token operator">:</span> key_value<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span>KEY_MATRIX_PORT<span class="token operator">!=</span><span class="token number">0xfb</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç­‰å¾…æŒ‰é”®æ¾å¼€	</span>
	
	KEY_MATRIX_PORT<span class="token operator">=</span><span class="token number">0xfd</span><span class="token punctuation">;</span><span class="token comment">//ç»™ç¬¬ä¸‰åˆ—èµ‹å€¼0ï¼Œå…¶ä½™å…¨ä¸º1</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>KEY_MATRIX_PORT<span class="token operator">!=</span><span class="token number">0xfd</span><span class="token punctuation">)</span><span class="token comment">//åˆ¤æ–­ç¬¬ä¸‰åˆ—æŒ‰é”®æ˜¯å¦æŒ‰ä¸‹</span>
	<span class="token punctuation">{</span>
		<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ¶ˆæŠ–</span>
		<span class="token keyword">switch</span><span class="token punctuation">(</span>KEY_MATRIX_PORT<span class="token punctuation">)</span><span class="token comment">//ä¿å­˜ç¬¬ä¸‰åˆ—æŒ‰é”®æŒ‰ä¸‹åçš„é”®å€¼	</span>
		<span class="token punctuation">{</span>
			<span class="token keyword">case</span> <span class="token number">0x7d</span><span class="token operator">:</span> key_value<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token keyword">case</span> <span class="token number">0xbd</span><span class="token operator">:</span> key_value<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token keyword">case</span> <span class="token number">0xdd</span><span class="token operator">:</span> key_value<span class="token operator">=</span><span class="token number">11</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token keyword">case</span> <span class="token number">0xed</span><span class="token operator">:</span> key_value<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span>KEY_MATRIX_PORT<span class="token operator">!=</span><span class="token number">0xfd</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç­‰å¾…æŒ‰é”®æ¾å¼€	</span>
	
	KEY_MATRIX_PORT<span class="token operator">=</span><span class="token number">0xfe</span><span class="token punctuation">;</span><span class="token comment">//ç»™ç¬¬å››åˆ—èµ‹å€¼0ï¼Œå…¶ä½™å…¨ä¸º1</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>KEY_MATRIX_PORT<span class="token operator">!=</span><span class="token number">0xfe</span><span class="token punctuation">)</span><span class="token comment">//åˆ¤æ–­ç¬¬å››åˆ—æŒ‰é”®æ˜¯å¦æŒ‰ä¸‹</span>
	<span class="token punctuation">{</span>
		<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ¶ˆæŠ–</span>
		<span class="token keyword">switch</span><span class="token punctuation">(</span>KEY_MATRIX_PORT<span class="token punctuation">)</span><span class="token comment">//ä¿å­˜ç¬¬å››åˆ—æŒ‰é”®æŒ‰ä¸‹åçš„é”®å€¼	</span>
		<span class="token punctuation">{</span>
			<span class="token keyword">case</span> <span class="token number">0x7e</span><span class="token operator">:</span> key_value<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token keyword">case</span> <span class="token number">0xbe</span><span class="token operator">:</span> key_value<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token keyword">case</span> <span class="token number">0xde</span><span class="token operator">:</span> key_value<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token keyword">case</span> <span class="token number">0xee</span><span class="token operator">:</span> key_value<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span>KEY_MATRIX_PORT<span class="token operator">!=</span><span class="token number">0xfe</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç­‰å¾…æŒ‰é”®æ¾å¼€</span>
	
	<span class="token keyword">return</span> key_value<span class="token punctuation">;</span>		
<span class="token punctuation">}</span>

<span class="token comment">/*******************************************************************************
* å‡½ æ•° å       : key_matrix_flip_scan
* å‡½æ•°åŠŸèƒ½		 : ä½¿ç”¨çº¿ç¿»è½¬æ‰«ææ–¹æ³•ï¼Œæ£€æµ‹çŸ©é˜µæŒ‰é”®æ˜¯å¦æŒ‰ä¸‹ï¼ŒæŒ‰ä¸‹åˆ™è¿”å›å¯¹åº”é”®å€¼
* è¾“    å…¥       : æ— 
* è¾“    å‡º    	 : key_valueï¼š1-16ï¼Œå¯¹åº”S1-S16é”®ï¼Œ
				   0ï¼šæŒ‰é”®æœªæŒ‰ä¸‹
*******************************************************************************/</span>
u8 <span class="token function">key_matrix_flip_scan</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>	  <span class="token comment">//å…ˆçœ‹åˆ—ï¼Œå†çœ‹è¡Œ</span>
<span class="token punctuation">{</span>
	<span class="token keyword">static</span> u8 key_value<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

	KEY_MATRIX_PORT<span class="token operator">=</span><span class="token number">0x0f</span><span class="token punctuation">;</span><span class="token comment">//ç»™æ‰€æœ‰è¡Œèµ‹å€¼0ï¼Œåˆ—å…¨ä¸º1</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>KEY_MATRIX_PORT<span class="token operator">!=</span><span class="token number">0x0f</span><span class="token punctuation">)</span><span class="token comment">//åˆ¤æ–­æŒ‰é”®æ˜¯å¦æŒ‰ä¸‹</span>
	<span class="token punctuation">{</span>
		<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ¶ˆæŠ–</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>KEY_MATRIX_PORT<span class="token operator">!=</span><span class="token number">0x0f</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token comment">//æµ‹è¯•åˆ—</span>
			KEY_MATRIX_PORT<span class="token operator">=</span><span class="token number">0x0f</span><span class="token punctuation">;</span>
			<span class="token keyword">switch</span><span class="token punctuation">(</span>KEY_MATRIX_PORT<span class="token punctuation">)</span><span class="token comment">//ä¿å­˜è¡Œä¸º0ï¼ŒæŒ‰é”®æŒ‰ä¸‹åçš„åˆ—å€¼	</span>
			<span class="token punctuation">{</span>
				<span class="token keyword">case</span> <span class="token number">0x07</span><span class="token operator">:</span> key_value<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token keyword">case</span> <span class="token number">0x0b</span><span class="token operator">:</span> key_value<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token keyword">case</span> <span class="token number">0x0d</span><span class="token operator">:</span> key_value<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token keyword">case</span> <span class="token number">0x0e</span><span class="token operator">:</span> key_value<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token comment">//æµ‹è¯•è¡Œ</span>
			KEY_MATRIX_PORT<span class="token operator">=</span><span class="token number">0xf0</span><span class="token punctuation">;</span>
			<span class="token keyword">switch</span><span class="token punctuation">(</span>KEY_MATRIX_PORT<span class="token punctuation">)</span><span class="token comment">//ä¿å­˜åˆ—ä¸º0ï¼ŒæŒ‰é”®æŒ‰ä¸‹åçš„é”®å€¼	</span>
			<span class="token punctuation">{</span>
				<span class="token keyword">case</span> <span class="token number">0x70</span><span class="token operator">:</span> key_value<span class="token operator">=</span>key_value<span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token keyword">case</span> <span class="token number">0xb0</span><span class="token operator">:</span> key_value<span class="token operator">=</span>key_value<span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token keyword">case</span> <span class="token number">0xd0</span><span class="token operator">:</span> key_value<span class="token operator">=</span>key_value<span class="token operator">+</span><span class="token number">8</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token keyword">case</span> <span class="token number">0xe0</span><span class="token operator">:</span> key_value<span class="token operator">=</span>key_value<span class="token operator">+</span><span class="token number">12</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">while</span><span class="token punctuation">(</span>KEY_MATRIX_PORT<span class="token operator">!=</span><span class="token number">0xf0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç­‰å¾…æŒ‰é”®æ¾å¼€	</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span>
		key_value<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>		
	
	<span class="token keyword">return</span> key_value<span class="token punctuation">;</span>		
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>	
	u8 key<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
	   	key<span class="token operator">=</span><span class="token function">key_matrix_ranks_scan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>key<span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">)</span>
			SMG_A_DP_PORT<span class="token operator">=</span>gsmg_code<span class="token punctuation">[</span>key<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//å¾—åˆ°çš„æŒ‰é”®å€¼å‡1æ¢ç®—æˆæ•°ç»„ä¸‹æ ‡å¯¹åº”0-Fæ®µç 		</span>
	<span class="token punctuation">}</span>		
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="i-oæ‹“å±•-ä¸²è½¬å¹¶-å®éªŒ" tabindex="-1"><a class="header-anchor" href="#i-oæ‹“å±•-ä¸²è½¬å¹¶-å®éªŒ" aria-hidden="true">#</a> I/Oæ‹“å±•(ä¸²è½¬å¹¶)å®éªŒ</h2><p><img src="https://img30.360buyimg.com/pop/jfs/t1/212425/31/15286/46165/62371c83Eaa2cc6d0/aaa88727929ea2e3.png" alt="image-20220319172533942.png"></p><p><img src="https://img30.360buyimg.com/pop/jfs/t1/99786/12/26521/41553/62371c96Eef6057f2/d3f6f8a8be10e2b8.png" alt="image-20220319172558201.png"></p><h3 id="å»¶è¿Ÿå‡½æ•°" tabindex="-1"><a class="header-anchor" href="#å»¶è¿Ÿå‡½æ•°" aria-hidden="true">#</a> å»¶è¿Ÿå‡½æ•°</h3><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">delay_10us</span><span class="token punctuation">(</span>u16 ten_us<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span>ten_us<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token comment">//12MHzä¸‹å¤§çº¦10us</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">delay_ms</span><span class="token punctuation">(</span>u16 ms<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	u16 i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">100</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span>ms<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ä»é«˜ä½é€ä½å–æ•°æ®" tabindex="-1"><a class="header-anchor" href="#ä»é«˜ä½é€ä½å–æ•°æ®" aria-hidden="true">#</a> ä»é«˜ä½é€ä½å–æ•°æ®</h3><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">//hc595</span>
<span class="token keyword">void</span> <span class="token function">hc595_write_data</span><span class="token punctuation">(</span>u8 dat<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	u8 i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token comment">//æŒ‰ä½ï¼Œä»é«˜å–</span>
		SER <span class="token operator">=</span> dat<span class="token operator">&gt;&gt;</span><span class="token number">7</span><span class="token punctuation">;</span><span class="token comment">//å°†æœ€é«˜ä½å³ç§»åˆ°æœ€ä½ä½ï¼Œé«˜ä½å…¨éƒ¨è¡¥0</span>
		dat<span class="token operator">&lt;&lt;=</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//dat = dat &lt;&lt; 1 å°†æœ€é«˜ä½å†é¡¶æ‰ï¼Œä¸‹ä¸€è½®å¾ªç¯å†å³ç§»7ä½</span>
		<span class="token comment">//ä¸ºäº†è¦ä¸Šå‡æ²¿ ä½ç”µå¹³è¯»å–æ•°æ®</span>
		SRCLK <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//é€å…¥ç§»ä½å¯„å­˜å™¨ä¸­</span>
		<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		SRCLK <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
	<span class="token punctuation">}</span>
	RCLK <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//ç§»ä½å¯„å­˜å™¨é€å…¥å­˜å‚¨å¯„å­˜å™¨ä¸­</span>
	<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	RCLK <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å®Œæ•´ä»£ç " tabindex="-1"><a class="header-anchor" href="#å®Œæ•´ä»£ç " aria-hidden="true">#</a> å®Œæ•´ä»£ç </h3><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;reg52.h&quot;</span></span>

<span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> u16<span class="token punctuation">;</span>	<span class="token comment">//å¯¹ç³»ç»Ÿé»˜è®¤æ•°æ®ç±»å‹è¿›è¡Œé‡å®šä¹‰</span>
<span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> u8<span class="token punctuation">;</span>

<span class="token comment">//å®šä¹‰74HC595æ§åˆ¶ç®¡è„š</span>
sbit SRCLK<span class="token operator">=</span>P3<span class="token operator">^</span><span class="token number">6</span><span class="token punctuation">;</span>	<span class="token comment">//ç§»ä½å¯„å­˜å™¨æ—¶é’Ÿè¾“å…¥</span>
sbit rCLK<span class="token operator">=</span>P3<span class="token operator">^</span><span class="token number">5</span><span class="token punctuation">;</span>		<span class="token comment">//å­˜å‚¨å¯„å­˜å™¨æ—¶é’Ÿè¾“å…¥</span>
sbit SER<span class="token operator">=</span>P3<span class="token operator">^</span><span class="token number">4</span><span class="token punctuation">;</span> 		<span class="token comment">//ä¸²è¡Œæ•°æ®è¾“å…¥</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LEDDZ_COL_PORT</span>	<span class="token expression">P0	</span><span class="token comment">//ç‚¹é˜µåˆ—æ§åˆ¶ç«¯å£</span></span>

u8 ghc595_buf<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">0x01</span><span class="token punctuation">,</span><span class="token number">0x02</span><span class="token punctuation">,</span><span class="token number">0x04</span><span class="token punctuation">,</span><span class="token number">0x08</span><span class="token punctuation">,</span><span class="token number">0x10</span><span class="token punctuation">,</span><span class="token number">0x20</span><span class="token punctuation">,</span><span class="token number">0x40</span><span class="token punctuation">,</span><span class="token number">0x80</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">delay_10us</span><span class="token punctuation">(</span>u16 ten_us<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span>ten_us<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">delay_ms</span><span class="token punctuation">(</span>u16 ms<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	u16 i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span>ms<span class="token punctuation">;</span>i<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">--</span><span class="token punctuation">)</span>
		<span class="token keyword">for</span><span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">110</span><span class="token punctuation">;</span>j<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">hc595_write_data</span><span class="token punctuation">(</span>u8 dat<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	u8 i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token comment">//æŒ‰ä½ï¼Œä»é«˜å–</span>
		SER <span class="token operator">=</span> dat<span class="token operator">&gt;&gt;</span><span class="token number">7</span><span class="token punctuation">;</span><span class="token comment">//å°†æœ€é«˜ä½å³ç§»åˆ°æœ€ä½ä½ï¼Œé«˜ä½å…¨éƒ¨è¡¥0</span>
		dat<span class="token operator">&lt;&lt;=</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//dat = dat &lt;&lt; 1 å°†æœ€é«˜ä½å†é¡¶æ‰ï¼Œä¸‹ä¸€è½®å¾ªç¯å†å³ç§»7ä½</span>
		<span class="token comment">//ä¸ºäº†è¦ä¸Šå‡æ²¿ ä½ç”µå¹³è¯»å–æ•°æ®</span>
		SRCLK <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//é€å…¥ç§»ä½å¯„å­˜å™¨ä¸­</span>
		<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		SRCLK <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
	<span class="token punctuation">}</span>
	rCLK <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//ç§»ä½å¯„å­˜å™¨é€å…¥å­˜å‚¨å¯„å­˜å™¨ä¸­</span>
	<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	rCLK <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>	
	u8 i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	LEDDZ_COL_PORT <span class="token operator">=</span> <span class="token number">0x00</span><span class="token punctuation">;</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>	
		<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token function">hc595_write_data</span><span class="token punctuation">(</span><span class="token number">0x00</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ¶ˆå½±</span>
			<span class="token function">hc595_write_data</span><span class="token punctuation">(</span>ghc595_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">50000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>			
	<span class="token punctuation">}</span>		
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å¤šå—595æ‹“å±•i-o" tabindex="-1"><a class="header-anchor" href="#å¤šå—595æ‹“å±•i-o" aria-hidden="true">#</a> å¤šå—595æ‹“å±•I/O</h3><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">//4*hc595</span>
<span class="token keyword">void</span> <span class="token function">hc595_write_data</span><span class="token punctuation">(</span>u8 dat1<span class="token punctuation">,</span>u8 dat2<span class="token punctuation">,</span>u8 dat3<span class="token punctuation">,</span>u8 dat4<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	u8 i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		SER <span class="token operator">=</span> dat4<span class="token operator">&gt;&gt;</span><span class="token number">7</span><span class="token punctuation">;</span><span class="token comment">//å°†æœ€é«˜ä½å³ç§»åˆ°æœ€ä½ä½ï¼Œé«˜ä½å…¨éƒ¨è¡¥0</span>
		dat4<span class="token operator">&lt;&lt;=</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//dat = dat &lt;&lt; 1 å°†æœ€é«˜ä½å†é¡¶æ‰ï¼Œä¸‹ä¸€è½®å¾ªç¯å†å³ç§»7ä½</span>
		<span class="token comment">//ä¸ºäº†è¦ä¸Šå‡æ²¿ ä½ç”µå¹³è¯»å–æ•°æ®</span>
		SRCLK <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//é€å…¥ç§»ä½å¯„å­˜å™¨ä¸­</span>
		<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		SRCLK <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
	<span class="token punctuation">}</span>
    	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token comment">//æŒ‰ä½ï¼Œä»é«˜å–</span>
		SER <span class="token operator">=</span> dat3<span class="token operator">&gt;&gt;</span><span class="token number">7</span><span class="token punctuation">;</span><span class="token comment">//å°†æœ€é«˜ä½å³ç§»åˆ°æœ€ä½ä½ï¼Œé«˜ä½å…¨éƒ¨è¡¥0</span>
		dat3<span class="token operator">&lt;&lt;=</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//dat = dat &lt;&lt; 1 å°†æœ€é«˜ä½å†é¡¶æ‰ï¼Œä¸‹ä¸€è½®å¾ªç¯å†å³ç§»7ä½</span>
		<span class="token comment">//ä¸ºäº†è¦ä¸Šå‡æ²¿ ä½ç”µå¹³è¯»å–æ•°æ®</span>
		SRCLK <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//é€å…¥ç§»ä½å¯„å­˜å™¨ä¸­</span>
		<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		SRCLK <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
	<span class="token punctuation">}</span>
    	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token comment">//æŒ‰ä½ï¼Œä»é«˜å–</span>
		SER <span class="token operator">=</span> dat2<span class="token operator">&gt;&gt;</span><span class="token number">7</span><span class="token punctuation">;</span><span class="token comment">//å°†æœ€é«˜ä½å³ç§»åˆ°æœ€ä½ä½ï¼Œé«˜ä½å…¨éƒ¨è¡¥0</span>
		dat2<span class="token operator">&lt;&lt;=</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//dat = dat &lt;&lt; 1 å°†æœ€é«˜ä½å†é¡¶æ‰ï¼Œä¸‹ä¸€è½®å¾ªç¯å†å³ç§»7ä½</span>
		<span class="token comment">//ä¸ºäº†è¦ä¸Šå‡æ²¿ ä½ç”µå¹³è¯»å–æ•°æ®</span>
		SRCLK <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//é€å…¥ç§»ä½å¯„å­˜å™¨ä¸­</span>
		<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		SRCLK <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
	<span class="token punctuation">}</span>
    	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token comment">//æŒ‰ä½ï¼Œä»é«˜å–</span>
		SER <span class="token operator">=</span> dat1<span class="token operator">&gt;&gt;</span><span class="token number">7</span><span class="token punctuation">;</span><span class="token comment">//å°†æœ€é«˜ä½å³ç§»åˆ°æœ€ä½ä½ï¼Œé«˜ä½å…¨éƒ¨è¡¥0</span>
		dat1<span class="token operator">&lt;&lt;=</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//dat = dat &lt;&lt; 1 å°†æœ€é«˜ä½å†é¡¶æ‰ï¼Œä¸‹ä¸€è½®å¾ªç¯å†å³ç§»7ä½</span>
		<span class="token comment">//ä¸ºäº†è¦ä¸Šå‡æ²¿ ä½ç”µå¹³è¯»å–æ•°æ®</span>
		SRCLK <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//é€å…¥ç§»ä½å¯„å­˜å™¨ä¸­</span>
		<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		SRCLK <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
	<span class="token punctuation">}</span>
	RCLK <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//ç§»ä½å¯„å­˜å™¨é€å…¥å­˜å‚¨å¯„å­˜å™¨ä¸­</span>
	<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	RCLK <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token comment">//ç›¸å½“äº4ç‰‡ä¸²è”595æ˜¯ä¸€ä¸ª4*8ä½çš„ç§»ä½å¯„å­˜å™¨</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ledç‚¹é˜µ" tabindex="-1"><a class="header-anchor" href="#ledç‚¹é˜µ" aria-hidden="true">#</a> LEDç‚¹é˜µ</h2><p><strong>ç®€å•ç‚¹äº®ä¸€ä¸ªç¯</strong></p><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;reg52.h&quot;</span></span>

<span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> u16<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> u8<span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LED_PORT</span> <span class="token expression">P0</span></span>

sbit SRCLK <span class="token operator">=</span> P3<span class="token operator">^</span><span class="token number">6</span><span class="token punctuation">;</span><span class="token comment">//ç§»ä½å¯„å­˜å™¨æ—¶é’Ÿ</span>
sbit rCLK <span class="token operator">=</span> P3<span class="token operator">^</span><span class="token number">5</span><span class="token punctuation">;</span><span class="token comment">//å­˜å‚¨å¯„å­˜å™¨æ—¶é’Ÿ</span>
sbit SER <span class="token operator">=</span> P3<span class="token operator">^</span><span class="token number">4</span><span class="token punctuation">;</span><span class="token comment">//ä¸²è¡Œè¾“å…¥595</span>
	 
<span class="token keyword">void</span> <span class="token function">delay_10us</span><span class="token punctuation">(</span>u16 us<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span>us<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">hc595_write_data</span><span class="token punctuation">(</span>u8 dat<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	u8 i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		SER <span class="token operator">=</span> dat<span class="token operator">&gt;&gt;</span><span class="token number">7</span><span class="token punctuation">;</span>
		dat<span class="token operator">&lt;&lt;=</span><span class="token number">1</span><span class="token punctuation">;</span>
		SRCLK <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		SRCLK <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	rCLK <span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	rCLK <span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	u8 LED_DZ <span class="token operator">=</span> <span class="token number">0x80</span><span class="token punctuation">;</span>
	LED_PORT <span class="token operator">=</span> <span class="token operator">~</span><span class="token number">0x80</span><span class="token punctuation">;</span>
	
	<span class="token function">hc595_write_data</span><span class="token punctuation">(</span>LED_DZ<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
				
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>åˆ—æ‰«ææ˜¾ç¤º</strong>â¤ï¸</p><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;reg52.h&quot;</span></span>

<span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> u16<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> u8<span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LED_PORT</span> <span class="token expression">P0</span></span>

sbit SRCLK <span class="token operator">=</span> P3<span class="token operator">^</span><span class="token number">6</span><span class="token punctuation">;</span><span class="token comment">//ç§»ä½å¯„å­˜å™¨æ—¶é’Ÿ</span>
sbit rCLK <span class="token operator">=</span> P3<span class="token operator">^</span><span class="token number">5</span><span class="token punctuation">;</span><span class="token comment">//å­˜å‚¨å¯„å­˜å™¨æ—¶é’Ÿ</span>
sbit SER <span class="token operator">=</span> P3<span class="token operator">^</span><span class="token number">4</span><span class="token punctuation">;</span><span class="token comment">//ä¸²è¡Œè¾“å…¥595</span>

u8 gled_row<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x38</span><span class="token punctuation">,</span><span class="token number">0x44</span><span class="token punctuation">,</span><span class="token number">0x22</span><span class="token punctuation">,</span><span class="token number">0x11</span><span class="token punctuation">,</span><span class="token number">0x22</span><span class="token punctuation">,</span><span class="token number">0x44</span><span class="token punctuation">,</span><span class="token number">0x38</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
u8 gled_col<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0x7f</span><span class="token punctuation">,</span><span class="token number">0xbf</span><span class="token punctuation">,</span><span class="token number">0xdf</span><span class="token punctuation">,</span><span class="token number">0xef</span><span class="token punctuation">,</span><span class="token number">0xf7</span><span class="token punctuation">,</span><span class="token number">0xfb</span><span class="token punctuation">,</span><span class="token number">0xfd</span><span class="token punctuation">,</span><span class="token number">0xfe</span><span class="token punctuation">}</span><span class="token punctuation">;</span>	 
<span class="token keyword">void</span> <span class="token function">delay_10us</span><span class="token punctuation">(</span>u16 us<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span>us<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">hc595_write_data</span><span class="token punctuation">(</span>u8 dat<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	u8 i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		SER <span class="token operator">=</span> dat<span class="token operator">&gt;&gt;</span><span class="token number">7</span><span class="token punctuation">;</span>
		dat<span class="token operator">&lt;&lt;=</span><span class="token number">1</span><span class="token punctuation">;</span>
		SRCLK <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		SRCLK <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	rCLK <span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	rCLK <span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	u8 i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			LED_PORT <span class="token operator">=</span> gled_col<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
			<span class="token function">hc595_write_data</span><span class="token punctuation">(</span>gled_row<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">hc595_write_data</span><span class="token punctuation">(</span><span class="token number">0x00</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ¶ˆå½±</span>
		<span class="token punctuation">}</span>		
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ç›´æµç”µæœº" tabindex="-1"><a class="header-anchor" href="#ç›´æµç”µæœº" aria-hidden="true">#</a> ç›´æµç”µæœº</h2><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;reg52.h&quot;</span></span>

<span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> u16<span class="token punctuation">;</span>	<span class="token comment">//å¯¹ç³»ç»Ÿé»˜è®¤æ•°æ®ç±»å‹è¿›è¡Œé‡å®šä¹‰</span>
<span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> u8<span class="token punctuation">;</span>

<span class="token comment">//å®šä¹‰ç›´æµç”µæœºæ§åˆ¶ç®¡è„š</span>
sbit DC_Motor<span class="token operator">=</span>P1<span class="token operator">^</span><span class="token number">0</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">DC_MOTOR_RUN_TIME</span>	<span class="token expression"><span class="token number">5000</span>	</span><span class="token comment">//å®šä¹‰ç›´æµç”µæœºè¿è¡Œæ—¶é—´ä¸º5000ms</span></span>

<span class="token keyword">void</span> <span class="token function">delay_ms</span><span class="token punctuation">(</span>u16 ms<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	u16 i<span class="token punctuation">,</span>j<span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span>ms<span class="token punctuation">;</span>i<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">--</span><span class="token punctuation">)</span>
		<span class="token keyword">for</span><span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">110</span><span class="token punctuation">;</span>j<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>	
	DC_Motor<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//å¼€å¯ç”µæœº</span>
	<span class="token function">delay_ms</span><span class="token punctuation">(</span>DC_MOTOR_RUN_TIME<span class="token punctuation">)</span><span class="token punctuation">;</span>
	DC_Motor<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//å…³é—­ç”µæœº</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>			
								
	<span class="token punctuation">}</span>		
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="æ­¥è¿›ç”µæœº" tabindex="-1"><a class="header-anchor" href="#æ­¥è¿›ç”µæœº" aria-hidden="true">#</a> æ­¥è¿›ç”µæœº</h2><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;reg52.h&quot;</span></span>

<span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> u16<span class="token punctuation">;</span>	<span class="token comment">//å¯¹ç³»ç»Ÿé»˜è®¤æ•°æ®ç±»å‹è¿›è¡Œé‡å®šä¹‰</span>
<span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> u8<span class="token punctuation">;</span>

<span class="token comment">//å®šä¹‰ULN2003æ§åˆ¶æ­¥è¿›ç”µæœºç®¡è„š</span>
sbit IN1_A<span class="token operator">=</span>P1<span class="token operator">^</span><span class="token number">0</span><span class="token punctuation">;</span>
sbit IN2_B<span class="token operator">=</span>P1<span class="token operator">^</span><span class="token number">1</span><span class="token punctuation">;</span>
sbit IN3_C<span class="token operator">=</span>P1<span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">;</span>
sbit IN4_D<span class="token operator">=</span>P1<span class="token operator">^</span><span class="token number">3</span><span class="token punctuation">;</span>

<span class="token comment">//å®šä¹‰ç‹¬ç«‹æŒ‰é”®æ§åˆ¶è„š</span>
sbit KEY1<span class="token operator">=</span>P3<span class="token operator">^</span><span class="token number">1</span><span class="token punctuation">;</span>
sbit KEY2<span class="token operator">=</span>P3<span class="token operator">^</span><span class="token number">0</span><span class="token punctuation">;</span>
sbit KEY3<span class="token operator">=</span>P3<span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">;</span>
sbit KEY4<span class="token operator">=</span>P3<span class="token operator">^</span><span class="token number">3</span><span class="token punctuation">;</span>

<span class="token comment">//ä½¿ç”¨å®å®šä¹‰ç‹¬ç«‹æŒ‰é”®æŒ‰ä¸‹çš„é”®å€¼</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">KEY1_PRESS</span>	<span class="token expression"><span class="token number">1</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">KEY2_PRESS</span>	<span class="token expression"><span class="token number">2</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">KEY3_PRESS</span>	<span class="token expression"><span class="token number">3</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">KEY4_PRESS</span>	<span class="token expression"><span class="token number">4</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">KEY_UNPRESS</span>	<span class="token expression"><span class="token number">0</span></span></span>

<span class="token comment">// å®šä¹‰æ­¥è¿›ç”µæœºé€Ÿåº¦ï¼Œå€¼è¶Šå°ï¼Œé€Ÿåº¦è¶Šå¿«</span>
<span class="token comment">// æœ€å°ä¸èƒ½å°äº1</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">STEPMOTOR_MAXSPEED</span>        <span class="token expression"><span class="token number">1</span>  </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">STEPMOTOR_MINSPEED</span>        <span class="token expression"><span class="token number">5</span>  	</span></span>

<span class="token keyword">void</span> <span class="token function">delay_10us</span><span class="token punctuation">(</span>u16 ten_us<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span>ten_us<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">delay_ms</span><span class="token punctuation">(</span>u16 ms<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	u16 i<span class="token punctuation">,</span>j<span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span>ms<span class="token punctuation">;</span>i<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">--</span><span class="token punctuation">)</span>
		<span class="token keyword">for</span><span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">110</span><span class="token punctuation">;</span>j<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">step_motor_28BYJ48_send_pulse</span><span class="token punctuation">(</span>u8 step<span class="token punctuation">,</span>u8 dir<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	u8 temp<span class="token operator">=</span>step<span class="token punctuation">;</span>
	
	<span class="token keyword">if</span><span class="token punctuation">(</span>dir<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>	<span class="token comment">//å¦‚æœä¸ºé€†æ—¶é’ˆæ—‹è½¬</span>
		temp<span class="token operator">=</span><span class="token number">7</span><span class="token operator">-</span>step<span class="token punctuation">;</span><span class="token comment">//è°ƒæ¢èŠ‚æ‹ä¿¡å·</span>
	<span class="token keyword">switch</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token comment">//8ä¸ªèŠ‚æ‹æ§åˆ¶ï¼šA-&gt;AB-&gt;B-&gt;BC-&gt;C-&gt;CD-&gt;D-&gt;DA</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span> IN1_A<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>IN2_B<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>IN3_C<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>IN4_D<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span> IN1_A<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>IN2_B<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>IN3_C<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>IN4_D<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span> IN1_A<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>IN2_B<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>IN3_C<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>IN4_D<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span> IN1_A<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>IN2_B<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>IN3_C<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>IN4_D<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span> IN1_A<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>IN2_B<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>IN3_C<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>IN4_D<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token number">5</span><span class="token operator">:</span> IN1_A<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>IN2_B<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>IN3_C<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>IN4_D<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token number">6</span><span class="token operator">:</span> IN1_A<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>IN2_B<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>IN3_C<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>IN4_D<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token number">7</span><span class="token operator">:</span> IN1_A<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>IN2_B<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>IN3_C<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>IN4_D<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">default</span><span class="token operator">:</span> IN1_A<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>IN2_B<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>IN3_C<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>IN4_D<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token comment">//åœæ­¢ç›¸åº	</span>
	<span class="token punctuation">}</span>			
<span class="token punctuation">}</span>

u8 <span class="token function">key_scan</span><span class="token punctuation">(</span>u8 mode<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">static</span> u8 key<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span>mode<span class="token punctuation">)</span>key<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//è¿ç»­æ‰«ææŒ‰é”®</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>key<span class="token operator">==</span><span class="token number">1</span><span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span>KEY1<span class="token operator">==</span><span class="token number">0</span><span class="token operator">||</span>KEY2<span class="token operator">==</span><span class="token number">0</span><span class="token operator">||</span>KEY3<span class="token operator">==</span><span class="token number">0</span><span class="token operator">||</span>KEY4<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//ä»»æ„æŒ‰é”®æŒ‰ä¸‹</span>
	<span class="token punctuation">{</span>
		<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ¶ˆæŠ–</span>
		key<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>KEY1<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span> KEY1_PRESS<span class="token punctuation">;</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>KEY2<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span> KEY2_PRESS<span class="token punctuation">;</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>KEY3<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span> KEY3_PRESS<span class="token punctuation">;</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>KEY4<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span> KEY4_PRESS<span class="token punctuation">;</span>	
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>KEY1<span class="token operator">==</span><span class="token number">1</span><span class="token operator">&amp;&amp;</span>KEY2<span class="token operator">==</span><span class="token number">1</span><span class="token operator">&amp;&amp;</span>KEY3<span class="token operator">==</span><span class="token number">1</span><span class="token operator">&amp;&amp;</span>KEY4<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span>	<span class="token comment">//æ— æŒ‰é”®æŒ‰ä¸‹</span>
	<span class="token punctuation">{</span>
		key<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>			
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> KEY_UNPRESS<span class="token punctuation">;</span>		
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>	
	u8 key<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	u8 dir<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//é»˜è®¤é€†æ—¶é’ˆæ–¹å‘</span>
	u8 speed<span class="token operator">=</span>STEPMOTOR_MAXSPEED<span class="token punctuation">;</span><span class="token comment">//é»˜è®¤æœ€å¤§é€Ÿåº¦æ—‹è½¬</span>
	u8 step<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>			
		key<span class="token operator">=</span><span class="token function">key_scan</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>key<span class="token operator">==</span>KEY1_PRESS<span class="token punctuation">)</span><span class="token comment">//æ¢å‘</span>
		<span class="token punctuation">{</span>
			dir<span class="token operator">=</span><span class="token operator">!</span>dir<span class="token punctuation">;</span>    
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>key<span class="token operator">==</span>KEY2_PRESS<span class="token punctuation">)</span><span class="token comment">//åŠ é€Ÿ</span>
		<span class="token punctuation">{</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>speed<span class="token operator">&gt;</span>STEPMOTOR_MAXSPEED<span class="token punctuation">)</span>
				speed<span class="token operator">-=</span><span class="token number">1</span><span class="token punctuation">;</span>			
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>key<span class="token operator">==</span>KEY3_PRESS<span class="token punctuation">)</span><span class="token comment">//å‡é€Ÿ</span>
		<span class="token punctuation">{</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>speed<span class="token operator">&lt;</span>STEPMOTOR_MINSPEED<span class="token punctuation">)</span>
				speed<span class="token operator">+=</span><span class="token number">1</span><span class="token punctuation">;</span>			
		<span class="token punctuation">}</span>
		<span class="token function">step_motor_28BYJ48_send_pulse</span><span class="token punctuation">(</span>step<span class="token operator">++</span><span class="token punctuation">,</span>dir<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>step<span class="token operator">==</span><span class="token number">8</span><span class="token punctuation">)</span>step<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>		
		<span class="token function">delay_ms</span><span class="token punctuation">(</span>speed<span class="token punctuation">)</span><span class="token punctuation">;</span>						
	<span class="token punctuation">}</span>		
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="å¤–éƒ¨ä¸­æ–­å®éªŒ" tabindex="-1"><a class="header-anchor" href="#å¤–éƒ¨ä¸­æ–­å®éªŒ" aria-hidden="true">#</a> å¤–éƒ¨ä¸­æ–­å®éªŒ</h2><p><strong>ä¸­æ–­ä¼˜ç‚¹ï¼šåˆ†æ—¶æ“ä½œã€å®æ—¶å“åº”ã€å¯é æ€§é«˜</strong></p><p>ä¸­æ–­ç»“æ„</p><p><img src="https://img30.360buyimg.com/pop/jfs/t1/102504/20/25165/212149/6238289aE55ba7827/4f22a28acf170cb7.png" alt="image-20220320213823253.png"></p><p>ä¸­æ–­å…è®¸æ§åˆ¶</p><p><img src="https://img30.360buyimg.com/pop/jfs/t1/115257/16/26289/32696/623828d0Eb1d2801c/d2a8bf1b2cc6b7f8.png" alt="image-20220320212826772.png"></p><p><code>EA</code>ä¸­æ–­æ€»æ§ï¼Œ<code>ES</code>ä¸²å£ä¸­æ–­</p><p>ä¸­æ–­è¯·æ±‚æ ‡å¿— <code>TCON</code></p><p><img src="https://img30.360buyimg.com/pop/jfs/t1/123690/11/22485/35552/623828e5E9f92bd7d/3b32bc87bd85f7e6.png" alt="image-20220320212904896.png"></p><p>ä¸­æ–­ä¼˜å…ˆçº§</p><p><img src="https://img30.360buyimg.com/pop/jfs/t1/217399/19/15298/88083/623828f5Ed57012a5/f4b1eec323aa0091.png" alt="image-20220320213036855.png"></p><p>ä¸­æ–­å·</p><p><img src="https://img30.360buyimg.com/pop/jfs/t1/121814/2/25165/162149/62382907E3cf190d3/45187a3e7a526ddd.png" alt="image-20220320213111227.png"></p><p>ä¸­æ–­å“åº”æ¡ä»¶</p><ol><li><p>ä¸­æ–­æºæœ‰ä¸­æ–­è¯·æ±‚ï¼›</p></li><li><p>ä¸­æ–­æºçš„ä¸­æ–­å…è®¸ä½ä¸º<code> 1</code>ï¼›</p></li><li><p>CPU å¼€ä¸­æ–­ï¼ˆå³ <code>EA=1</code>ï¼‰</p></li></ol><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;reg52.h&quot;</span></span>

<span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> u16<span class="token punctuation">;</span>	<span class="token comment">//å¯¹ç³»ç»Ÿé»˜è®¤æ•°æ®ç±»å‹è¿›è¡Œé‡å®šä¹‰</span>
<span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> u8<span class="token punctuation">;</span>

<span class="token comment">//å®šä¹‰LED1ç®¡è„š</span>
sbit LED1<span class="token operator">=</span>P2<span class="token operator">^</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token comment">//å®šä¹‰ç‹¬ç«‹æŒ‰é”®K3æ§åˆ¶è„š</span>
sbit KEY3<span class="token operator">=</span>P3<span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">delay_10us</span><span class="token punctuation">(</span>u16 ten_us<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span>ten_us<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">exti0_init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	IT0<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//è·³å˜æ²¿è§¦å‘æ–¹å¼ï¼ˆä¸‹é™æ²¿ï¼‰</span>
	EX0<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//æ‰“å¼€INT0çš„ä¸­æ–­å…è®¸</span>
	EA<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//æ‰“å¼€æ€»ä¸­æ–­</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>	
	<span class="token function">exti0_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å¤–éƒ¨ä¸­æ–­0é…ç½®</span>

	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>			
							
	<span class="token punctuation">}</span>		
<span class="token punctuation">}</span>
<span class="token comment">//interruptå…³é”®å­—å¿…é¡»æœ‰ 0ä¸ºä¸­æ–­å·  using 1é»˜è®¤å¯çœç•¥</span>
<span class="token keyword">void</span> <span class="token function">exti0</span><span class="token punctuation">(</span><span class="token punctuation">)</span> interrupt <span class="token number">0</span> <span class="token comment">//å¤–éƒ¨ä¸­æ–­0ä¸­æ–­å‡½æ•°</span>
<span class="token punctuation">{</span>
	<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ¶ˆæ–—</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>KEY3<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">//å†æ¬¡åˆ¤æ–­K3é”®æ˜¯å¦æŒ‰ä¸‹</span>
		LED1<span class="token operator">=</span><span class="token operator">!</span>LED1<span class="token punctuation">;</span><span class="token comment">//LED1çŠ¶æ€ç¿»è½¬					</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="å®šæ—¶å™¨ä¸­æ–­" tabindex="-1"><a class="header-anchor" href="#å®šæ—¶å™¨ä¸­æ–­" aria-hidden="true">#</a> å®šæ—¶å™¨ä¸­æ–­</h2><p>ï¼ˆ1ï¼‰æŒ¯è¡å‘¨æœŸ</p><p>ï¼ˆ2ï¼‰çŠ¶æ€å‘¨æœŸ</p><p>ï¼ˆ3ï¼‰æœºå™¨å‘¨æœŸ</p><p>ï¼ˆ4ï¼‰æŒ‡ä»¤å‘¨æœŸ</p><p>ä¾‹å¦‚ï¼šå¤–æ¥æ™¶æŒ¯ä¸º<code> 12MHz</code> æ—¶ï¼Œ51 å•ç‰‡æœºç›¸å…³å‘¨æœŸçš„å…·ä½“å€¼ä¸ºï¼š</p><p>æŒ¯è¡å‘¨æœŸ=<code>1/12us</code></p><p>çŠ¶æ€å‘¨æœŸ=<code>1/6us</code></p><p>æœºå™¨å‘¨æœŸ=<code>1us</code></p><p>æŒ‡ä»¤å‘¨æœŸ=<code>1~4us</code></p><p><img src="https://img30.360buyimg.com/pop/jfs/t1/210255/19/19597/182028/62382924E42b890a7/5b8d1e222b627413.png" alt="image-20220320215942260.png"></p><p>å·¥ä½œæ–¹å¼å¯„å­˜å™¨<code>TMOD</code></p><p><img src="https://img30.360buyimg.com/pop/jfs/t1/100614/19/26333/38906/6238293cE176ca320/bccde1463432a10d.png" alt="image-20220320220125247.png"></p><p><img src="https://img30.360buyimg.com/pop/jfs/t1/134163/21/25439/99066/6238294aEe3fad417/d74e9cf35a310711.png" alt="image-20220320220129968.png"></p><p>æ§åˆ¶å¯„å­˜å™¨<code>TCON</code></p><p><img src="https://img30.360buyimg.com/pop/jfs/t1/132961/19/25595/31676/6238295aE485da5a3/daa21150f7dadd04.png" alt="image-20220320220317557.png"></p><p><strong>å®šæ—¶å™¨é…ç½®</strong></p><ol><li><p>å¯¹ TMOD èµ‹å€¼ï¼Œä»¥ç¡®å®š T0 å’Œ T1 çš„å·¥ä½œæ–¹å¼</p></li><li><p>æ ¹æ®æ‰€è¦å®šæ—¶çš„æ—¶é—´è®¡ç®—åˆå€¼,å¹¶å°†å…¶å†™å…¥ TH0ã€TL0 æˆ– TH1ã€TL1</p></li><li><p>å¦‚æœä½¿ç”¨ä¸­æ–­ï¼Œåˆ™å¯¹ EA èµ‹å€¼ï¼Œå¼€æ”¾å®šæ—¶å™¨ä¸­æ–­</p></li><li><p>ä½¿ TR0 æˆ– TR1 ç½®ä½ï¼Œå¯åŠ¨å®šæ—¶/è®¡æ•°å™¨å®šæ—¶æˆ–è®¡æ•°</p></li></ol><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;reg52.h&quot;</span></span>

<span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> u16<span class="token punctuation">;</span>	<span class="token comment">//å¯¹ç³»ç»Ÿé»˜è®¤æ•°æ®ç±»å‹è¿›è¡Œé‡å®šä¹‰</span>
<span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> u8<span class="token punctuation">;</span>

<span class="token comment">//å®šä¹‰LED1ç®¡è„š</span>
sbit LED1<span class="token operator">=</span>P2<span class="token operator">^</span><span class="token number">0</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">time0_init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	TMOD<span class="token operator">|=</span><span class="token number">0X01</span><span class="token punctuation">;</span><span class="token comment">//é€‰æ‹©ä¸ºå®šæ—¶å™¨0æ¨¡å¼ï¼Œå·¥ä½œæ–¹å¼1</span>
	TH0<span class="token operator">=</span><span class="token number">0XFC</span><span class="token punctuation">;</span>	<span class="token comment">//ç»™å®šæ—¶å™¨èµ‹åˆå€¼ï¼Œå®šæ—¶1ms</span>
	TL0<span class="token operator">=</span><span class="token number">0X66</span><span class="token punctuation">;</span>	 <span class="token comment">//11.0592MHZ 1ms FC66</span>
	ET0<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//æ‰“å¼€å®šæ—¶å™¨0ä¸­æ–­å…è®¸</span>
	EA<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//æ‰“å¼€æ€»ä¸­æ–­</span>
	TR0<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//æ‰“å¼€å®šæ—¶å™¨		</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">time1_init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	TMOD<span class="token operator">|=</span> <span class="token number">0x10</span><span class="token punctuation">;</span>
	TH1 <span class="token operator">=</span> <span class="token number">0xFC</span><span class="token punctuation">;</span>
	TL1 <span class="token operator">=</span> <span class="token number">0x18</span><span class="token punctuation">;</span>
	EA <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	ET1 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	TR1 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>	
	<span class="token function">time0_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å®šæ—¶å™¨0ä¸­æ–­é…ç½®</span>

	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>			
							
	<span class="token punctuation">}</span>		
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">time0</span><span class="token punctuation">(</span><span class="token punctuation">)</span> interrupt <span class="token number">1</span> <span class="token comment">//å®šæ—¶å™¨0ä¸­æ–­å‡½æ•°</span>
<span class="token punctuation">{</span>
	<span class="token keyword">static</span> u16 i<span class="token punctuation">;</span><span class="token comment">//å®šä¹‰é™æ€å˜é‡i</span>
	TH0<span class="token operator">=</span><span class="token number">0XFC</span><span class="token punctuation">;</span>	<span class="token comment">//ç»™å®šæ—¶å™¨èµ‹åˆå€¼ï¼Œå®šæ—¶1ms</span>
	TL0<span class="token operator">=</span><span class="token number">0X66</span><span class="token punctuation">;</span>
	i<span class="token operator">++</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">==</span><span class="token number">1000</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
		LED1<span class="token operator">=</span><span class="token operator">!</span>LED1<span class="token punctuation">;</span>	
	<span class="token punctuation">}</span>						
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">time1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> interrupt <span class="token number">3</span>
<span class="token punctuation">{</span>
	<span class="token keyword">static</span> u16 i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	TH1 <span class="token operator">=</span> <span class="token number">0xFC</span><span class="token punctuation">;</span>
	TL1 <span class="token operator">=</span> <span class="token number">0x66</span><span class="token punctuation">;</span>

	i<span class="token operator">++</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">==</span><span class="token number">1000</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		LED_1 <span class="token operator">=</span> <span class="token operator">!</span>LED_1<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>			
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ä¸²å£é€šä¿¡å®éªŒ" tabindex="-1"><a class="header-anchor" href="#ä¸²å£é€šä¿¡å®éªŒ" aria-hidden="true">#</a> ä¸²å£é€šä¿¡å®éªŒ</h2><p><img src="https://img30.360buyimg.com/pop/jfs/t1/132973/35/25204/38658/6238296cE1716865d/4d26f21dbce8e8fa.png" alt="image-20220320224830628.png"></p><p><strong>äº¤å‰è¿æ¥</strong></p><p><code>RS232</code> çš„é€šä¿¡åè®®æ¯”è¾ƒç®€å•ï¼Œé€šå¸¸éµå¾ª<code>96-N-8-1</code>æ ¼å¼</p><p><code>9600bps</code>-<code>æ— æ ¡éªŒä½</code>-<code>8ä½</code>-<code>1ä¸ªåœæ­¢ä½</code></p><p><strong>ä¸²å£æ§åˆ¶å¯„å­˜å™¨<code>SCON</code></strong></p><p><img src="https://img30.360buyimg.com/pop/jfs/t1/94738/1/25503/29657/6238297bE912d5cad/f8361c0dd764b66c.png" alt="image-20220320225145969.png"></p><p><img src="https://img30.360buyimg.com/pop/jfs/t1/118189/11/22842/83519/6238298bEcc923ebe/95f0644e3ea95ec0.png" alt="image-20220320225152348.png"></p><p><strong>ç”µæºæ§åˆ¶å¯„å­˜å™¨<code> PCON</code></strong></p><p><img src="https://img30.360buyimg.com/pop/jfs/t1/81723/14/16674/27177/6238299cEccb66db7/593b044a11a54931.png" alt="image-20220321115611808.png"></p><p><img src="https://img30.360buyimg.com/pop/jfs/t1/93259/40/23963/159182/623829b2Ef81f3e60/4603aad03e10701b.png" alt="image-20220321115640496.png"></p><p><img src="https://img30.360buyimg.com/pop/jfs/t1/219124/11/15268/43973/623829fcE21a38066/e99b98c6635d09df.png" alt="image-20220321115700822.png"></p><p><img src="https://img30.360buyimg.com/pop/jfs/t1/178031/40/22029/138601/62382a16E8bac6561/6094badde42fe2d1.png" alt="image-20220321115708291.png"></p><p><img src="https://img30.360buyimg.com/pop/jfs/t1/138330/39/23699/43056/62382a2fE1a9c9b9b/149982472cf355f1.png" alt="image-20220321115719737.png"></p><p><img src="https://img30.360buyimg.com/pop/jfs/t1/115388/36/22219/67030/62382a4aEc0bcbd88/e165476d52019d38.png" alt="image-20220321115726773.png"></p><p><img src="https://img30.360buyimg.com/pop/jfs/t1/186289/38/21655/85013/62382a56E21511df5/eca4508be2d9170f.png" alt="image-20220321115731742.png"></p><p><strong>è®¡ç®—æ³¢ç‰¹ç‡</strong></p><p>æ–¹å¼ 0 çš„æ³¢ç‰¹ç‡ = <code>fosc/12 </code></p><p>æ–¹å¼ 2 çš„æ³¢ç‰¹ç‡ =<code>ï¼ˆ2SMOD/64ï¼‰Â· fosc </code></p><p>æ–¹å¼ 1 çš„æ³¢ç‰¹ç‡ =<code>ï¼ˆ2SMOD/32ï¼‰Â·ï¼ˆT1 æº¢å‡ºç‡ï¼‰ </code></p><p>æ–¹å¼ 3 çš„æ³¢ç‰¹ç‡ =<code>ï¼ˆ2SMOD/32ï¼‰Â·ï¼ˆT1 æº¢å‡ºç‡ï¼‰ </code></p><p>å…¶ä¸­ T1 æº¢å‡ºç‡ =<code>fosc /{12Ã—[256 ï¼ï¼ˆTH1ï¼‰]}</code></p><p><strong>ä¸²å£åˆå§‹åŒ–æ­¥éª¤</strong></p><ol><li><p>ç¡®å®š<code>T1</code> çš„å·¥ä½œæ–¹å¼ï¼ˆ<code>TMOD</code> å¯„å­˜å™¨ï¼‰ï¼›</p></li><li><p>ç¡®å®šä¸²å£å·¥ä½œæ–¹å¼ï¼ˆ<code>SCON </code>å¯„å­˜å™¨ï¼‰ï¼›</p></li><li><p>è®¡ç®—<code>T1</code>çš„åˆå€¼ï¼ˆè®¾å®šæ³¢ç‰¹ç‡ï¼‰ï¼Œè£…è½½<code>TH1</code>ã€<code>TL1</code>ï¼›</p></li><li><p>å¯åŠ¨<code>T1</code>ï¼ˆ<code>TCON</code> ä¸­çš„<code>TR1</code>ä½ï¼‰ï¼›</p></li><li><p>å¦‚æœä½¿ç”¨ä¸­æ–­ï¼Œéœ€å¼€å¯ä¸²å£ä¸­æ–­æ§åˆ¶ä½ï¼ˆ<code>IE</code>å¯„å­˜å™¨ï¼‰ã€‚</p></li></ol><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;reg52.h&quot;</span></span>

<span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> u16<span class="token punctuation">;</span>	<span class="token comment">//å¯¹ç³»ç»Ÿé»˜è®¤æ•°æ®ç±»å‹è¿›è¡Œé‡å®šä¹‰</span>
<span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> u8<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">uart_init</span><span class="token punctuation">(</span>u8 baud<span class="token punctuation">)</span><span class="token comment">//baud æ³¢ç‰¹ç‡</span>
<span class="token punctuation">{</span>
	TMOD<span class="token operator">|=</span><span class="token number">0X20</span><span class="token punctuation">;</span>	<span class="token comment">//è®¾ç½®è®¡æ•°å™¨å·¥ä½œæ–¹å¼2</span>
	SCON<span class="token operator">=</span><span class="token number">0X50</span><span class="token punctuation">;</span>	<span class="token comment">//è®¾ç½®ä¸ºå·¥ä½œæ–¹å¼1</span>
	PCON<span class="token operator">=</span><span class="token number">0X80</span><span class="token punctuation">;</span>	<span class="token comment">//æ³¢ç‰¹ç‡åŠ å€</span>
	TH1<span class="token operator">=</span>baud<span class="token punctuation">;</span>	<span class="token comment">//è®¡æ•°å™¨åˆå§‹å€¼è®¾ç½®</span>
	TL1<span class="token operator">=</span>baud<span class="token punctuation">;</span>
	ES<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>		<span class="token comment">//æ‰“å¼€æ¥æ”¶ä¸­æ–­</span>
	EA<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>		<span class="token comment">//æ‰“å¼€æ€»ä¸­æ–­</span>
	TR1<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>		<span class="token comment">//æ‰“å¼€è®¡æ•°å™¨		</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>	
	<span class="token function">uart_init</span><span class="token punctuation">(</span><span class="token number">0XFA</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ³¢ç‰¹ç‡ä¸º9600</span>

	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>			
							
	<span class="token punctuation">}</span>		
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">uart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> interrupt <span class="token number">4</span> <span class="token comment">//ä¸²å£é€šä¿¡ä¸­æ–­å‡½æ•°</span>
<span class="token punctuation">{</span>
	u8 rec_data<span class="token punctuation">;</span>

	RI <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>			<span class="token comment">//æ¸…é™¤æ¥æ”¶ä¸­æ–­æ ‡å¿—ä½</span>
	rec_data<span class="token operator">=</span>SBUF<span class="token punctuation">;</span>	<span class="token comment">//å­˜å‚¨æ¥æ”¶åˆ°çš„æ•°æ®</span>
	SBUF<span class="token operator">=</span>rec_data<span class="token punctuation">;</span>	<span class="token comment">//å°†æ¥æ”¶åˆ°çš„æ•°æ®æ”¾å…¥åˆ°å‘é€å¯„å­˜å™¨</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>TI<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//ç­‰å¾…å‘é€æ•°æ®å®Œæˆ</span>
	TI<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>			<span class="token comment">//æ¸…é™¤å‘é€å®Œæˆæ ‡å¿—ä½				</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="i2c-eepromå®éªŒ" tabindex="-1"><a class="header-anchor" href="#i2c-eepromå®éªŒ" aria-hidden="true">#</a> I2C-EEPROMå®éªŒ</h2><p><strong>åº”ç­”å“åº”</strong></p><p>åº”ç­”ä¿¡å·åœ¨ç¬¬9ä¸ªæ—¶é’Ÿä¸Šå‡ºç°ï¼Œæ¥æ”¶å™¨è¾“å‡ºä½ç”µå¹³ä¸º<code>ack</code>ï¼Œè¾“å‡ºé«˜ç”µå¹³åˆ™ä¸º<code>nack</code></p><p><img src="https://img30.360buyimg.com/pop/jfs/t1/129748/3/24537/44707/62382a66E29486ef5/0da5c42497b8b36a.png" alt="image-20220321131056728.png"></p><p><strong>æ€»çº¿çš„å¯»å€æ–¹å¼</strong></p><p><img src="https://img30.360buyimg.com/pop/jfs/t1/112795/39/22039/13586/62382a71Ed8f523a0/53e17bfd85579191.png" alt="image-20220321131159308.png"></p><p><img src="https://img30.360buyimg.com/pop/jfs/t1/135827/22/24927/40977/62382a7bEd78d57d5/7a8ee232412feade.png" alt="image-20220321131219263.png"></p><p><img src="https://img30.360buyimg.com/pop/jfs/t1/99591/35/23823/31589/62382a8bE6140aa18/0f191b4e6cdd1bcc.png" alt="image-20220321131224997.png"></p><p><img src="https://img30.360buyimg.com/pop/jfs/t1/86940/30/25601/64704/62382a9bEbbd94082/8ca2af1bb0afa7ad.png" alt="image-20220321131228846.png"></p><p><strong>AT24C02ï¼ˆEEPROMï¼‰</strong></p><p><img src="https://img30.360buyimg.com/pop/jfs/t1/179422/29/21515/19800/62382aa9Ec563ad8d/a143a731537d7aa5.png" alt="image-20220321131354483.png"></p><p><img src="https://img30.360buyimg.com/pop/jfs/t1/222249/3/13419/45443/62382ab3E98750685/3f001177c8bf9174.png" alt="image-20220321131424671.png"></p><p><strong>æ–‡ä»¶æ‹“æ‰‘ç»“æ„</strong></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>.
|--APP
|	|--key.c
|	|--smg.c
|	|--I2C.c
|	|--at24c02.c
|--User
|	|--main.c
|--Public
|	|--public.c
|--OBJ
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">//main.c</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;public.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;key.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;smg.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;at24c02.h&quot;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">EEPROM_ADDRESS</span> <span class="token expression"><span class="token number">0</span></span></span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	u8 key_value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	u8 save_value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	u8 save_buf<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
	key_value <span class="token operator">=</span> <span class="token function">key_scan</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>key_value <span class="token operator">==</span> KEY1_PRESS<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">at24c02_write_one_byte</span><span class="token punctuation">(</span>EEPROM_ADDRESS<span class="token punctuation">,</span>save_value<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>key_value <span class="token operator">==</span> KEY2_PRESS<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		save_value <span class="token operator">=</span> <span class="token function">at24c02_read_one_byte</span><span class="token punctuation">(</span>EEPROM_ADDRESS<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>key_value <span class="token operator">==</span> KEY3_PRESS<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		save_value<span class="token operator">++</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>save_value<span class="token operator">==</span><span class="token number">255</span><span class="token punctuation">)</span> save_value<span class="token operator">=</span><span class="token number">255</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>key_value <span class="token operator">==</span> KEY4_PRESS<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		save_value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
    <span class="token comment">//å•ç‹¬å–æ¯ä½</span>
	save_buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> save_value<span class="token operator">/</span><span class="token number">100</span><span class="token punctuation">;</span>
	save_buf<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> save_value<span class="token operator">%</span><span class="token number">100</span><span class="token operator">/</span><span class="token number">10</span><span class="token punctuation">;</span>
	save_buf<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> save_value<span class="token operator">%</span><span class="token number">100</span><span class="token operator">%</span><span class="token number">10</span><span class="token punctuation">;</span>
	<span class="token function">smg_display</span><span class="token punctuation">(</span>save_buf<span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">//key.c</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&quot;key.h&quot;</span></span>

u8 <span class="token function">key_scan</span><span class="token punctuation">(</span>u8 mode<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">static</span> u8 key<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span>mode<span class="token punctuation">)</span>key<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//è¿ç»­æ‰«ææŒ‰é”®</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>key<span class="token operator">==</span><span class="token number">1</span><span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span>KEY1<span class="token operator">==</span><span class="token number">0</span><span class="token operator">||</span>KEY2<span class="token operator">==</span><span class="token number">0</span><span class="token operator">||</span>KEY3<span class="token operator">==</span><span class="token number">0</span><span class="token operator">||</span>KEY4<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//ä»»æ„æŒ‰é”®æŒ‰ä¸‹  æŒ‰ä¸‹ä¸º0</span>
	<span class="token punctuation">{</span>
		<span class="token comment">//æŒ‰é”®ä¸€æŒ‰ä¸‹æ—¶ä¼šäº§ç”Ÿä¸€è¿ä¸²çš„æŠ–åŠ¨</span>
		<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ¶ˆæŠ–</span>
		key<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>KEY1<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span> KEY1_PRESS<span class="token punctuation">;</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>KEY2<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span> KEY2_PRESS<span class="token punctuation">;</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>KEY3<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span> KEY3_PRESS<span class="token punctuation">;</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>KEY4<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span> KEY4_PRESS<span class="token punctuation">;</span>	
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>KEY1<span class="token operator">==</span><span class="token number">1</span><span class="token operator">&amp;&amp;</span>KEY2<span class="token operator">==</span><span class="token number">1</span><span class="token operator">&amp;&amp;</span>KEY3<span class="token operator">==</span><span class="token number">1</span><span class="token operator">&amp;&amp;</span>KEY4<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span>	<span class="token comment">//æ— æŒ‰é”®æŒ‰ä¸‹</span>
	<span class="token punctuation">{</span>
		key<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>			
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> KEY_UNPRESS<span class="token punctuation">;</span>		
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">//key.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">__KEY_H__</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">__KEY_H__</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;public.h&quot;</span></span>

<span class="token comment">//å®šä¹‰ç‹¬ç«‹æŒ‰é”®æ§åˆ¶è„š</span>
sbit KEY1<span class="token operator">=</span>P3<span class="token operator">^</span><span class="token number">1</span><span class="token punctuation">;</span>
sbit KEY2<span class="token operator">=</span>P3<span class="token operator">^</span><span class="token number">0</span><span class="token punctuation">;</span>
sbit KEY3<span class="token operator">=</span>P3<span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">;</span>
sbit KEY4<span class="token operator">=</span>P3<span class="token operator">^</span><span class="token number">3</span><span class="token punctuation">;</span>

<span class="token comment">//ä½¿ç”¨å®å®šä¹‰ç‹¬ç«‹æŒ‰é”®æŒ‰ä¸‹çš„é”®å€¼</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">KEY1_PRESS</span>	<span class="token expression"><span class="token number">1</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">KEY2_PRESS</span>	<span class="token expression"><span class="token number">2</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">KEY3_PRESS</span>	<span class="token expression"><span class="token number">3</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">KEY4_PRESS</span>	<span class="token expression"><span class="token number">4</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">KEY_UNPRESS</span>	<span class="token expression"><span class="token number">0</span>	</span></span>

u8 <span class="token function">key_scan</span><span class="token punctuation">(</span>u8 mode<span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">//smg.c</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&quot;smg.h&quot;</span></span>

u8 gsmg_code<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">0x3f</span><span class="token punctuation">,</span><span class="token number">0x06</span><span class="token punctuation">,</span><span class="token number">0x5b</span><span class="token punctuation">,</span><span class="token number">0x4f</span><span class="token punctuation">,</span><span class="token number">0x66</span><span class="token punctuation">,</span><span class="token number">0x6d</span><span class="token punctuation">,</span><span class="token number">0x7d</span><span class="token punctuation">,</span><span class="token number">0x07</span><span class="token punctuation">,</span>
				<span class="token number">0x7f</span><span class="token punctuation">,</span><span class="token number">0x6f</span><span class="token punctuation">,</span><span class="token number">0x77</span><span class="token punctuation">,</span><span class="token number">0x7c</span><span class="token punctuation">,</span><span class="token number">0x39</span><span class="token punctuation">,</span><span class="token number">0x5e</span><span class="token punctuation">,</span><span class="token number">0x79</span><span class="token punctuation">,</span><span class="token number">0x71</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">smg_display</span><span class="token punctuation">(</span>u8 dat<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>u8 pos<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	u8 i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	u8 pos_temp <span class="token operator">=</span> pos<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span>pos_temp<span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
	   	<span class="token keyword">switch</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token comment">//ä½é€‰</span>
		<span class="token punctuation">{</span>
			<span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span> LSC<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>LSB<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>LSA<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token comment">//7</span>
			<span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span> LSC<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>LSB<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>LSA<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token comment">//6</span>
			<span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span> LSC<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>LSB<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>LSA<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token comment">//5</span>
			<span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span> LSC<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>LSB<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>LSA<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token comment">//4</span>
			<span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span> LSC<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>LSB<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>LSA<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token comment">//3</span>
			<span class="token keyword">case</span> <span class="token number">5</span><span class="token operator">:</span> LSC<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>LSB<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>LSA<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token comment">//2</span>
			<span class="token keyword">case</span> <span class="token number">6</span><span class="token operator">:</span> LSC<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>LSB<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>LSA<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token comment">//1</span>
			<span class="token keyword">case</span> <span class="token number">7</span><span class="token operator">:</span> LSC<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>LSB<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>LSA<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token comment">//0</span>
		<span class="token punctuation">}</span>
		SMG_A_DP_PORT<span class="token operator">=</span>gsmg_code<span class="token punctuation">[</span>dat<span class="token punctuation">[</span>i<span class="token operator">-</span>pos_temp<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//ä¼ é€æ®µé€‰æ•°æ®</span>
		<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å»¶æ—¶ä¸€æ®µæ—¶é—´ï¼Œç­‰å¾…æ˜¾ç¤ºç¨³å®š</span>
		SMG_A_DP_PORT<span class="token operator">=</span><span class="token number">0x00</span><span class="token punctuation">;</span><span class="token comment">//æ¶ˆéŸ³</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">//smg.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">__SMG_H__</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">__SMG_H__</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;public.h&quot;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">SMG_A_DP_PORT</span>	<span class="token expression">P0	</span><span class="token comment">//ä½¿ç”¨å®å®šä¹‰æ•°ç ç®¡æ®µç å£</span></span>

<span class="token comment">//å®šä¹‰æ•°ç ç®¡ä½é€‰ä¿¡å·æ§åˆ¶è„š</span>
sbit LSA<span class="token operator">=</span>P2<span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">;</span>
sbit LSB<span class="token operator">=</span>P2<span class="token operator">^</span><span class="token number">3</span><span class="token punctuation">;</span>
sbit LSC<span class="token operator">=</span>P2<span class="token operator">^</span><span class="token number">4</span><span class="token punctuation">;</span>

<span class="token comment">//å…±é˜´ææ•°ç ç®¡æ˜¾ç¤º0~Fçš„æ®µç æ•°æ®</span>
<span class="token keyword">extern</span> u8 gsmg_code<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">smg_display</span><span class="token punctuation">(</span>u8 dat<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>u8 pos<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">//I2C.c</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&quot;I2C.h&quot;</span></span>

<span class="token keyword">void</span> <span class="token function">iic_start</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>	
	IIC_SDA	<span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	IIC_SCL <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	IIC_SDA <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	IIC_SCL <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">iic_stop</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	IIC_SDA	<span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	IIC_SCL <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	IIC_SDA <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">iic_ack</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	IIC_SCL <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	IIC_SDA	<span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	IIC_SCL <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	IIC_SCL <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">iic_nack</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	IIC_SCL <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	IIC_SDA	<span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	IIC_SCL <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	IIC_SCL <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
u8 <span class="token function">iic_wait_ack</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	u8 time_temp <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	IIC_SCL <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span>IIC_SDA<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		time_temp<span class="token operator">++</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>time_temp<span class="token operator">&gt;</span><span class="token number">100</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token function">iic_stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>		
	<span class="token punctuation">}</span>
	IIC_SCL <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">iic_write_byte</span><span class="token punctuation">(</span>u8 dat<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	u8 i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	IIC_SCL <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>dat<span class="token operator">&amp;</span><span class="token number">0x80</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">//åˆ¤æ–­æœ€é«˜ä½æ˜¯å¦ä¸º1</span>
			IIC_SDA <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token keyword">else</span>
			IIC_SDA <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		dat<span class="token operator">&lt;&lt;=</span><span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//è®¾ç½®æ—¶é’Ÿå‘¨æœŸ</span>
		IIC_SCL <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		IIC_SCL <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
u8 <span class="token function">iic_read_byte</span><span class="token punctuation">(</span>u8 ack<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	u8 i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	u8 receive <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		IIC_SCL <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		IIC_SCL <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		receive<span class="token operator">&lt;&lt;=</span><span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>IIC_SDA<span class="token punctuation">)</span>	receive<span class="token operator">++</span><span class="token punctuation">;</span>
		<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>ack<span class="token punctuation">)</span> <span class="token function">iic_nack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">else</span> <span class="token function">iic_ack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> receive<span class="token punctuation">;</span> 	
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">//I2C.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">__I2C_H__</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">__I2C_H__</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;public.h&quot;</span></span>

sbit IIC_SCL <span class="token operator">=</span> P2<span class="token operator">^</span><span class="token number">1</span><span class="token punctuation">;</span>
sbit IIC_SDA <span class="token operator">=</span> P2<span class="token operator">^</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">iic_start</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">iic_stop</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">iic_ack</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">iic_nack</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
u8 <span class="token function">iic_wait_ack</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">iic_write_byte</span><span class="token punctuation">(</span>u8 dat<span class="token punctuation">)</span><span class="token punctuation">;</span>
u8 <span class="token function">iic_read_byte</span><span class="token punctuation">(</span>u8 ack<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">//at20c02.c</span>
<span class="token comment">//AT24C02æä¾›2048ä½çš„ç”µå¯æ“¦å’Œå¯ç¼–ç¨‹åªè¯»å­˜å‚¨å™¨(EEPROM)</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&quot;at24c02.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&quot;I2C.h&quot;</span></span>
<span class="token keyword">void</span> <span class="token function">at24c02_write_one_byte</span><span class="token punctuation">(</span>u8 addr<span class="token punctuation">,</span>u8 dat<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token function">iic_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">iic_write_byte</span><span class="token punctuation">(</span><span class="token number">0xa0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">iic_wait_ack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">iic_write_byte</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">iic_wait_ack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">iic_write_byte</span><span class="token punctuation">(</span>dat<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">iic_wait_ack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">iic_stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
u8  <span class="token function">at24c02_read_one_byte</span><span class="token punctuation">(</span>u8 addr<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	u8 temp <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token function">iic_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">iic_write_byte</span><span class="token punctuation">(</span><span class="token number">0xa0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">iic_wait_ack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">iic_write_byte</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">iic_wait_ack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">iic_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">iic_write_byte</span><span class="token punctuation">(</span><span class="token number">0xa1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">iic_wait_ack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	temp <span class="token operator">=</span> <span class="token function">iic_read_byte</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">iic_stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> 	temp<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">//at20c02.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">__AT24C02_H__</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">__AT24C02_H__</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;public.h&quot;</span></span>

<span class="token keyword">void</span> <span class="token function">at24c02_write_one_byte</span><span class="token punctuation">(</span>u8 addr<span class="token punctuation">,</span>u8 dat<span class="token punctuation">)</span><span class="token punctuation">;</span>
u8  <span class="token function">at24c02_read_one_byte</span><span class="token punctuation">(</span>u8 addr<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">//public.c</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;public.h&quot;</span></span>

<span class="token keyword">void</span> <span class="token function">delay_ms</span><span class="token punctuation">(</span>u16 ms<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	u16 i<span class="token punctuation">,</span>j<span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span>ms<span class="token punctuation">;</span>i<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">--</span><span class="token punctuation">)</span>
		<span class="token keyword">for</span><span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">110</span><span class="token punctuation">;</span>j<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">delay_10us</span><span class="token punctuation">(</span>u16 us<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span>us<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">//public.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">__PUBLIC_H__</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">__PUBLIC_H__</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;reg52.h&quot;</span></span>

<span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> u16<span class="token punctuation">;</span>	<span class="token comment">//å¯¹ç³»ç»Ÿé»˜è®¤æ•°æ®ç±»å‹è¿›è¡Œé‡å®šä¹‰</span>
<span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> u8<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">delay_ms</span><span class="token punctuation">(</span>u16 ms<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">delay_10us</span><span class="token punctuation">(</span>u16 us<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="æ¸©åº¦ä¼ æ„Ÿå™¨ds18b20" tabindex="-1"><a class="header-anchor" href="#æ¸©åº¦ä¼ æ„Ÿå™¨ds18b20" aria-hidden="true">#</a> æ¸©åº¦ä¼ æ„Ÿå™¨DS18B20</h2><p><img src="https://m.360buyimg.com/babel/jfs/t1/168012/19/23177/197087/625a4873Eb66583c8/8a6bda6d0f598739.png" alt="image-20220406202632290.png"></p><h3 id="åˆå§‹åŒ–æ—¶åº" tabindex="-1"><a class="header-anchor" href="#åˆå§‹åŒ–æ—¶åº" aria-hidden="true">#</a> åˆå§‹åŒ–æ—¶åº</h3><p><img src="https://m.360buyimg.com/babel/jfs/t1/198417/33/22543/72988/625a4892E4e092eb0/aee7248a4f770520.png" alt="image-20220406202702042.png"></p><h3 id="å†™æ—¶åº" tabindex="-1"><a class="header-anchor" href="#å†™æ—¶åº" aria-hidden="true">#</a> å†™æ—¶åº</h3><p><img src="https://m.360buyimg.com/babel/jfs/t1/119747/26/27779/73671/625a48b8E51dc0c61/45d3a0128bc25093.png" alt="image-20220406204244335.png"></p><h3 id="è¯»æ—¶åº" tabindex="-1"><a class="header-anchor" href="#è¯»æ—¶åº" aria-hidden="true">#</a> è¯»æ—¶åº</h3><p><img src="https://m.360buyimg.com/babel/jfs/t1/99772/27/25797/76231/625a48d2E4fcc548b/29e148464746732a.png" alt="image-20220406204316468.png"></p><p><strong><code>DS18B20</code> çš„å…¸å‹æ¸©åº¦è¯»å–è¿‡ç¨‹ä¸ºï¼š</strong></p><p>å¤ä½â†’å‘ SKIP ROM å‘½ä»¤ï¼ˆ0XCCï¼‰â†’å‘å¼€å§‹è½¬ æ¢å‘½ä»¤ï¼ˆ0X44ï¼‰â†’å»¶æ—¶â†’å¤ä½â†’å‘é€ SKIP ROM å‘½ä»¤ï¼ˆ0XCCï¼‰â†’å‘è¯»å­˜å‚¨å™¨å‘½ä»¤ ï¼ˆ0XBEï¼‰â†’è¿ç»­è¯»å‡ºä¸¤ä¸ªå­—èŠ‚æ•°æ®(å³æ¸©åº¦)â†’ç»“æŸã€‚</p><div class="language-mermaidjs ext-mermaidjs line-numbers-mode"><pre class="language-mermaidjs"><code>graph TB
A[å¤ä½] --&gt; B[å‘ SKIP ROM å‘½ä»¤] --&gt; C[å‘å¼€å§‹è½¬ æ¢å‘½ä»¤]
C--&gt; D[å»¶æ—¶]
D--&gt; E[å¤ä½]
E--&gt; F[å‘é€ SKIP ROM å‘½ä»¤]
F--&gt; G[å‘è¯»å­˜å‚¨å™¨å‘½ä»¤]
G--&gt; H[è¯»å‡ºä¸¤ä¸ªå­—èŠ‚æ•°æ®]
H--&gt; I[ç»“æŸ]

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">//ds18b20.c</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;ds18b20.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;intrins.h&quot;</span></span>

<span class="token keyword">void</span> <span class="token function">ds18b20_reset</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	DS18B20_PORT<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>	<span class="token comment">//æ‹‰ä½DQ</span>
	<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">75</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//æ‹‰ä½750us</span>
	DS18B20_PORT<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>	<span class="token comment">//DQ=1</span>
	<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//20US</span>
<span class="token punctuation">}</span>

u8 <span class="token function">ds18b20_check</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	u8 time_temp<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

	<span class="token keyword">while</span><span class="token punctuation">(</span>DS18B20_PORT<span class="token operator">&amp;&amp;</span>time_temp<span class="token operator">&lt;</span><span class="token number">20</span><span class="token punctuation">)</span>	<span class="token comment">//ç­‰å¾…DQä¸ºä½ç”µå¹³</span>
	<span class="token punctuation">{</span>
		time_temp<span class="token operator">++</span><span class="token punctuation">;</span>
		<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>time_temp<span class="token operator">&gt;=</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>	<span class="token comment">//å¦‚æœè¶…æ—¶åˆ™å¼ºåˆ¶è¿”å›1</span>
	<span class="token keyword">else</span> time_temp<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">!</span>DS18B20_PORT<span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span>time_temp<span class="token operator">&lt;</span><span class="token number">20</span><span class="token punctuation">)</span>	<span class="token comment">//ç­‰å¾…DQä¸ºé«˜ç”µå¹³</span>
	<span class="token punctuation">{</span>
		time_temp<span class="token operator">++</span><span class="token punctuation">;</span>
		<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>time_temp<span class="token operator">&gt;=</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>	<span class="token comment">//å¦‚æœè¶…æ—¶åˆ™å¼ºåˆ¶è¿”å›1</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

u8 <span class="token function">ds18b20_read_bit</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	u8 dat<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	
	DS18B20_PORT<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	DS18B20_PORT<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>	
	<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//è¯¥æ®µæ—¶é—´ä¸èƒ½è¿‡é•¿ï¼Œå¿…é¡»åœ¨15uså†…è¯»å–æ•°æ®</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>DS18B20_PORT<span class="token punctuation">)</span>dat<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>	<span class="token comment">//å¦‚æœæ€»çº¿ä¸Šä¸º1åˆ™æ•°æ®datä¸º1ï¼Œå¦åˆ™ä¸º0</span>
	<span class="token keyword">else</span> dat<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> dat<span class="token punctuation">;</span>
<span class="token punctuation">}</span> 

u8 <span class="token function">ds18b20_read_byte</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	u8 i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	u8 dat<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	u8 temp<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token comment">//å¾ªç¯8æ¬¡ï¼Œæ¯æ¬¡è¯»å–ä¸€ä½ï¼Œä¸”å…ˆè¯»ä½ä½å†è¯»é«˜ä½</span>
	<span class="token punctuation">{</span>
		temp<span class="token operator">=</span><span class="token function">ds18b20_read_bit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		dat<span class="token operator">=</span><span class="token punctuation">(</span>temp<span class="token operator">&lt;&lt;</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token punctuation">(</span>dat<span class="token operator">&gt;&gt;</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç”±ä½ä½è¯»æ•°æ®</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> dat<span class="token punctuation">;</span>	
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">ds18b20_write_byte</span><span class="token punctuation">(</span>u8 dat<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	u8 i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	u8 temp<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token comment">//å¾ªç¯8æ¬¡ï¼Œæ¯æ¬¡å†™ä¸€ä½ï¼Œä¸”å…ˆå†™ä½ä½å†å†™é«˜ä½</span>
	<span class="token punctuation">{</span>
		temp<span class="token operator">=</span>dat<span class="token operator">&amp;</span><span class="token number">0x01</span><span class="token punctuation">;</span><span class="token comment">//é€‰æ‹©ä½ä½å‡†å¤‡å†™å…¥</span>
		dat<span class="token operator">&gt;&gt;=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//å°†æ¬¡é«˜ä½ç§»åˆ°ä½ä½</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			DS18B20_PORT<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
			<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			DS18B20_PORT<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>	
			<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>
		<span class="token punctuation">{</span>
			DS18B20_PORT<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
			<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			DS18B20_PORT<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
			<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
		<span class="token punctuation">}</span>	
	<span class="token punctuation">}</span>	
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">ds18b20_start</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token function">ds18b20_reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å¤ä½</span>
	<span class="token function">ds18b20_check</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ£€æŸ¥DS18B20</span>
	<span class="token function">ds18b20_write_byte</span><span class="token punctuation">(</span><span class="token number">0xcc</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//SKIP ROM</span>
    <span class="token function">ds18b20_write_byte</span><span class="token punctuation">(</span><span class="token number">0x44</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è½¬æ¢å‘½ä»¤	</span>
<span class="token punctuation">}</span>

u8 <span class="token function">ds18b20_init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token function">ds18b20_reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token function">ds18b20_check</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
<span class="token punctuation">}</span>

<span class="token keyword">float</span> <span class="token function">ds18b20_read_temperture</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">float</span> temp<span class="token punctuation">;</span>
	u8 dath<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	u8 datl<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	u16 value<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

	<span class="token function">ds18b20_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å¼€å§‹è½¬æ¢</span>
	<span class="token function">ds18b20_reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å¤ä½</span>
	<span class="token function">ds18b20_check</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">ds18b20_write_byte</span><span class="token punctuation">(</span><span class="token number">0xcc</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//SKIP ROM</span>
    <span class="token function">ds18b20_write_byte</span><span class="token punctuation">(</span><span class="token number">0xbe</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è¯»å­˜å‚¨å™¨</span>

	datl<span class="token operator">=</span><span class="token function">ds18b20_read_byte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ä½å­—èŠ‚</span>
	dath<span class="token operator">=</span><span class="token function">ds18b20_read_byte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//é«˜å­—èŠ‚</span>
	value<span class="token operator">=</span><span class="token punctuation">(</span>dath<span class="token operator">&lt;&lt;</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token operator">+</span>datl<span class="token punctuation">;</span><span class="token comment">//åˆå¹¶ä¸º16ä½æ•°æ®</span>
	<span class="token comment">//value=(dath&lt;&lt;8)|datl;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>value<span class="token operator">&amp;</span><span class="token number">0xf800</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0xf800</span><span class="token punctuation">)</span><span class="token comment">//åˆ¤æ–­ç¬¦å·ä½ï¼Œè´Ÿæ¸©åº¦</span>
	<span class="token punctuation">{</span>
		value<span class="token operator">=</span><span class="token punctuation">(</span><span class="token operator">~</span>value<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//æ•°æ®å–åå†åŠ 1</span>
        <span class="token comment">//value=(~value)|1;</span>
		temp<span class="token operator">=</span>value<span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.0625</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ä¹˜ä»¥ç²¾åº¦	</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token comment">//æ­£æ¸©åº¦</span>
	<span class="token punctuation">{</span>
		temp<span class="token operator">=</span>value<span class="token operator">*</span><span class="token number">0.0625</span><span class="token punctuation">;</span>	
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> temp<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">//ds18b20.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">_ds18b20_H</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_ds18b20_H</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;public.h&quot;</span></span>

<span class="token comment">//ç®¡è„šå®šä¹‰</span>
sbit DS18B20_PORT<span class="token operator">=</span>P3<span class="token operator">^</span><span class="token number">7</span><span class="token punctuation">;</span>	<span class="token comment">//DS18B20æ•°æ®å£å®šä¹‰</span>


<span class="token comment">//å‡½æ•°å£°æ˜</span>
u8 <span class="token function">ds18b20_init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">float</span> <span class="token function">ds18b20_read_temperture</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">//main.c</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;public.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;smg.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;ds18b20.h&quot;</span></span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>	
	u8 i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
   	<span class="token keyword">int</span> temp_value<span class="token punctuation">;</span>
	u8 temp_buf<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

	<span class="token function">ds18b20_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åˆå§‹åŒ–DS18B20</span>

	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>				
		i<span class="token operator">++</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">%</span><span class="token number">50</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">//é—´éš”ä¸€æ®µæ—¶é—´è¯»å–æ¸©åº¦å€¼ï¼Œé—´éš”æ—¶é—´è¦å¤§äºæ¸©åº¦ä¼ æ„Ÿå™¨è½¬æ¢æ¸©åº¦æ—¶é—´</span>
			temp_value<span class="token operator">=</span><span class="token function">ds18b20_read_temperture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">10</span><span class="token punctuation">;</span><span class="token comment">//ä¿ç•™æ¸©åº¦å€¼å°æ•°åä¸€ä½</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>temp_value<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">//è´Ÿæ¸©åº¦</span>
		<span class="token punctuation">{</span>
			temp_value<span class="token operator">=</span><span class="token operator">-</span>temp_value<span class="token punctuation">;</span>
			temp_buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0x40</span><span class="token punctuation">;</span><span class="token comment">//æ˜¾ç¤ºè´Ÿå·	</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>
			temp_buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0x00</span><span class="token punctuation">;</span><span class="token comment">//ä¸æ˜¾ç¤º</span>
		temp_buf<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span>gsmg_code<span class="token punctuation">[</span>temp_value<span class="token operator">/</span><span class="token number">1000</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//ç™¾ä½</span>
		temp_buf<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">=</span>gsmg_code<span class="token punctuation">[</span>temp_value<span class="token operator">%</span><span class="token number">1000</span><span class="token operator">/</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//åä½</span>
		temp_buf<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">=</span>gsmg_code<span class="token punctuation">[</span>temp_value<span class="token operator">%</span><span class="token number">1000</span><span class="token operator">%</span><span class="token number">100</span><span class="token operator">/</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token operator">|</span><span class="token number">0x80</span><span class="token punctuation">;</span><span class="token comment">//ä¸ªä½+å°æ•°ç‚¹</span>
		temp_buf<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">=</span>gsmg_code<span class="token punctuation">[</span>temp_value<span class="token operator">%</span><span class="token number">1000</span><span class="token operator">%</span><span class="token number">100</span><span class="token operator">%</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//å°æ•°ç‚¹åä¸€ä½</span>
		<span class="token function">smg_display</span><span class="token punctuation">(</span>temp_buf<span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="æ—¶é’ŸèŠ¯ç‰‡ds1302" tabindex="-1"><a class="header-anchor" href="#æ—¶é’ŸèŠ¯ç‰‡ds1302" aria-hidden="true">#</a> æ—¶é’ŸèŠ¯ç‰‡DS1302</h2><p><strong>æ§åˆ¶å¯„å­˜å™¨</strong></p><p><img src="https://m.360buyimg.com/babel/jfs/t1/145551/26/26891/25748/625a48faE03483092/e09730b285b61179.png" alt="image-20220411203922558.png"></p><p><img src="https://m.360buyimg.com/babel/jfs/t1/152583/25/21383/177583/625a490dE82a9c362/dba572372ad5bdfb.png" alt="image-20220411204006216.png"></p><p><img src="https://m.360buyimg.com/babel/jfs/t1/123867/14/20595/178066/625a4922Eb96dc1d7/bcfe81a502010562.png" alt="image-20220411204011131.png"></p><p><img src="https://m.360buyimg.com/babel/jfs/t1/104490/13/26994/176769/625a4935E5758760c/ec3c7a35d46a216d.png" alt="image-20220411204628083.png"></p><p><img src="https://m.360buyimg.com/babel/jfs/t1/202950/27/21669/160700/625a494dEb5683074/31aba0e5087ac301.png" alt="image-20220411204633613.png"></p><p><img src="https://m.360buyimg.com/babel/jfs/t1/212032/26/17447/107548/625a495fE97e7353f/5aebc3946b1e4242.png" alt="image-20220412123156760.png"></p><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">//ds1302.c</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;ds1302.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;intrins.h&quot;</span></span>

<span class="token comment">//---DS1302å†™å…¥å’Œè¯»å–æ—¶åˆ†ç§’çš„åœ°å€å‘½ä»¤---//</span>
<span class="token comment">//---ç§’åˆ†æ—¶æ—¥æœˆå‘¨å¹´ æœ€ä½ä½è¯»å†™ä½;-------//</span>
u8 gREAD_RTC_ADDR<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0x81</span><span class="token punctuation">,</span> <span class="token number">0x83</span><span class="token punctuation">,</span> <span class="token number">0x85</span><span class="token punctuation">,</span> <span class="token number">0x87</span><span class="token punctuation">,</span> <span class="token number">0x89</span><span class="token punctuation">,</span> <span class="token number">0x8b</span><span class="token punctuation">,</span> <span class="token number">0x8d</span><span class="token punctuation">}</span><span class="token punctuation">;</span> 
u8 gWRITE_RTC_ADDR<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0x80</span><span class="token punctuation">,</span> <span class="token number">0x82</span><span class="token punctuation">,</span> <span class="token number">0x84</span><span class="token punctuation">,</span> <span class="token number">0x86</span><span class="token punctuation">,</span> <span class="token number">0x88</span><span class="token punctuation">,</span> <span class="token number">0x8a</span><span class="token punctuation">,</span> <span class="token number">0x8c</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//---DS1302æ—¶é’Ÿåˆå§‹åŒ–2021å¹´5æœˆ20æ—¥æ˜ŸæœŸå››13ç‚¹51åˆ†47ç§’ã€‚---//</span>
<span class="token comment">//---å­˜å‚¨é¡ºåºæ˜¯ç§’åˆ†æ—¶æ—¥æœˆå‘¨å¹´,å­˜å‚¨æ ¼å¼æ˜¯ç”¨BCDç ---//</span>
u8 gDS1302_TIME<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0x47</span><span class="token punctuation">,</span> <span class="token number">0x51</span><span class="token punctuation">,</span> <span class="token number">0x13</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">,</span> <span class="token number">0x04</span><span class="token punctuation">,</span> <span class="token number">0x05</span><span class="token punctuation">,</span> <span class="token number">0x21</span><span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token keyword">void</span> <span class="token function">ds1302_write_byte</span><span class="token punctuation">(</span>u8 addr<span class="token punctuation">,</span>u8 dat<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	u8 i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	
	DS1302_RST<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
	DS1302_CLK<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//CLKä½ç”µå¹³</span>
	<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	DS1302_RST<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//RSTç”±ä½åˆ°é«˜å˜åŒ–</span>
	<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token comment">//å¾ªç¯8æ¬¡ï¼Œæ¯æ¬¡å†™1ä½ï¼Œå…ˆå†™ä½ä½å†å†™é«˜ä½</span>
	<span class="token punctuation">{</span>
		DS1302_IO<span class="token operator">=</span>addr<span class="token operator">&amp;</span><span class="token number">0x01</span><span class="token punctuation">;</span>
		addr<span class="token operator">&gt;&gt;=</span><span class="token number">1</span><span class="token punctuation">;</span>
		DS1302_CLK<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		DS1302_CLK<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//CLKç”±ä½åˆ°é«˜äº§ç”Ÿä¸€ä¸ªä¸Šå‡æ²¿ï¼Œä»è€Œå†™å…¥æ•°æ®</span>
		<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		
	<span class="token punctuation">}</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token comment">//å¾ªç¯8æ¬¡ï¼Œæ¯æ¬¡å†™1ä½ï¼Œå…ˆå†™ä½ä½å†å†™é«˜ä½</span>
	<span class="token punctuation">{</span>
		DS1302_IO<span class="token operator">=</span>dat<span class="token operator">&amp;</span><span class="token number">0x01</span><span class="token punctuation">;</span>
		dat<span class="token operator">&gt;&gt;=</span><span class="token number">1</span><span class="token punctuation">;</span>
		DS1302_CLK<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		DS1302_CLK<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		
	<span class="token punctuation">}</span>
	DS1302_RST<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//RSTæ‹‰ä½</span>
	<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
<span class="token punctuation">}</span>

u8 <span class="token function">ds1302_read_byte</span><span class="token punctuation">(</span>u8 addr<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	u8 i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	u8 temp<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	u8 value<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

	DS1302_RST<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
	DS1302_CLK<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//CLKä½ç”µå¹³</span>
	<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	DS1302_RST<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//RSTç”±ä½åˆ°é«˜å˜åŒ–</span>
	<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token comment">//å¾ªç¯8æ¬¡ï¼Œæ¯æ¬¡å†™1ä½ï¼Œå…ˆå†™ä½ä½å†å†™é«˜ä½</span>
	<span class="token punctuation">{</span>
		DS1302_IO<span class="token operator">=</span>addr<span class="token operator">&amp;</span><span class="token number">0x01</span><span class="token punctuation">;</span>
		addr<span class="token operator">&gt;&gt;=</span><span class="token number">1</span><span class="token punctuation">;</span>	
		DS1302_CLK<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		DS1302_CLK<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//CLKç”±ä½åˆ°é«˜äº§ç”Ÿä¸€ä¸ªä¸Šå‡æ²¿ï¼Œä»è€Œå†™å…¥æ•°æ®</span>
		<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		
	<span class="token punctuation">}</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token comment">//å¾ªç¯8æ¬¡ï¼Œæ¯æ¬¡è¯»1ä½ï¼Œå…ˆè¯»ä½ä½å†è¯»é«˜ä½</span>
	<span class="token punctuation">{</span>
		temp<span class="token operator">=</span>DS1302_IO<span class="token punctuation">;</span>
		value<span class="token operator">=</span><span class="token punctuation">(</span>temp<span class="token operator">&lt;&lt;</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token punctuation">(</span>value<span class="token operator">&gt;&gt;</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å…ˆå°†valueå³ç§»1ä½ï¼Œç„¶åtempå·¦ç§»7ä½ï¼Œæœ€åæˆ–è¿ç®—</span>
		DS1302_CLK<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		DS1302_CLK<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		
	<span class="token punctuation">}</span>
	DS1302_RST<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//RSTæ‹‰ä½</span>
	<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
	DS1302_CLK<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//å¯¹äºå®ç‰©ä¸­ï¼ŒP3.4å£æ²¡æœ‰å¤–æ¥ä¸Šæ‹‰ç”µé˜»çš„ï¼Œæ­¤å¤„ä»£ç éœ€è¦æ·»åŠ ï¼Œä½¿æ•°æ®å£æœ‰ä¸€ä¸ªä¸Šå‡æ²¿è„‰å†²ã€‚</span>
	<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	DS1302_IO <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	DS1302_IO <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
	<span class="token keyword">return</span> value<span class="token punctuation">;</span>		
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">ds1302_init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	u8 i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token function">ds1302_write_byte</span><span class="token punctuation">(</span><span class="token number">0x8E</span><span class="token punctuation">,</span><span class="token number">0X00</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">7</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">ds1302_write_byte</span><span class="token punctuation">(</span>gWRITE_RTC_ADDR<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>gDS1302_TIME<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
	<span class="token punctuation">}</span>
	<span class="token function">ds1302_write_byte</span><span class="token punctuation">(</span><span class="token number">0x8E</span><span class="token punctuation">,</span><span class="token number">0X80</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">ds1302_read_time</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	u8 i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">7</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		gDS1302_TIME<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">ds1302_read_byte</span><span class="token punctuation">(</span>gREAD_RTC_ADDR<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
	<span class="token punctuation">}</span>	
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">//ds1302.H</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">_ds1302_H</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_ds1302_H</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;public.h&quot;</span></span>

<span class="token comment">//ç®¡è„šå®šä¹‰</span>
sbit DS1302_RST<span class="token operator">=</span>P3<span class="token operator">^</span><span class="token number">5</span><span class="token punctuation">;</span><span class="token comment">//å¤ä½ç®¡è„š</span>
sbit DS1302_CLK<span class="token operator">=</span>P3<span class="token operator">^</span><span class="token number">6</span><span class="token punctuation">;</span><span class="token comment">//æ—¶é’Ÿç®¡è„š</span>
sbit DS1302_IO<span class="token operator">=</span>P3<span class="token operator">^</span><span class="token number">4</span><span class="token punctuation">;</span><span class="token comment">//æ•°æ®ç®¡è„š</span>

<span class="token comment">//å˜é‡å£°æ˜</span>
<span class="token keyword">extern</span> u8 gDS1302_TIME<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//å­˜å‚¨æ—¶é—´</span>

<span class="token comment">//å‡½æ•°å£°æ˜</span>
<span class="token keyword">void</span> <span class="token function">ds1302_init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">ds1302_read_time</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">//main.c</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;public.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;smg.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;ds1302.h&quot;</span></span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>	
	u8 time_buf<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	
	<span class="token function">ds1302_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åˆå§‹åŒ–DS1302</span>

	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>				
		<span class="token function">ds1302_read_time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		time_buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span>gsmg_code<span class="token punctuation">[</span>gDS1302_TIME<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		time_buf<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span>gsmg_code<span class="token punctuation">[</span>gDS1302_TIME<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">&amp;</span><span class="token number">0x0f</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		time_buf<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0x40</span><span class="token punctuation">;</span>
		time_buf<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">=</span>gsmg_code<span class="token punctuation">[</span>gDS1302_TIME<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		time_buf<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">=</span>gsmg_code<span class="token punctuation">[</span>gDS1302_TIME<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&amp;</span><span class="token number">0x0f</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		time_buf<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0x40</span><span class="token punctuation">;</span>
		time_buf<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token operator">=</span>gsmg_code<span class="token punctuation">[</span>gDS1302_TIME<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		time_buf<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token operator">=</span>gsmg_code<span class="token punctuation">[</span>gDS1302_TIME<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">&amp;</span><span class="token number">0x0f</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token function">smg_display</span><span class="token punctuation">(</span>time_buf<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>		
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="çº¢å¤–é¥æ§" tabindex="-1"><a class="header-anchor" href="#çº¢å¤–é¥æ§" aria-hidden="true">#</a> çº¢å¤–é¥æ§</h2><p><code>NEC </code>ç çš„ä½å®šä¹‰ï¼šä¸€ä¸ªè„‰å†²å¯¹åº”<code>560us</code>çš„è¿ç»­è½½æ³¢ï¼Œä¸€ä¸ªé€»è¾‘ <code>1</code> ä¼ è¾“éœ€è¦ <code>2.25ms</code>ï¼ˆ<code>560us </code>è„‰å†²+<code>1680us </code>ä½ç”µå¹³ï¼‰ï¼Œä¸€ä¸ªé€»è¾‘<code>0</code>çš„ä¼ è¾“éœ€è¦<code> 1.125ms</code>ï¼ˆ<code>560us</code> è„‰å†²+<code>560us</code> ä½ç”µå¹³ï¼‰</p><p><img src="https://m.360buyimg.com/babel/jfs/t1/179027/7/22773/33416/625a497aE652934f6/4ae4754751f05e12.png" alt="image-20220412162538592.png"></p><p><img src="https://m.360buyimg.com/babel/jfs/t1/104668/11/27524/78077/625a497eE784bb8c9/4f411157b3c4bed2.png" alt="image-20220412162652869.png"></p><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">//ired.c</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;ired.h&quot;</span></span>

u8 gired_data<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//å­˜å‚¨4ä¸ªå­—èŠ‚æ¥æ”¶ç ï¼ˆåœ°å€ç +åœ°å€åç +æ§åˆ¶ç +æ§åˆ¶åç ï¼‰</span>

<span class="token keyword">void</span> <span class="token function">ired_init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	IT0<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>	<span class="token comment">//ä¸‹é™æ²¿è§¦å‘</span>
	EX0<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>	<span class="token comment">//æ‰“å¼€ä¸­æ–­0å…è®¸</span>
	EA<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>	<span class="token comment">//æ‰“å¼€æ€»ä¸­æ–­</span>
	IRED<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>	<span class="token comment">//åˆå§‹åŒ–ç«¯å£</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">ired</span><span class="token punctuation">(</span><span class="token punctuation">)</span> interrupt <span class="token number">0</span>	<span class="token comment">//å¤–éƒ¨ä¸­æ–­0æœåŠ¡å‡½æ•°</span>
<span class="token punctuation">{</span>
	u8 ired_high_time<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	u16 time_cnt<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	u8 i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span>IRED<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		time_cnt<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">;</span>
		<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">!</span>IRED<span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span>time_cnt<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//ç­‰å¾…å¼•å¯¼ä¿¡å·9msä½ç”µå¹³ç»“æŸï¼Œè‹¥è¶…è¿‡10mså¼ºåˆ¶é€€å‡º</span>
		<span class="token punctuation">{</span>
			<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å»¶æ—¶çº¦10us</span>
			time_cnt<span class="token operator">--</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>time_cnt<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">;</span>		
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>IRED<span class="token punctuation">)</span><span class="token comment">//å¼•å¯¼ä¿¡å·9msä½ç”µå¹³å·²è¿‡ï¼Œè¿›å…¥4.5msé«˜ç”µå¹³</span>
		<span class="token punctuation">{</span>
			time_cnt<span class="token operator">=</span><span class="token number">500</span><span class="token punctuation">;</span>
			<span class="token keyword">while</span><span class="token punctuation">(</span>IRED<span class="token operator">&amp;&amp;</span>time_cnt<span class="token punctuation">)</span><span class="token comment">//ç­‰å¾…å¼•å¯¼ä¿¡å·4.5msé«˜ç”µå¹³ç»“æŸï¼Œè‹¥è¶…è¿‡5mså¼ºåˆ¶é€€å‡º</span>
			<span class="token punctuation">{</span>
				<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				time_cnt<span class="token operator">--</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span>time_cnt<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">;</span>	
			<span class="token punctuation">}</span>
			<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">4</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token comment">//å¾ªç¯4æ¬¡ï¼Œè¯»å–4ä¸ªå­—èŠ‚æ•°æ®</span>
			<span class="token punctuation">{</span>
				<span class="token keyword">for</span><span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token comment">//å¾ªç¯8æ¬¡è¯»å–æ¯ä½æ•°æ®å³ä¸€ä¸ªå­—èŠ‚</span>
				<span class="token punctuation">{</span>
					time_cnt<span class="token operator">=</span><span class="token number">600</span><span class="token punctuation">;</span>
					<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>IRED<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span>time_cnt<span class="token punctuation">)</span><span class="token comment">//ç­‰å¾…æ•°æ®1æˆ–0å‰é¢çš„0.56msç»“æŸï¼Œè‹¥è¶…è¿‡6mså¼ºåˆ¶é€€å‡º</span>
					<span class="token punctuation">{</span>
						<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						time_cnt<span class="token operator">--</span><span class="token punctuation">;</span>
						<span class="token keyword">if</span><span class="token punctuation">(</span>time_cnt<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">;</span>	
					<span class="token punctuation">}</span>
					time_cnt<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">;</span>
					<span class="token keyword">while</span><span class="token punctuation">(</span>IRED<span class="token punctuation">)</span><span class="token comment">//ç­‰å¾…æ•°æ®1æˆ–0åé¢çš„é«˜ç”µå¹³ç»“æŸï¼Œè‹¥è¶…è¿‡2mså¼ºåˆ¶é€€å‡º</span>
					<span class="token punctuation">{</span>
						<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//çº¦0.1ms</span>
						ired_high_time<span class="token operator">++</span><span class="token punctuation">;</span>
						<span class="token keyword">if</span><span class="token punctuation">(</span>ired_high_time<span class="token operator">&gt;</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">;</span>	
					<span class="token punctuation">}</span>
					gired_data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">&gt;&gt;=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//å…ˆè¯»å–çš„ä¸ºä½ä½ï¼Œç„¶åæ˜¯é«˜ä½</span>
					<span class="token keyword">if</span><span class="token punctuation">(</span>ired_high_time<span class="token operator">&gt;=</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token comment">//å¦‚æœé«˜ç”µå¹³æ—¶é—´å¤§äº0.8msï¼Œæ•°æ®åˆ™ä¸º1ï¼Œå¦åˆ™ä¸º0</span>
						gired_data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">|=</span><span class="token number">0x80</span><span class="token punctuation">;</span>
					ired_high_time<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//é‡æ–°æ¸…é›¶ï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡è®¡ç®—æ—¶é—´</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>gired_data<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token operator">~</span>gired_data<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">//æ ¡éªŒæ§åˆ¶ç ä¸åç ï¼Œé”™è¯¯åˆ™è¿”å›</span>
		<span class="token punctuation">{</span>
			<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">4</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
				gired_data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>	
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>		
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">//ired.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">_ired_H</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_ired_H</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;public.h&quot;</span></span>

<span class="token comment">//ç®¡è„šå®šä¹‰</span>
sbit IRED<span class="token operator">=</span>P3<span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">;</span>

<span class="token comment">//å£°æ˜å˜é‡</span>
<span class="token keyword">extern</span> u8 gired_data<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>


<span class="token comment">//å‡½æ•°å£°æ˜</span>
<span class="token keyword">void</span> <span class="token function">ired_init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">//main.c</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;public.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;smg.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;ired.h&quot;</span></span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>	
	u8 ired_buf<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

	<span class="token function">ired_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//çº¢å¤–åˆå§‹åŒ–</span>

	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>				
		ired_buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span>gsmg_code<span class="token punctuation">[</span>gired_data<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//å°†æ§åˆ¶ç é«˜4ä½è½¬æ¢ä¸ºæ•°ç ç®¡æ®µç </span>
		ired_buf<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span>gsmg_code<span class="token punctuation">[</span>gired_data<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">%</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//å°†æ§åˆ¶ç ä½4ä½è½¬æ¢ä¸ºæ•°ç ç®¡æ®µç </span>
		ired_buf<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0X76</span><span class="token punctuation">;</span><span class="token comment">//æ˜¾ç¤ºHçš„æ®µç </span>
		<span class="token function">smg_display</span><span class="token punctuation">(</span>ired_buf<span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
	<span class="token punctuation">}</span>		
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="adcæ¨¡æ•°è½¬æ¢" tabindex="-1"><a class="header-anchor" href="#adcæ¨¡æ•°è½¬æ¢" aria-hidden="true">#</a> ADCæ¨¡æ•°è½¬æ¢</h2><p>AD è½¬æ¢å™¨ï¼ˆADCï¼‰å°†æ¨¡æ‹Ÿé‡è½¬æ¢ä¸ºæ•°å­—é‡é€šå¸¸è¦ç»è¿‡ 4 ä¸ªæ­¥éª¤ï¼šé‡‡æ ·ã€ä¿æŒã€é‡åŒ–å’Œç¼–ç ã€‚</p><p>å°†é‡‡æ ·ç”µå¹³ï¼ˆæ¨¡æ‹Ÿå€¼ï¼‰è½¬æ¢ä¸ºæ•°å­—å€¼æ—¶ï¼Œä¸»è¦æœ‰ä¸¤ç±»æ–¹æ³•ï¼šç›´æ¥æ¯”è¾ƒå‹ä¸é—´æ¥æ¯”è¾ƒå‹ã€‚</p><p><strong>é€æ¬¡é€¼è¿‘å‹ADC</strong></p><p><img src="https://m.360buyimg.com/babel/jfs/t1/149886/10/26608/95228/625a497bEbd41d3d3/7432a3a62ce74376.png" alt="image-20220413231143808.png"></p><p><strong>åŒç§¯åˆ†å‹ADC</strong></p><p><img src="https://m.360buyimg.com/babel/jfs/t1/96350/2/26828/114899/625a497dE403c5557/7366736049b0a4ff.png" alt="image-20220413231157934.png"></p><p><code>XPT2046 </code>æ˜¯ä¸€æ¬¾ 4 çº¿åˆ¶ç”µé˜»å¼è§¦æ‘¸å±æ§åˆ¶å™¨ï¼Œå†…å« 12 ä½åˆ†è¾¨ç‡<code>125KHz</code>è½¬æ¢é€Ÿç‡é€æ­¥é€¼è¿‘å‹ <code>A/D </code>è½¬æ¢å™¨ã€‚</p><p><img src="https://m.360buyimg.com/babel/jfs/t1/133668/10/20897/85331/625a497cE069b8343/5f2c3a798735348f.png" alt="image-20220413231933813.png"></p><p><strong>ä¸»è¦ç‰¹æ€§</strong></p><ul><li><p>â‘ å·¥ä½œç”µå‹èŒƒå›´ä¸º 1.5Vï½5.25V</p></li><li><p>â‘¡æ”¯æŒ 1.5Vï½5.25V çš„æ•°å­— I/O å£</p></li><li><p>â‘¢å†…å»º 2.5V å‚è€ƒç”µå‹æº</p></li><li><p>â‘£ç”µæºç”µå‹æµ‹é‡ï¼ˆ 0V~6Vï¼‰</p></li><li><p>â‘¤å†…å»ºç»“æ¸©æµ‹é‡åŠŸèƒ½</p></li><li><p>â‘¥è§¦æ‘¸å‹åŠ›æµ‹é‡</p></li><li><p>â‘¦é‡‡ç”¨ 3 çº¿åˆ¶ SPI é€šä¿¡æ¥å£</p></li><li><p>â‘§å…·æœ‰è‡ªåŠ¨çœç”µåŠŸèƒ½</p></li></ul><p><img src="https://m.360buyimg.com/babel/jfs/t1/195282/27/23175/249776/625a49cdEa42fdc3a/eab387792f724d17.png" alt="image-20220413232008889.png"></p><p><img src="https://m.360buyimg.com/babel/jfs/t1/144207/37/25921/111497/625a49cbE869a7191/d288f807b8dd6dfb.png" alt="image-20220413232013642.png"></p><p><img src="https://m.360buyimg.com/babel/jfs/t1/209462/21/20422/35432/625a49cbE582256aa/b5cdf9df4df3a5f7.png" alt="image-20220413232017245.png"></p><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">//xpt2046.c</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;xpt2046.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;intrins.h&quot;</span></span>

<span class="token keyword">void</span> <span class="token function">xpt2046_wirte_data</span><span class="token punctuation">(</span>u8 dat<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	u8 i<span class="token punctuation">;</span>

	CLK <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token comment">//å¾ªç¯8æ¬¡ï¼Œæ¯æ¬¡ä¼ è¾“ä¸€ä½ï¼Œå…±ä¸€ä¸ªå­—èŠ‚</span>
	<span class="token punctuation">{</span>
		DIN <span class="token operator">=</span> dat <span class="token operator">&gt;&gt;</span> <span class="token number">7</span><span class="token punctuation">;</span><span class="token comment">//å…ˆä¼ é«˜ä½å†ä¼ ä½ä½</span>
		dat <span class="token operator">&lt;&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//å°†ä½ä½ç§»åˆ°é«˜ä½</span>
		CLK <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//CLKç”±ä½åˆ°é«˜äº§ç”Ÿä¸€ä¸ªä¸Šå‡æ²¿ï¼Œä»è€Œå†™å…¥æ•°æ®</span>
		<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
		CLK <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

u16	<span class="token function">xpt2046_read_data</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	u8 i<span class="token punctuation">;</span>
	u16 dat<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

	CLK <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">12</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token comment">//å¾ªç¯12æ¬¡ï¼Œæ¯æ¬¡è¯»å–ä¸€ä½ï¼Œå¤§äºä¸€ä¸ªå­—èŠ‚æ•°ï¼Œæ‰€ä»¥è¿”å›å€¼ç±»å‹æ˜¯u16</span>
	<span class="token punctuation">{</span>
		dat <span class="token operator">&lt;&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		CLK <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		CLK <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//CLKç”±é«˜åˆ°ä½äº§ç”Ÿä¸€ä¸ªä¸‹é™æ²¿ï¼Œä»è€Œè¯»å–æ•°æ®</span>
		<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		dat <span class="token operator">|=</span> DOUT<span class="token punctuation">;</span><span class="token comment">//å…ˆè¯»å–é«˜ä½ï¼Œå†è¯»å–ä½ä½ã€‚	</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> dat<span class="token punctuation">;</span>	
<span class="token punctuation">}</span>

u16 <span class="token function">xpt2046_read_adc_value</span><span class="token punctuation">(</span>u8 cmd<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	u8 i<span class="token punctuation">;</span>
	u16 adc_value<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

	CLK <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//å…ˆæ‹‰ä½æ—¶é’Ÿ</span>
	CS  <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//ä½¿èƒ½XPT2046</span>
	<span class="token function">xpt2046_wirte_data</span><span class="token punctuation">(</span>cmd<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å‘é€å‘½ä»¤å­—</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">;</span> i<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å»¶æ—¶ç­‰å¾…è½¬æ¢ç»“æœ</span>
	CLK <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	CLK <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//å‘é€ä¸€ä¸ªæ—¶é’Ÿï¼Œæ¸…é™¤BUSY</span>
	<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	adc_value<span class="token operator">=</span><span class="token function">xpt2046_read_data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	CS <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//å…³é—­XPT2046</span>
	<span class="token keyword">return</span> adc_value<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">//xpt2046.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">_xpt2046_H</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_xpt2046_H</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;public.h&quot;</span></span>

<span class="token comment">//ç®¡è„šå®šä¹‰</span>
sbit DOUT <span class="token operator">=</span> P3<span class="token operator">^</span><span class="token number">7</span><span class="token punctuation">;</span>	  <span class="token comment">//è¾“å‡º</span>
sbit CLK  <span class="token operator">=</span> P3<span class="token operator">^</span><span class="token number">6</span><span class="token punctuation">;</span>	  <span class="token comment">//æ—¶é’Ÿ</span>
sbit DIN  <span class="token operator">=</span> P3<span class="token operator">^</span><span class="token number">4</span><span class="token punctuation">;</span>	  <span class="token comment">//è¾“å…¥</span>
sbit CS   <span class="token operator">=</span> P3<span class="token operator">^</span><span class="token number">5</span><span class="token punctuation">;</span>	  <span class="token comment">//ç‰‡é€‰</span>


<span class="token comment">//å‡½æ•°å£°æ˜</span>
u16 <span class="token function">xpt2046_read_adc_value</span><span class="token punctuation">(</span>u8 cmd<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">//main.c</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;public.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;smg.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;xpt2046.h&quot;</span></span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>	
	u16 adc_value<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">float</span> adc_vol<span class="token punctuation">;</span><span class="token comment">//ADCç”µå‹å€¼</span>
	u8 adc_buf<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>				
		adc_value<span class="token operator">=</span><span class="token function">xpt2046_read_adc_value</span><span class="token punctuation">(</span><span class="token number">0x94</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æµ‹é‡ç”µä½å™¨</span>
		adc_vol<span class="token operator">=</span><span class="token number">5.0</span><span class="token operator">*</span>adc_value<span class="token operator">/</span><span class="token number">4096</span><span class="token punctuation">;</span><span class="token comment">//å°†è¯»å–çš„ADå€¼è½¬æ¢ä¸ºç”µå‹</span>
		adc_value<span class="token operator">=</span>adc_vol<span class="token operator">*</span><span class="token number">10</span><span class="token punctuation">;</span><span class="token comment">//æ”¾å¤§10å€ï¼Œå³ä¿ç•™å°æ•°ç‚¹åä¸€ä½</span>
		adc_buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span>gsmg_code<span class="token punctuation">[</span>adc_value<span class="token operator">/</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token operator">|</span><span class="token number">0x80</span><span class="token punctuation">;</span>
		adc_buf<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span>gsmg_code<span class="token punctuation">[</span>adc_value<span class="token operator">%</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	   	adc_buf<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0x3e</span><span class="token punctuation">;</span><span class="token comment">//æ˜¾ç¤ºå•ä½V</span>
		<span class="token function">smg_display</span><span class="token punctuation">(</span>adc_buf<span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		
	<span class="token punctuation">}</span>		
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="dacæ•°æ¨¡è½¬æ¢" tabindex="-1"><a class="header-anchor" href="#dacæ•°æ¨¡è½¬æ¢" aria-hidden="true">#</a> DACæ•°æ¨¡è½¬æ¢</h2><p><strong>DACå·¥ä½œåŸç†</strong></p><p>DAC è¾“å‡ºç”µå‹è®¡ç®—å…¬å¼ï¼š</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>V</mi><mn>0</mn></msub><mo>=</mo><mfrac><mrow><msub><mi>V</mi><mrow><mi>r</mi><mi>e</mi><mi>f</mi></mrow></msub><mo>Ã—</mo><mi>z</mi></mrow><mn>256</mn></mfrac></mrow><annotation encoding="application/x-tex">V_0=\frac{V_{ref}\times z}{256} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.0463em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">256</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">re</span><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p><img src="https://m.360buyimg.com/babel/jfs/t1/192044/12/23207/421628/625a49d1Edd19a7b6/2add151d708326e3.png" alt="image-20220414165154610.png"></p><p><strong>PWM</strong> <code>æ˜¯ </code>Pulse Width Modulation <code>çš„ç¼©å†™ï¼Œä¸­æ–‡æ„æ€å°±æ˜¯</code>è„‰å†²å®½åº¦è°ƒåˆ¶<code>ï¼Œç®€ç§°</code>è„‰å®½è°ƒåˆ¶`ã€‚</p><p><img src="https://m.360buyimg.com/babel/jfs/t1/99240/12/25844/54397/625a49cdE8f298af9/8ccb627744266d6d.png" alt="image-20220414165344036.png"></p><p><img src="https://m.360buyimg.com/babel/jfs/t1/128199/33/20891/19250/625a49caE5eaffa50/16b0acffe8d2c7b4.png" alt="image-20220414165350099.png"></p><p>é€šè¿‡è°ƒèŠ‚å ç©ºæ¯”è¾“å‡ºè°ƒåˆ¶è„‰å®½</p><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">//pwm.c</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;pwm.h&quot;</span></span>

<span class="token comment">//å…¨å±€å˜é‡å®šä¹‰</span>
u8 gtim_h<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//ä¿å­˜å®šæ—¶å™¨åˆå€¼é«˜8ä½</span>
u8 gtim_l<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//ä¿å­˜å®šæ—¶å™¨åˆå€¼ä½8ä½</span>
u8 gduty<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//ä¿å­˜PWMå ç©ºæ¯”</span>
u8 gtim_scale<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//ä¿å­˜PWMå‘¨æœŸ=å®šæ—¶å™¨åˆå€¼*tim_scale</span>

<span class="token keyword">void</span> <span class="token function">pwm_init</span><span class="token punctuation">(</span>u8 tim_h<span class="token punctuation">,</span>u8 tim_l<span class="token punctuation">,</span>u16 tim_scale<span class="token punctuation">,</span>u8 duty<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	gtim_h<span class="token operator">=</span>tim_h<span class="token punctuation">;</span><span class="token comment">//å°†ä¼ å…¥çš„åˆå€¼ä¿å­˜åœ¨å…¨å±€å˜é‡ä¸­ï¼Œæ–¹ä¾¿ä¸­æ–­å‡½æ•°ç»§ç»­è°ƒç”¨</span>
	gtim_l<span class="token operator">=</span>tim_l<span class="token punctuation">;</span>
	gduty<span class="token operator">=</span>duty<span class="token punctuation">;</span>
	gtim_scale<span class="token operator">=</span>tim_scale<span class="token punctuation">;</span>

	TMOD<span class="token operator">|=</span><span class="token number">0X01</span><span class="token punctuation">;</span>	<span class="token comment">//é€‰æ‹©ä¸ºå®šæ—¶å™¨0æ¨¡å¼ï¼Œå·¥ä½œæ–¹å¼1</span>
	TH0 <span class="token operator">=</span> gtim_h<span class="token punctuation">;</span>	<span class="token comment">//å®šæ—¶åˆå€¼è®¾ç½® </span>
	TL0 <span class="token operator">=</span> gtim_l<span class="token punctuation">;</span>		
	ET0<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//æ‰“å¼€å®šæ—¶å™¨0ä¸­æ–­å…è®¸</span>
	EA<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//æ‰“å¼€æ€»ä¸­æ–­</span>
	TR0<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//æ‰“å¼€å®šæ—¶å™¨</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">pwm_set_duty_cycle</span><span class="token punctuation">(</span>u8 duty<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	gduty<span class="token operator">=</span>duty<span class="token punctuation">;</span>	
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">pwm</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> interrupt <span class="token number">1</span>	<span class="token comment">//å®šæ—¶å™¨0ä¸­æ–­å‡½æ•°</span>
<span class="token punctuation">{</span>
	<span class="token keyword">static</span> u16 time<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

	TH0 <span class="token operator">=</span> gtim_h<span class="token punctuation">;</span>	<span class="token comment">//å®šæ—¶åˆå€¼è®¾ç½® </span>
	TL0 <span class="token operator">=</span> gtim_l<span class="token punctuation">;</span>
	
	time<span class="token operator">++</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>time<span class="token operator">&gt;=</span>gtim_scale<span class="token punctuation">)</span><span class="token comment">//PWMå‘¨æœŸ=å®šæ—¶å™¨åˆå€¼*gtim_scaleï¼Œé‡æ–°å¼€å§‹è®¡æ•°</span>
		time<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>time<span class="token operator">&lt;=</span>gduty<span class="token punctuation">)</span><span class="token comment">//å ç©ºæ¯”	</span>
		PWM<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token keyword">else</span>
		PWM<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>		
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">//pwm.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">_pwm_H</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_pwm_H</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;public.h&quot;</span></span>


<span class="token comment">//ç®¡è„šå®šä¹‰</span>
sbit PWM<span class="token operator">=</span>P2<span class="token operator">^</span><span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">//å˜é‡å£°æ˜</span>
<span class="token keyword">extern</span> u8 gtim_scale<span class="token punctuation">;</span>

<span class="token comment">//å‡½æ•°å£°æ˜</span>
<span class="token keyword">void</span> <span class="token function">pwm_init</span><span class="token punctuation">(</span>u8 tim_h<span class="token punctuation">,</span>u8 tim_l<span class="token punctuation">,</span>u16 tim_scale<span class="token punctuation">,</span>u8 duty<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">pwm_set_duty_cycle</span><span class="token punctuation">(</span>u8 duty<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">//main.c</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;public.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;pwm.h&quot;</span></span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>	
	u8 dir<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//é»˜è®¤ä¸º0</span>
	u8 duty<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

	<span class="token function">pwm_init</span><span class="token punctuation">(</span><span class="token number">0XFF</span><span class="token punctuation">,</span><span class="token number">0XF6</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å®šæ—¶æ—¶é—´ä¸º0.01msï¼ŒPWMå‘¨æœŸæ˜¯100*0.01ms=1msï¼Œå ç©ºæ¯”ä¸º0%</span>

	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>dir<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">//å½“dirä¸ºé€’å¢æ–¹å‘</span>
		<span class="token punctuation">{</span>
			duty<span class="token operator">++</span><span class="token punctuation">;</span><span class="token comment">//å ç©ºæ¯”é€’å¢</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>duty<span class="token operator">==</span><span class="token number">70</span><span class="token punctuation">)</span>dir<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//å½“åˆ°è¾¾ä¸€å®šå€¼åˆ‡æ¢æ–¹å‘ï¼Œå ç©ºæ¯”æœ€å¤§èƒ½åˆ°100ï¼Œä½†åˆ°è¾¾70å·¦å³å†é€’å¢ï¼Œ</span>
								<span class="token comment">//è‚‰çœ¼ä¹Ÿåˆ†è¾¨ä¸å‡ºäº®åº¦å˜åŒ–	</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>
		<span class="token punctuation">{</span>
			duty<span class="token operator">--</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>duty<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>dir<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//å½“åˆ°è¾¾ä¸€å®šå€¼åˆ‡æ¢æ–¹å‘	</span>
		<span class="token punctuation">}</span>
		<span class="token function">pwm_set_duty_cycle</span><span class="token punctuation">(</span>duty<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è®¾ç½®å ç©ºæ¯”</span>
		<span class="token function">delay_ms</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//çŸ­æš‚å»¶æ—¶ï¼Œè®©å‘¼å¸ç¯æœ‰ä¸€ä¸ªæµç•…çš„æ•ˆæœ			</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="lcd1602" tabindex="-1"><a class="header-anchor" href="#lcd1602" aria-hidden="true">#</a> LCD1602</h2><p><img src="https://m.360buyimg.com/babel/jfs/t1/99786/37/28369/63777/625a4a24E6fcb18fd/8356f3e2f496eb9f.png" alt="image-20220414184305813.png"></p><p><img src="https://m.360buyimg.com/babel/jfs/t1/222251/22/15694/78099/625a4a2eE5303c017/bf86b83dff8744d1.png" alt="image-20220414184317184.png"></p><p><img src="https://m.360buyimg.com/babel/jfs/t1/216582/13/17625/43050/625a4a35Ea8d9497c/c1fd9eed50443ee2.png" alt="image-20220414184321461.png"></p><p><strong>æ¸…å±æŒ‡ä»¤</strong></p><p><img src="https://m.360buyimg.com/babel/jfs/t1/181409/11/23572/39445/625a4a26E6baab9b8/30b7249165b27caf.png" alt="image-20220414184342167.png"></p><p><strong>æ¨¡å¼è®¾ç½®æŒ‡ä»¤</strong></p><p><img src="https://m.360buyimg.com/babel/jfs/t1/130945/12/26883/41813/625a4a29E1c9a2a73/0c2a9e6481da62e1.png" alt="image-20220414184352766.png"></p><p><strong>æ˜¾ç¤ºå¼€å…³æ§åˆ¶æŒ‡ä»¤</strong></p><p><img src="https://m.360buyimg.com/babel/jfs/t1/223916/1/9795/49334/625a4a2cE3d3e110c/a29fe9479851a5c1.png" alt="image-20220414184406286.png"></p><p><strong>åŠŸèƒ½è®¾å®šæŒ‡ä»¤</strong></p><p><img src="https://m.360buyimg.com/babel/jfs/t1/223627/6/9855/47810/625a4a31E930340f8/c7b58577c3f70ff2.png" alt="image-20220414184417864.png"></p><ol><li>åˆå§‹åŒ–</li><li>å†™å‘½ä»¤ï¼ˆRS=Lï¼‰ï¼Œè®¾ç½®æ˜¾ç¤ºåæ ‡</li><li>å†™æ•°æ®ï¼ˆRS=Hï¼‰</li></ol><p><img src="https://m.360buyimg.com/babel/jfs/t1/92195/19/26485/39958/625a4a33Ea4de70b7/03e172494853bc5f.png" alt="image-20220414185622918.png"></p><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">//lcd1602.c</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;lcd1602.h&quot;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>LCD1602_4OR8_DATA_INTERFACE<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span></span><span class="token comment">//8ä½LCD</span></span>
<span class="token keyword">void</span> <span class="token function">lcd1602_write_cmd</span><span class="token punctuation">(</span>u8 cmd<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	LCD1602_RS<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//é€‰æ‹©å‘½ä»¤</span>
	LCD1602_RW<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//é€‰æ‹©å†™</span>
	LCD1602_E<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	LCD1602_DATAPORT<span class="token operator">=</span>cmd<span class="token punctuation">;</span><span class="token comment">//å‡†å¤‡å‘½ä»¤</span>
	<span class="token function">delay_ms</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	LCD1602_E<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//ä½¿èƒ½è„šEå…ˆä¸Šå‡æ²¿å†™å…¥</span>
	<span class="token function">delay_ms</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	LCD1602_E<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//ä½¿èƒ½è„šEåè´Ÿè·³å˜å®Œæˆå†™å…¥	</span>
<span class="token punctuation">}</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span>	<span class="token comment">//4ä½LCD</span></span>
<span class="token keyword">void</span> <span class="token function">lcd1602_write_cmd</span><span class="token punctuation">(</span>u8 cmd<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	LCD1602_RS<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//é€‰æ‹©å‘½ä»¤</span>
	LCD1602_RW<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//é€‰æ‹©å†™</span>
	LCD1602_E<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	LCD1602_DATAPORT<span class="token operator">=</span>cmd<span class="token punctuation">;</span><span class="token comment">//å‡†å¤‡å‘½ä»¤</span>
	<span class="token function">delay_ms</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	LCD1602_E<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//ä½¿èƒ½è„šEå…ˆä¸Šå‡æ²¿å†™å…¥</span>
	<span class="token function">delay_ms</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	LCD1602_E<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//ä½¿èƒ½è„šEåè´Ÿè·³å˜å®Œæˆå†™å…¥</span>
	
	LCD1602_DATAPORT<span class="token operator">=</span>cmd<span class="token operator">&lt;&lt;</span><span class="token number">4</span><span class="token punctuation">;</span><span class="token comment">//å‡†å¤‡å‘½ä»¤</span>
	<span class="token function">delay_ms</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	LCD1602_E<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//ä½¿èƒ½è„šEå…ˆä¸Šå‡æ²¿å†™å…¥</span>
	<span class="token function">delay_ms</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	LCD1602_E<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//ä½¿èƒ½è„šEåè´Ÿè·³å˜å®Œæˆå†™å…¥	</span>
<span class="token punctuation">}</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>LCD1602_4OR8_DATA_INTERFACE<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span></span><span class="token comment">//8ä½LCD</span></span>
<span class="token keyword">void</span> <span class="token function">lcd1602_write_data</span><span class="token punctuation">(</span>u8 dat<span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
	LCD1602_RS<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//é€‰æ‹©æ•°æ®</span>
	LCD1602_RW<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//é€‰æ‹©å†™</span>
	LCD1602_E<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	LCD1602_DATAPORT<span class="token operator">=</span>dat<span class="token punctuation">;</span><span class="token comment">//å‡†å¤‡æ•°æ®</span>
	<span class="token function">delay_ms</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	LCD1602_E<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//ä½¿èƒ½è„šEå…ˆä¸Šå‡æ²¿å†™å…¥</span>
	<span class="token function">delay_ms</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	LCD1602_E<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//ä½¿èƒ½è„šEåè´Ÿè·³å˜å®Œæˆå†™å…¥		</span>
<span class="token punctuation">}</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span>
<span class="token keyword">void</span> <span class="token function">lcd1602_write_data</span><span class="token punctuation">(</span>u8 dat<span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
	LCD1602_RS<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//é€‰æ‹©æ•°æ®</span>
	LCD1602_RW<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//é€‰æ‹©å†™</span>
	LCD1602_E<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	LCD1602_DATAPORT<span class="token operator">=</span>dat<span class="token punctuation">;</span><span class="token comment">//å‡†å¤‡æ•°æ®</span>
	<span class="token function">delay_ms</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	LCD1602_E<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//ä½¿èƒ½è„šEå…ˆä¸Šå‡æ²¿å†™å…¥</span>
	<span class="token function">delay_ms</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	LCD1602_E<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//ä½¿èƒ½è„šEåè´Ÿè·³å˜å®Œæˆå†™å…¥</span>
	
	LCD1602_DATAPORT<span class="token operator">=</span>dat<span class="token operator">&lt;&lt;</span><span class="token number">4</span><span class="token punctuation">;</span><span class="token comment">//å‡†å¤‡æ•°æ®</span>
	<span class="token function">delay_ms</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	LCD1602_E<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//ä½¿èƒ½è„šEå…ˆä¸Šå‡æ²¿å†™å…¥</span>
	<span class="token function">delay_ms</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	LCD1602_E<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//ä½¿èƒ½è„šEåè´Ÿè·³å˜å®Œæˆå†™å…¥		</span>
<span class="token punctuation">}</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>LCD1602_4OR8_DATA_INTERFACE<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span></span><span class="token comment">//8ä½LCD</span></span>
<span class="token keyword">void</span> <span class="token function">lcd1602_init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token function">lcd1602_write_cmd</span><span class="token punctuation">(</span><span class="token number">0x38</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ•°æ®æ€»çº¿8ä½ï¼Œæ˜¾ç¤º2è¡Œï¼Œ5*7ç‚¹é˜µ/å­—ç¬¦</span>
	<span class="token function">lcd1602_write_cmd</span><span class="token punctuation">(</span><span class="token number">0x0c</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ˜¾ç¤ºåŠŸèƒ½å¼€ï¼Œæ— å…‰æ ‡ï¼Œå…‰æ ‡é—ªçƒ</span>
	<span class="token function">lcd1602_write_cmd</span><span class="token punctuation">(</span><span class="token number">0x06</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å†™å…¥æ–°æ•°æ®åå…‰æ ‡å³ç§»ï¼Œæ˜¾ç¤ºå±ä¸ç§»åŠ¨</span>
	<span class="token function">lcd1602_write_cmd</span><span class="token punctuation">(</span><span class="token number">0x01</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ¸…å±	</span>
<span class="token punctuation">}</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span>
<span class="token keyword">void</span> <span class="token function">lcd1602_init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token function">lcd1602_write_cmd</span><span class="token punctuation">(</span><span class="token number">0x28</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ•°æ®æ€»çº¿4ä½ï¼Œæ˜¾ç¤º2è¡Œï¼Œ5*7ç‚¹é˜µ/å­—ç¬¦</span>
	<span class="token function">lcd1602_write_cmd</span><span class="token punctuation">(</span><span class="token number">0x0c</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ˜¾ç¤ºåŠŸèƒ½å¼€ï¼Œæ— å…‰æ ‡ï¼Œå…‰æ ‡é—ªçƒ</span>
	<span class="token function">lcd1602_write_cmd</span><span class="token punctuation">(</span><span class="token number">0x06</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å†™å…¥æ–°æ•°æ®åå…‰æ ‡å³ç§»ï¼Œæ˜¾ç¤ºå±ä¸ç§»åŠ¨</span>
	<span class="token function">lcd1602_write_cmd</span><span class="token punctuation">(</span><span class="token number">0x01</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ¸…å±	</span>
<span class="token punctuation">}</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

<span class="token keyword">void</span> <span class="token function">lcd1602_clear</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token function">lcd1602_write_cmd</span><span class="token punctuation">(</span><span class="token number">0x01</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
<span class="token punctuation">}</span>


<span class="token keyword">void</span> <span class="token function">lcd1602_show_string</span><span class="token punctuation">(</span>u8 x<span class="token punctuation">,</span>u8 y<span class="token punctuation">,</span>u8 <span class="token operator">*</span>str<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	u8 i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span>y<span class="token operator">&gt;</span><span class="token number">1</span><span class="token operator">||</span>x<span class="token operator">&gt;</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">;</span><span class="token comment">//è¡Œåˆ—å‚æ•°ä¸å¯¹åˆ™å¼ºåˆ¶é€€å‡º</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span>y<span class="token operator">&lt;</span><span class="token number">1</span><span class="token punctuation">)</span>	<span class="token comment">//ç¬¬1è¡Œæ˜¾ç¤º</span>
	<span class="token punctuation">{</span>	
		<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">*</span>str<span class="token operator">!=</span><span class="token char">&#39;\0&#39;</span><span class="token punctuation">)</span><span class="token comment">//å­—ç¬¦ä¸²æ˜¯ä»¥&#39;\0&#39;ç»“å°¾ï¼Œåªè¦å‰é¢æœ‰å†…å®¹å°±æ˜¾ç¤º</span>
		<span class="token punctuation">{</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">&lt;</span><span class="token number">16</span><span class="token operator">-</span>x<span class="token punctuation">)</span><span class="token comment">//å¦‚æœå­—ç¬¦é•¿åº¦è¶…è¿‡ç¬¬ä¸€è¡Œæ˜¾ç¤ºèŒƒå›´ï¼Œåˆ™åœ¨ç¬¬äºŒè¡Œç»§ç»­æ˜¾ç¤º</span>
			<span class="token punctuation">{</span>
				<span class="token function">lcd1602_write_cmd</span><span class="token punctuation">(</span><span class="token number">0x80</span><span class="token operator">+</span>i<span class="token operator">+</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç¬¬ä¸€è¡Œæ˜¾ç¤ºåœ°å€è®¾ç½®	</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span>
			<span class="token punctuation">{</span>
				<span class="token function">lcd1602_write_cmd</span><span class="token punctuation">(</span><span class="token number">0x40</span><span class="token operator">+</span><span class="token number">0x80</span><span class="token operator">+</span>i<span class="token operator">+</span>x<span class="token operator">-</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç¬¬äºŒè¡Œæ˜¾ç¤ºåœ°å€è®¾ç½®	</span>
			<span class="token punctuation">}</span>
			<span class="token function">lcd1602_write_data</span><span class="token punctuation">(</span><span class="token operator">*</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ˜¾ç¤ºå†…å®¹</span>
			str<span class="token operator">++</span><span class="token punctuation">;</span><span class="token comment">//æŒ‡é’ˆé€’å¢</span>
			i<span class="token operator">++</span><span class="token punctuation">;</span>	
		<span class="token punctuation">}</span>	
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span>	<span class="token comment">//ç¬¬2è¡Œæ˜¾ç¤º</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">*</span>str<span class="token operator">!=</span><span class="token char">&#39;\0&#39;</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">&lt;</span><span class="token number">16</span><span class="token operator">-</span>x<span class="token punctuation">)</span> <span class="token comment">//å¦‚æœå­—ç¬¦é•¿åº¦è¶…è¿‡ç¬¬äºŒè¡Œæ˜¾ç¤ºèŒƒå›´ï¼Œåˆ™åœ¨ç¬¬ä¸€è¡Œç»§ç»­æ˜¾ç¤º</span>
			<span class="token punctuation">{</span>
				<span class="token function">lcd1602_write_cmd</span><span class="token punctuation">(</span><span class="token number">0x80</span><span class="token operator">+</span><span class="token number">0x40</span><span class="token operator">+</span>i<span class="token operator">+</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>	
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span>
			<span class="token punctuation">{</span>
				<span class="token function">lcd1602_write_cmd</span><span class="token punctuation">(</span><span class="token number">0x80</span><span class="token operator">+</span>i<span class="token operator">+</span>x<span class="token operator">-</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
			<span class="token punctuation">}</span>
			<span class="token function">lcd1602_write_data</span><span class="token punctuation">(</span><span class="token operator">*</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
			str<span class="token operator">++</span><span class="token punctuation">;</span>
			i<span class="token operator">++</span><span class="token punctuation">;</span>	
		<span class="token punctuation">}</span>	
	<span class="token punctuation">}</span>				
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">//lcd1602.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">_lcd1602_H</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_lcd1602_H</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;public.h&quot;</span></span>

<span class="token comment">//LCD1602æ•°æ®å£4ä½å’Œ8ä½å®šä¹‰ï¼Œè‹¥ä¸º1ï¼Œåˆ™ä¸ºLCD1602å››ä½æ•°æ®å£é©±åŠ¨ï¼Œåä¹‹ä¸º8ä½</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LCD1602_4OR8_DATA_INTERFACE</span>	<span class="token expression"><span class="token number">0</span>	</span><span class="token comment">//é»˜è®¤ä½¿ç”¨8ä½æ•°æ®å£LCD1602</span></span>

<span class="token comment">//ç®¡è„šå®šä¹‰</span>
sbit LCD1602_RS<span class="token operator">=</span>P2<span class="token operator">^</span><span class="token number">6</span><span class="token punctuation">;</span><span class="token comment">//æ•°æ®å‘½ä»¤é€‰æ‹©</span>
sbit LCD1602_RW<span class="token operator">=</span>P2<span class="token operator">^</span><span class="token number">5</span><span class="token punctuation">;</span><span class="token comment">//è¯»å†™é€‰æ‹©</span>
sbit LCD1602_E<span class="token operator">=</span>P2<span class="token operator">^</span><span class="token number">7</span><span class="token punctuation">;</span> <span class="token comment">//ä½¿èƒ½ä¿¡å·</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LCD1602_DATAPORT</span> <span class="token expression">P0	</span><span class="token comment">//å®å®šä¹‰LCD1602æ•°æ®ç«¯å£</span></span>


<span class="token comment">//å‡½æ•°å£°æ˜</span>
<span class="token keyword">void</span> <span class="token function">lcd1602_init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">lcd1602_clear</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">lcd1602_show_string</span><span class="token punctuation">(</span>u8 x<span class="token punctuation">,</span>u8 y<span class="token punctuation">,</span>u8 <span class="token operator">*</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">//main.c</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;public.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;lcd1602.h&quot;</span></span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>	
	<span class="token function">lcd1602_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//LCD1602åˆå§‹åŒ–</span>
	<span class="token function">lcd1602_show_string</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;Hello World!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç¬¬ä¸€è¡Œæ˜¾ç¤º</span>
	<span class="token function">lcd1602_show_string</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;0123456789&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç¬¬äºŒè¡Œæ˜¾ç¤º</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		
	<span class="token punctuation">}</span>	
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="esp8266" tabindex="-1"><a class="header-anchor" href="#esp8266" aria-hidden="true">#</a> ESP8266</h2><p><strong>AP</strong>æ˜¯<code>(Wireless)AccessPoint</code>çš„ç®€ç§°ï¼Œæ¥å…¥ç‚¹ã€‚</p><p>è¯¥èŠ¯ç‰‡ç”¨åˆ°äº†<code>ATæŒ‡ä»¤é›†</code></p><p>æŒ‡ä»¤é›†ä¸»è¦åˆ†ä¸ºï¼šåŸºç¡€ AT å‘½ä»¤ã€Wifi åŠŸèƒ½ AT å‘½ä»¤ã€TCP/IP å·¥å…·ç®± AT å‘½ ä»¤ç­‰ã€‚</p><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">//wifi_control.c</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;wifi_control.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;ds18b20.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;uart.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;smg.h&quot;</span></span>

<span class="token comment">//å®šä¹‰LED1ç®¡è„š</span>
sbit LED1<span class="token operator">=</span>P2<span class="token operator">^</span><span class="token number">0</span><span class="token punctuation">;</span>

<span class="token comment">//å®šä¹‰WIFIæ§åˆ¶å‘½ä»¤</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LED1_ON_CMD</span>			<span class="token char">&#39;1&#39;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LED1_OFF_CMD</span>		<span class="token char">&#39;2&#39;</span></span>


<span class="token comment">//ESP8266 WIFIå‘é€ATæŒ‡ä»¤</span>
<span class="token comment">//pbufï¼šATæŒ‡ä»¤ï¼Œå­—ç¬¦ä¸²æ ¼å¼ï¼Œå¦‚ï¼š&quot;AT&quot;</span>
<span class="token keyword">void</span> <span class="token function">ESP8266_SendCmd</span><span class="token punctuation">(</span>u8 <span class="token operator">*</span>pbuf<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">*</span>pbuf<span class="token operator">!=</span><span class="token char">&#39;\0&#39;</span><span class="token punctuation">)</span> <span class="token comment">//é‡åˆ°ç©ºæ ¼è·³å‡ºå¾ªç¯	</span>
	<span class="token punctuation">{</span>
		<span class="token function">UART_SendData</span><span class="token punctuation">(</span><span class="token operator">*</span>pbuf<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		pbuf<span class="token operator">++</span><span class="token punctuation">;</span>	
	<span class="token punctuation">}</span>
	<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">UART_SendData</span><span class="token punctuation">(</span><span class="token char">&#39;\r&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å›è½¦</span>
	<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">UART_SendData</span><span class="token punctuation">(</span><span class="token char">&#39;\n&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ¢è¡Œ</span>
	<span class="token function">delay_ms</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//ESP8266 WIFIå‘é€æ•°æ®åˆ°APP</span>
<span class="token comment">//pbufï¼šæ•°æ®</span>
<span class="token keyword">void</span> <span class="token function">ESP8266_SendData</span><span class="token punctuation">(</span>u8 <span class="token operator">*</span>pbuf<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token function">ESP8266_SendCmd</span><span class="token punctuation">(</span><span class="token string">&quot;AT+CIPSEND=0,7&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">*</span>pbuf<span class="token operator">!=</span><span class="token char">&#39;\0&#39;</span><span class="token punctuation">)</span> <span class="token comment">//é‡åˆ°ç©ºæ ¼è·³å‡ºå¾ªç¯	</span>
	<span class="token punctuation">{</span>
		<span class="token function">UART_SendData</span><span class="token punctuation">(</span><span class="token operator">*</span>pbuf<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		pbuf<span class="token operator">++</span><span class="token punctuation">;</span>	
	<span class="token punctuation">}</span>
	<span class="token function">UART_SendData</span><span class="token punctuation">(</span><span class="token char">&#39;\n&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ¢è¡Œ	</span>
<span class="token comment">//	delay_ms(10);</span>
<span class="token punctuation">}</span>

<span class="token comment">//ESP8266-WIFIæ¨¡å—å·¥ä½œæ¨¡å¼åˆå§‹åŒ–</span>
<span class="token keyword">void</span> <span class="token function">ESP8266_ModeInit</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token function">ESP8266_SendCmd</span><span class="token punctuation">(</span><span class="token string">&quot;AT+CWMODE=2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è®¾ç½®è·¯ç”±å™¨æ¨¡å¼ 1 staTIonæ¨¡å¼ 2 APç‚¹ è·¯ç”±å™¨æ¨¡å¼ 3 station+APæ··åˆæ¨¡å¼</span>
	<span class="token function">ESP8266_SendCmd</span><span class="token punctuation">(</span><span class="token string">&quot;AT+CWSAP=\&quot;PRECHIN\&quot;,\&quot;prechin168\&quot;,11,0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//è®¾ç½®WIFIçƒ­ç‚¹ååŠå¯†ç </span>
	<span class="token function">ESP8266_SendCmd</span><span class="token punctuation">(</span><span class="token string">&quot;AT+CIPAP=\&quot;192.168.4.1\&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//	ESP8266_SendCmd(&quot;AT+RST&quot;);//é‡æ–°å¯åŠ¨wifiæ¨¡å—</span>
<span class="token comment">//	delay_ms(2000);</span>
	<span class="token function">ESP8266_SendCmd</span><span class="token punctuation">(</span><span class="token string">&quot;AT+CIPMUX=1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//å¼€å¯å¤šè¿æ¥æ¨¡å¼ï¼Œå…è®¸å¤šä¸ªå„å®¢æˆ·ç«¯æ¥å…¥</span>
	<span class="token function">ESP8266_SendCmd</span><span class="token punctuation">(</span><span class="token string">&quot;AT+CIPSERVER=1,8080&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//å¯åŠ¨TCP/IP ç«¯å£ä¸º8080 å®ç°åŸºäºç½‘ç»œæ§åˆ¶	</span>
<span class="token punctuation">}</span> 

<span class="token comment">//WIFIæ§åˆ¶åˆå§‹åŒ–</span>
<span class="token keyword">void</span> <span class="token function">wifi_control_init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token function">UART_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">ds18b20_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åˆå§‹åŒ–DS18B20</span>
	<span class="token function">ESP8266_ModeInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	ES<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//å…è®¸ä¸²å£ä¸­æ–­</span>
<span class="token punctuation">}</span>

<span class="token comment">//WIFIæ§åˆ¶</span>
<span class="token keyword">void</span> <span class="token function">wifi_control</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	u16 i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
   	<span class="token keyword">int</span> temp_value<span class="token punctuation">;</span>
	u8 temp_buf<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	u8 wifi_send_buf<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		i<span class="token operator">++</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">%</span><span class="token number">50</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">//é—´éš”ä¸€æ®µæ—¶é—´è¯»å–æ¸©åº¦å€¼ï¼Œé—´éš”æ—¶é—´è¦å¤§äºæ¸©åº¦ä¼ æ„Ÿå™¨è½¬æ¢æ¸©åº¦æ—¶é—´</span>
			temp_value<span class="token operator">=</span><span class="token function">ds18b20_read_temperture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">10</span><span class="token punctuation">;</span><span class="token comment">//ä¿ç•™æ¸©åº¦å€¼å°æ•°åä¸€ä½</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>temp_value<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">//è´Ÿæ¸©åº¦</span>
		<span class="token punctuation">{</span>
			temp_value<span class="token operator">=</span><span class="token operator">-</span>temp_value<span class="token punctuation">;</span>
			temp_buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0x40</span><span class="token punctuation">;</span><span class="token comment">//æ˜¾ç¤ºè´Ÿå·</span>
			wifi_send_buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token char">&#39;-&#39;</span><span class="token punctuation">;</span>	
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>
		<span class="token punctuation">{</span>
			temp_buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0x00</span><span class="token punctuation">;</span><span class="token comment">//ä¸æ˜¾ç¤º</span>
			wifi_send_buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token char">&#39;+&#39;</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>		
		temp_buf<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span>gsmg_code<span class="token punctuation">[</span>temp_value<span class="token operator">/</span><span class="token number">1000</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//ç™¾ä½</span>
		temp_buf<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">=</span>gsmg_code<span class="token punctuation">[</span>temp_value<span class="token operator">%</span><span class="token number">1000</span><span class="token operator">/</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//åä½</span>
		temp_buf<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">=</span>gsmg_code<span class="token punctuation">[</span>temp_value<span class="token operator">%</span><span class="token number">1000</span><span class="token operator">%</span><span class="token number">100</span><span class="token operator">/</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token operator">|</span><span class="token number">0x80</span><span class="token punctuation">;</span><span class="token comment">//ä¸ªä½+å°æ•°ç‚¹</span>
		temp_buf<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">=</span>gsmg_code<span class="token punctuation">[</span>temp_value<span class="token operator">%</span><span class="token number">1000</span><span class="token operator">%</span><span class="token number">100</span><span class="token operator">%</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//å°æ•°ç‚¹åä¸€ä½</span>
		<span class="token function">smg_display</span><span class="token punctuation">(</span>temp_buf<span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">%</span><span class="token number">100</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			wifi_send_buf<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span>temp_value<span class="token operator">/</span><span class="token number">1000</span><span class="token operator">+</span><span class="token number">0x30</span><span class="token punctuation">;</span>
			wifi_send_buf<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">=</span>temp_value<span class="token operator">%</span><span class="token number">1000</span><span class="token operator">/</span><span class="token number">100</span><span class="token operator">+</span><span class="token number">0x30</span><span class="token punctuation">;</span>
			wifi_send_buf<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">=</span>temp_value<span class="token operator">%</span><span class="token number">1000</span><span class="token operator">%</span><span class="token number">100</span><span class="token operator">/</span><span class="token number">10</span><span class="token operator">+</span><span class="token number">0x30</span><span class="token punctuation">;</span>
			wifi_send_buf<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token char">&#39;.&#39;</span><span class="token punctuation">;</span>
			wifi_send_buf<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token operator">=</span>temp_value<span class="token operator">%</span><span class="token number">1000</span><span class="token operator">%</span><span class="token number">100</span><span class="token operator">%</span><span class="token number">10</span><span class="token operator">+</span><span class="token number">0x30</span><span class="token punctuation">;</span>
			wifi_send_buf<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token char">&#39;\0&#39;</span><span class="token punctuation">;</span>
			<span class="token function">ESP8266_SendData</span><span class="token punctuation">(</span>wifi_send_buf<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//é€šè¿‡ä¸²å£å‘é€æ¸©åº¦æ•°æ®åˆ°APP	</span>
		<span class="token punctuation">}</span>		
	<span class="token punctuation">}</span>	
<span class="token punctuation">}</span>

<span class="token comment">//ä¸²å£ä¸­æ–­æœåŠ¡å‡½æ•°</span>
<span class="token comment">//æ¥æ”¶æ‰‹æœºAPPå‘é€çš„ä¿¡å·åæ§åˆ¶æ¿è½½èµ„æº</span>
<span class="token keyword">void</span> <span class="token function">UART_IRQn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> interrupt <span class="token number">4</span>
<span class="token punctuation">{</span>
	<span class="token keyword">static</span> u8 i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span>RI<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		RI<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
		UART_RX_BUF<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>SBUF<span class="token punctuation">;</span><span class="token comment">//è¯»å–æ¥æ”¶åˆ°çš„æ•°æ®</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>UART_RX_BUF<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token char">&#39;+&#39;</span><span class="token punctuation">)</span>i<span class="token operator">++</span><span class="token punctuation">;</span>
		<span class="token keyword">else</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">==</span><span class="token number">10</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
			<span class="token comment">//WIFIæ§åˆ¶</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>UART_RX_BUF<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token operator">==</span>LED1_ON_CMD<span class="token punctuation">)</span>
				LED1<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
			<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>UART_RX_BUF<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token operator">==</span>LED1_OFF_CMD<span class="token punctuation">)</span>
				LED1<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>		
		<span class="token punctuation">}</span>			
	<span class="token punctuation">}</span>	
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">//wifi_control.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">_wifi_control_H</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_wifi_control_H</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;public.h&quot;</span></span>


<span class="token keyword">void</span> <span class="token function">wifi_control_init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">wifi_control</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">//uart.c</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;uart.h&quot;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">RELOAD_COUNT</span> <span class="token expression"><span class="token number">0xFA</span> </span><span class="token comment">//å®å®šä¹‰æ³¢ç‰¹ç‡å‘ç”Ÿå™¨çš„è½½å…¥å€¼ 9600</span></span>

<span class="token keyword">void</span> <span class="token function">UART_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	SCON<span class="token operator">|=</span><span class="token number">0X50</span><span class="token punctuation">;</span>			<span class="token comment">//è®¾ç½®ä¸ºå·¥ä½œæ–¹å¼1</span>
	TMOD<span class="token operator">|=</span><span class="token number">0X20</span><span class="token punctuation">;</span>			<span class="token comment">//è®¾ç½®è®¡æ•°å™¨å·¥ä½œæ–¹å¼2</span>
	PCON<span class="token operator">=</span><span class="token number">0X80</span><span class="token punctuation">;</span>			<span class="token comment">//æ³¢ç‰¹ç‡åŠ å€</span>
	TH1<span class="token operator">=</span>RELOAD_COUNT<span class="token punctuation">;</span>	<span class="token comment">//è®¡æ•°å™¨åˆå§‹å€¼è®¾ç½®</span>
	TL1<span class="token operator">=</span>TH1<span class="token punctuation">;</span>
	ES<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>				<span class="token comment">//å…³é—­æ¥æ”¶ä¸­æ–­</span>
	EA<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>				<span class="token comment">//æ‰“å¼€æ€»ä¸­æ–­</span>
	TR1<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>				<span class="token comment">//æ‰“å¼€è®¡æ•°å™¨</span>
<span class="token comment">//	TI=1;          //å‘é€ä¸­æ–­æ ‡è®°ä½ï¼Œå¦‚æœä½¿ç”¨printfå‡½æ•°çš„å¿…é¡»è®¾ç½®	</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">UART_SendData</span><span class="token punctuation">(</span>u8 dat<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	ES<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//å…³é—­ä¸²å£ä¸­æ–­</span>
	TI<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//æ¸…å‘é€å®Œæ¯•ä¸­æ–­è¯·æ±‚æ ‡å¿—ä½</span>
	SBUF<span class="token operator">=</span>dat<span class="token punctuation">;</span> <span class="token comment">//å‘é€</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span>TI<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//ç­‰å¾…å‘é€å®Œæ¯•</span>
	TI<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//æ¸…å‘é€å®Œæ¯•ä¸­æ–­è¯·æ±‚æ ‡å¿—ä½</span>
	ES<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//å…è®¸ä¸²å£ä¸­æ–­</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">UART_SendString</span><span class="token punctuation">(</span>u8 <span class="token operator">*</span>pbuf<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">*</span>pbuf<span class="token operator">!=</span><span class="token char">&#39;\0&#39;</span><span class="token punctuation">)</span> <span class="token comment">//é‡åˆ°ç©ºæ ¼è·³å‡ºå¾ªç¯	</span>
	<span class="token punctuation">{</span>
		<span class="token function">UART_SendData</span><span class="token punctuation">(</span><span class="token operator">*</span>pbuf<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">delay_10us</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		pbuf<span class="token operator">++</span><span class="token punctuation">;</span>	
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

u8 UART_RX_BUF<span class="token punctuation">[</span>UART_REC_LEN<span class="token punctuation">]</span><span class="token punctuation">;</span>     <span class="token comment">//æ¥æ”¶ç¼“å†²,æœ€å¤§UART_REC_LENä¸ªå­—èŠ‚.</span>
<span class="token comment">//æ¥æ”¶çŠ¶æ€</span>
<span class="token comment">//bit15ï¼Œ	æ¥æ”¶å®Œæˆæ ‡å¿—</span>
<span class="token comment">//bit14ï¼Œ	æ¥æ”¶åˆ°0x0d</span>
<span class="token comment">//bit13~0ï¼Œ	æ¥æ”¶åˆ°çš„æœ‰æ•ˆå­—èŠ‚æ•°ç›®</span>
u16 UART_RX_STA<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>       <span class="token comment">//æ¥æ”¶çŠ¶æ€æ ‡è®°	</span>


<span class="token comment">//void UART_IRQn() interrupt 4</span>
<span class="token comment">//{</span>
<span class="token comment">//	u8 r;</span>
<span class="token comment">//	static u8 i=0;</span>
<span class="token comment">//	</span>
<span class="token comment">//	if(RI)</span>
<span class="token comment">//	{</span>
<span class="token comment">//		RI=0;</span>
<span class="token comment">//		UART_RX_BUF[i]=SBUF;//è¯»å–æ¥æ”¶åˆ°çš„æ•°æ®</span>
<span class="token comment">//		if(UART_RX_BUF[0]==&#39;+&#39;)i++;</span>
<span class="token comment">//		else i=0;</span>
<span class="token comment">//		if(i==10)</span>
<span class="token comment">//		{</span>
<span class="token comment">//			i=0;</span>
<span class="token comment">//		}		  		</span>
<span class="token comment">//	}	</span>
<span class="token comment">//}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">//main.c</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;public.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;wifi_control.h&quot;</span></span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>	
	<span class="token function">wifi_control_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>				
		<span class="token function">wifi_control</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
	<span class="token punctuation">}</span>		
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥ç”¨æ‰‹æœº<code>app</code>æ§åˆ¶ï¼Œè®¾ç½®<code>esp</code>èŠ¯ç‰‡<code>ip</code>ä¸º<code>192.168.4.1:8080</code></p><p>æ§åˆ¶ LED1 å¼€çš„æŒ‡ä»¤ï¼š<code>+IPD,0,1:1</code></p><p>æ§åˆ¶ LED1 å…³çš„æŒ‡ä»¤ï¼š<code>+IPD,0,1:2</code></p><p>ä¹Ÿå¯ä»¥ç›´æ¥è¿æ¥ï¼Œæµè§ˆå™¨ä¸­è¾“å…¥ï¼Œ<code>192.168.4.1:8080/+IPD,0,1:1</code>ï¼Œå…³ç¯åŒç†ã€‚</p><div class="custom-container tip"><p class="custom-container-title">æ³¨æ„äº‹é¡¹</p><p>cè¯­è¨€é™æ€å˜é‡çš„å£°æ˜æ”¾åˆ°æ‰€æœ‰å˜é‡ä¹‹å‰ï¼Œå¦åˆ™ä¼šæŠ¥é”™</p><p>ä¸­æ–­å‡½æ•°å¤´æ–‡ä»¶ä¸éœ€è¦å£°æ˜</p><p>æ•°æ®é«˜ä½ä¼ è¾“ã€ä½ä½ä¼ è¾“</p><p>ä¸Šå‡æ²¿é‡‡æ ·ã€ä¸‹é™æ²¿é‡‡æ ·</p><p>åˆ¤æ–­å»¶æ—¶æ˜¯å¦ç»“æŸ</p><p>I2Cã€UARTã€PWM</p></div></div><!--[--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">ä¸Šæ¬¡æ›´æ–°: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">ä½œè€…: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 1814300923@qq.com">Chenxuwkk</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/blog/study/page11.html" class="" aria-label="Makefile"><!--[--><!--]--> Makefile <!--[--><!--]--></a></span><span class="next"><a href="/blog/study/page13.html" class="" aria-label="STM32"><!--[--><!--]--> STM32 <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/blog/assets/app.b33ca31f.js" defer></script>
  </body>
</html>
